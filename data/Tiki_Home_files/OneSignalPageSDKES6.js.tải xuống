!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=25)}([function(e,t,i){"use strict";i.d(t,"a",function(){return n});Object.setPrototypeOf||Array;Object.assign;function n(e,t,i,n){return new(i||(i=Promise))(function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(r,a)}c((n=n.apply(e,t||[])).next())})}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});class n{static shouldLog(){try{if("undefined"==typeof window||void 0===window.localStorage)return!1;const e=window.localStorage.getItem("loglevel");return!(!e||"trace"!==e.toLowerCase())}catch(e){return!1}}static setLevel(e){if("undefined"!=typeof window&&void 0!==window.localStorage)try{window.localStorage.setItem("loglevel",e),n.proxyMethodsCreated=void 0,n.createProxyMethods()}catch(e){return}}static createProxyMethods(){if(void 0!==n.proxyMethodsCreated)return;n.proxyMethodsCreated=!0;const e={log:"debug",trace:"trace",info:"info",warn:"warn",error:"error"};for(const t of Object.keys(e)){const i=void 0!==console[t],o=e[t],s=i&&(n.shouldLog()||"error"===o);n[o]=s?console[t].bind(console):function(){}}}}n.createProxyMethods()},function(e,t,i){"use strict";i.d(t,"g",function(){return p}),i.d(t,"w",function(){return h}),i.d(t,"c",function(){return b}),i.d(t,"q",function(){return f}),i.d(t,"y",function(){return m}),i.d(t,"j",function(){return S}),i.d(t,"s",function(){return v}),i.d(t,"r",function(){return O}),i.d(t,"b",function(){return y}),i.d(t,"e",function(){return w}),i.d(t,"a",function(){return E}),i.d(t,"v",function(){return P}),i.d(t,"o",function(){return I}),i.d(t,"k",function(){return C}),i.d(t,"i",function(){return T}),i.d(t,"t",function(){return A}),i.d(t,"x",function(){return N}),i.d(t,"f",function(){return M}),i.d(t,"z",function(){return k}),i.d(t,"u",function(){return x}),i.d(t,"n",function(){return _}),i.d(t,"d",function(){return j}),i.d(t,"p",function(){return D}),i.d(t,"m",function(){return R}),i.d(t,"l",function(){return U}),i.d(t,"h",function(){return W});var n=i(0),o=i(4),s=i(6),r=(i(3),i(1)),a=i(9),c=i(17),l=i(21),d=i(5),u=i(8),g=i.n(u);function p(e){return l.a.decodeHtmlEntities(e)}function h(e){var t=document.querySelectorAll(e);if(t.length>0)for(let e=0;e<t.length;e++){const i=t[e].parentNode;i&&i.removeChild(t[e])}}function b(){return Object(n.a)(this,void 0,void 0,function*(){return new Promise(e=>{OneSignal.initialized?e():OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED,e)})})}function f(){return a.a.isUsingSubscriptionWorkaround()}function m(e=!1){return Object(n.a)(this,void 0,void 0,function*(){return c.a.triggerNotificationPermissionChanged(e)})}function S(e,...t){if(e)return e.apply(null,t)}function v(e,...t){return a.a.logMethodCall(e,...t)}function O(e){return!!e&&!!e.match(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/)}function y(e,t,i){let n;if(!(n="string"==typeof e?document.querySelector(e):e))throw new Error(`${e} must be a CSS selector string or DOM Element object.`);n.insertAdjacentHTML(t,i)}function w(e){if("string"==typeof e){const t=document.querySelector(e);if(null===t)throw new Error(`Cannot find element with selector "${e}"`);for(;t.firstChild;)t.removeChild(t.firstChild)}else{if("object"!=typeof e)throw new Error(`${e} must be a CSS selector string or DOM Element object.`);for(;e.firstChild;)e.removeChild(e.firstChild)}}function E(e,t){if("string"==typeof e){const i=document.querySelector(e);if(null===i)throw new Error(`Cannot find element with selector "${e}"`);i.classList.add(t)}else{if("object"!=typeof e)throw new Error(`${e} must be a CSS selector string or DOM Element object.`);e.classList.add(t)}}function P(e,t){if("string"==typeof e){const i=document.querySelector(e);if(null===i)throw new Error(`Cannot find element with selector "${e}"`);i.classList.remove(t)}else{if("object"!=typeof e)throw new Error(`${e} must be a CSS selector string or DOM Element object.`);e.classList.remove(t)}}function I(e,t){if("string"==typeof e){const i=document.querySelector(e);if(null===i)throw new Error(`Cannot find element with selector "${e}"`);return i.classList.contains(t)}if("object"==typeof e)return e.classList.contains(t);throw new Error(`${e} must be a CSS selector string or DOM Element object.`)}function C(e){return d.a.getConsoleStyle(e)}function T(e){return new Promise(t=>{setTimeout(t,e)})}function A(){return Promise.resolve()}function N(e,t){return d.a.timeoutPromise(e,t)}function M(e,t){return d.a.contains(e,t)}function k(){return r.a.warn("OneSignal: Unsubscribing from push."),o.a.getWindowEnv()!==s.a.ServiceWorker?self.registration.pushManager.getSubscription().then(e=>{if(e)return e.unsubscribe();throw new Error("Cannot unsubscribe because not subscribed.")}):f()?new Promise((e,t)=>{r.a.debug("Unsubscribe from push got called, and we're going to remotely execute it in HTTPS iFrame."),OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.UNSUBSCRIBE_FROM_PUSH,null,i=>{r.a.debug("Unsubscribe from push succesfully remotely executed."),i.data===OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE?e():t("Failed to remotely unsubscribe from push.")})}):OneSignal.context.serviceWorkerManager.getRegistration().then(e=>e||Promise.resolve()).then(e=>e.pushManager).then(e=>e.getSubscription()).then(e=>e?e.unsubscribe():Promise.resolve())}function x(e,t,i,n=!1){if(t||r.a.error("Cannot call on() with no event: ",t),i||r.a.error("Cannot call on() with no task: ",i),"string"==typeof e){let n=document.querySelectorAll(e);if(n.length>0)for(let e=0;e<n.length;e++)x(n[e],t,i)}else if(s=e,"[object Array]"===Object.prototype.toString.call(s))for(let n=0;n<e.length;n++)x(e[n],t,i);else{if("object"!=typeof e)throw new Error(`${e} must be a CSS selector string or DOM Element object.`);var o=function(t){var s=function(){e.removeEventListener(t.type,o)};n||s(),i(t,s)};e.addEventListener(t,o)}var s}function _(){return window.__oneSignalSdkLoadCount||0}function j(e){return Object(n.a)(this,void 0,void 0,function*(){return yield new Promise(t=>{OneSignal.emitter.once(e,e=>{t(e)})})})}function D(){window.__oneSignalSdkLoadCount=_()+1}function R(e){return e?g.a.safari&&e.safari?e.safari:g.a.firefox&&e.firefox?e.firefox:e.chrome||e.firefox||e.safari||"default-icon":"default-icon"}function U(e){const t=document.querySelector(e);return t||(r.a.debug(`No instance of ${e} found. Returning stub.`),document.createElement("div"))}function W(e){return JSON.parse(JSON.stringify(e))}},function(e,t,i){"use strict";var n=i(0),o=i(18),s=i(23);class r{}class a{}var c,l,d=i(22),u=i(20),g=i(6),p=i(19),h=i(13),b=i(4),f=i(9),m=i(5),S=i(1);i.d(t,"a",function(){return v}),(l=c||(c={}))[l.SET=0]="SET";class v{constructor(e){this.databaseName=e,this.emitter=new o.a,this.database=new s.a(this.databaseName)}static resetInstance(){v.databaseInstance=null}static get singletonInstance(){return v.databaseInstanceName||(v.databaseInstanceName="ONE_SIGNAL_SDK_DB"),v.databaseInstance||(v.databaseInstance=new v(v.databaseInstanceName)),v.databaseInstance}static applyDbResultFilter(e,t,i){switch(e){case"Options":return i&&t?i.value:i&&!t?i:null;case"Ids":return i&&t?i.id:i&&!t?i:null;case"NotificationOpened":return i&&t?{data:i.data,timestamp:i.timestamp}:i&&!t?i:null;default:return i||null}}shouldUsePostmam(){return b.a.getWindowEnv()!==g.a.ServiceWorker&&f.b.isUsingSubscriptionWorkaround()&&b.a.getTestEnv()===u.a.None}get(e,t){return Object(n.a)(this,void 0,void 0,function*(){if(this.shouldUsePostmam())return yield new Promise(i=>Object(n.a)(this,void 0,void 0,function*(){OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET,[{table:e,key:t}],e=>{const t=e.data[0];i(t)})}));{const i=yield this.database.get(e,t);return v.applyDbResultFilter(e,t,i)}})}getAll(e){return Object(n.a)(this,void 0,void 0,function*(){if(this.shouldUsePostmam())return yield new Promise(t=>Object(n.a)(this,void 0,void 0,function*(){OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET_ALL,{table:e},e=>{const i=e.data;t(i)})}));return yield this.database.getAll(e)})}put(e,t){return Object(n.a)(this,void 0,void 0,function*(){yield new Promise((i,o)=>Object(n.a)(this,void 0,void 0,function*(){b.a.getWindowEnv()!==g.a.ServiceWorker&&f.b.isUsingSubscriptionWorkaround()&&b.a.getTestEnv()===u.a.None?OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_PUT,[{table:e,keypath:t}],n=>{n.data===OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE?i():o(`(Database) Attempted remote IndexedDB put(${e}, ${t}),`+"but did not get success response.")}):(yield this.database.put(e,t),i())})),this.emitter.emit(v.EVENTS.SET,t)})}remove(e,t){return b.a.getWindowEnv()!==g.a.ServiceWorker&&f.b.isUsingSubscriptionWorkaround()&&b.a.getTestEnv()===u.a.None?new Promise((i,n)=>{OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_REMOVE,[{table:e,keypath:t}],o=>{o.data===OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE?i():n(`(Database) Attempted remote IndexedDB remove(${e}, ${t}),`+"but did not get success response.")})}):this.database.remove(e,t)}getAppConfig(){return Object(n.a)(this,void 0,void 0,function*(){const e={},t=yield this.get("Ids","appId");return e.appId=t,e.subdomain=yield this.get("Options","subdomain"),e.vapidPublicKey=yield this.get("Options","vapidPublicKey"),e})}getExternalUserId(){return Object(n.a)(this,void 0,void 0,function*(){return yield this.get("Ids","externalUserId")})}getExternalUserIdAuthHash(){return Object(n.a)(this,void 0,void 0,function*(){return yield this.get("Ids","externalUserIdAuthHash")})}setExternalUserId(e,t){return Object(n.a)(this,void 0,void 0,function*(){const i=m.b.getValueOrDefault(e,""),n=m.b.getValueOrDefault(t,"");""===i?yield this.remove("Ids","externalUserId"):yield this.put("Ids",{type:"externalUserId",id:i}),""===n?yield this.remove("Ids","externalUserIdAuthHash"):yield this.put("Ids",{type:"externalUserIdAuthHash",id:n})})}setAppConfig(e){return Object(n.a)(this,void 0,void 0,function*(){e.appId&&(yield this.put("Ids",{type:"appId",id:e.appId})),e.subdomain&&(yield this.put("Options",{key:"subdomain",value:e.subdomain})),!0===e.httpUseOneSignalCom?yield this.put("Options",{key:"httpUseOneSignalCom",value:!0}):!1===e.httpUseOneSignalCom&&(yield this.put("Options",{key:"httpUseOneSignalCom",value:!1})),e.vapidPublicKey&&(yield this.put("Options",{key:"vapidPublicKey",value:e.vapidPublicKey}))})}getAppState(){return Object(n.a)(this,void 0,void 0,function*(){const e=new r;return e.defaultNotificationUrl=yield this.get("Options","defaultUrl"),e.defaultNotificationTitle=yield this.get("Options","defaultTitle"),e.lastKnownPushEnabled=yield this.get("Options","isPushEnabled"),e.clickedNotifications=yield this.get("NotificationOpened"),e})}setAppState(e){return Object(n.a)(this,void 0,void 0,function*(){if(e.defaultNotificationUrl&&(yield this.put("Options",{key:"defaultUrl",value:e.defaultNotificationUrl})),(e.defaultNotificationTitle||""===e.defaultNotificationTitle)&&(yield this.put("Options",{key:"defaultTitle",value:e.defaultNotificationTitle})),null!=e.lastKnownPushEnabled&&(yield this.put("Options",{key:"isPushEnabled",value:e.lastKnownPushEnabled})),e.clickedNotifications){const t=Object.keys(e.clickedNotifications);for(const i of t){const t=e.clickedNotifications[i];t?yield this.put("NotificationOpened",{url:i,data:t.data,timestamp:t.timestamp}):null===t&&(yield this.remove("NotificationOpened",i))}}})}getServiceWorkerState(){return Object(n.a)(this,void 0,void 0,function*(){const e=new a;return e.workerVersion=yield this.get("Ids","WORKER1_ONE_SIGNAL_SW_VERSION"),e.updaterWorkerVersion=yield this.get("Ids","WORKER2_ONE_SIGNAL_SW_VERSION"),e})}setServiceWorkerState(e){return Object(n.a)(this,void 0,void 0,function*(){e.workerVersion&&(yield this.put("Ids",{type:"WORKER1_ONE_SIGNAL_SW_VERSION",id:e.workerVersion})),e.updaterWorkerVersion&&(yield this.put("Ids",{type:"WORKER2_ONE_SIGNAL_SW_VERSION",id:e.updaterWorkerVersion}))})}getSubscription(){return Object(n.a)(this,void 0,void 0,function*(){const e=new d.a;e.deviceId=yield this.get("Ids","userId"),e.subscriptionToken=yield this.get("Ids","registrationId");const t=yield this.get("Options","optedOut"),i=yield this.get("Options","subscription"),n=yield this.get("Options","subscriptionCreatedAt"),o=yield this.get("Options","subscriptionExpirationTime");return e.optedOut=null!=t?t:null!=i&&!i,e.createdAt=n,e.expirationTime=o,e})}setDeviceId(e){return Object(n.a)(this,void 0,void 0,function*(){yield this.put("Ids",{type:"userId",id:e})})}setSubscription(e){return Object(n.a)(this,void 0,void 0,function*(){e.deviceId&&(yield this.setDeviceId(e.deviceId)),void 0!==e.subscriptionToken&&(yield this.put("Ids",{type:"registrationId",id:e.subscriptionToken})),null!=e.optedOut&&(yield this.put("Options",{key:"optedOut",value:e.optedOut})),null!=e.createdAt&&(yield this.put("Options",{key:"subscriptionCreatedAt",value:e.createdAt})),null!=e.expirationTime?yield this.put("Options",{key:"subscriptionExpirationTime",value:e.expirationTime}):yield this.remove("Options","subscriptionExpirationTime")})}getEmailProfile(){return Object(n.a)(this,void 0,void 0,function*(){const e=yield this.get("Ids","emailProfile");return e?p.a.deserialize(e):new p.a})}setEmailProfile(e){return Object(n.a)(this,void 0,void 0,function*(){e&&(yield this.put("Ids",{type:"emailProfile",id:e.serialize()}))})}setProvideUserConsent(e){return Object(n.a)(this,void 0,void 0,function*(){yield this.put("Options",{key:"userConsent",value:e})})}getProvideUserConsent(){return Object(n.a)(this,void 0,void 0,function*(){return yield this.get("Options","userConsent")})}getSession(e){return Object(n.a)(this,void 0,void 0,function*(){return yield this.get("Sessions",e)})}setSession(e){return Object(n.a)(this,void 0,void 0,function*(){yield this.put("Sessions",e)})}removeSession(e){return Object(n.a)(this,void 0,void 0,function*(){yield this.remove("Sessions",e)})}getLastNotificationClicked(e){return Object(n.a)(this,void 0,void 0,function*(){let t=[];try{t=yield this.getAll("NotificationClicked")}catch(e){S.a.error("Database.getNotificationClickedByUrl",e)}return t.find(t=>t.appId===e)||null})}getNotificationClickedByUrl(e,t){return Object(n.a)(this,void 0,void 0,function*(){let i=[];try{i=yield this.getAll("NotificationClicked")}catch(e){S.a.error("Database.getNotificationClickedByUrl",e)}return i.find(i=>i.appId===t&&new URL(e).origin===new URL(i.url).origin)||null})}getNotificationClickedById(e){return Object(n.a)(this,void 0,void 0,function*(){return yield this.get("NotificationClicked",e)})}getNotificationReceivedById(e){return Object(n.a)(this,void 0,void 0,function*(){return yield this.get("NotificationReceived",e)})}removeNotificationClickedById(e){return Object(n.a)(this,void 0,void 0,function*(){yield this.remove("NotificationClicked",e)})}removeAllNotificationClicked(){return Object(n.a)(this,void 0,void 0,function*(){yield this.remove("NotificationClicked")})}resetSentUniqueOutcomes(){return Object(n.a)(this,void 0,void 0,function*(){const e=(yield this.getAll("SentUniqueOutcome")).map(e=>(e.sentDuringSession=null,v.put("SentUniqueOutcome",e)));yield Promise.all(e)})}static rebuild(){return Object(n.a)(this,void 0,void 0,function*(){return Promise.all([v.singletonInstance.remove("Ids"),v.singletonInstance.remove("NotificationOpened"),v.singletonInstance.remove("Options"),v.singletonInstance.remove("NotificationReceived"),v.singletonInstance.remove("NotificationClicked"),v.singletonInstance.remove("SentUniqueOutcome")])})}static on(...e){return Object(n.a)(this,void 0,void 0,function*(){return v.singletonInstance.emitter.on.apply(v.singletonInstance.emitter,e)})}static getCurrentSession(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getSession(h.a)})}static upsertSession(e){return Object(n.a)(this,void 0,void 0,function*(){yield v.singletonInstance.setSession(e)})}static cleanupCurrentSession(){return Object(n.a)(this,void 0,void 0,function*(){yield v.singletonInstance.removeSession(h.a)})}static setEmailProfile(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.setEmailProfile(e)})}static getEmailProfile(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getEmailProfile()})}static setSubscription(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.setSubscription(e)})}static getSubscription(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getSubscription()})}static setProvideUserConsent(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.setProvideUserConsent(e)})}static getProvideUserConsent(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getProvideUserConsent()})}static setServiceWorkerState(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.setServiceWorkerState(e)})}static getServiceWorkerState(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getServiceWorkerState()})}static setAppState(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.setAppState(e)})}static getAppState(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getAppState()})}static setAppConfig(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.setAppConfig(e)})}static getAppConfig(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getAppConfig()})}static getExternalUserId(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getExternalUserId()})}static getExternalUserIdAuthHash(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getExternalUserIdAuthHash()})}static getLastNotificationClicked(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getLastNotificationClicked(e)})}static removeNotificationClickedById(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.removeNotificationClickedById(e)})}static removeAllNotificationClicked(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.removeAllNotificationClicked()})}static resetSentUniqueOutcomes(){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.resetSentUniqueOutcomes()})}static getNotificationClickedByUrl(e,t){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getNotificationClickedByUrl(e,t)})}static getNotificationClickedById(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getNotificationClickedById(e)})}static getNotificationReceivedById(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getNotificationReceivedById(e)})}static setExternalUserId(e,t){return Object(n.a)(this,void 0,void 0,function*(){yield v.singletonInstance.setExternalUserId(e,t)})}static setDeviceId(e){return Object(n.a)(this,void 0,void 0,function*(){yield v.singletonInstance.setDeviceId(e)})}static remove(e,t){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.remove(e,t)})}static put(e,t){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.put(e,t)})}static get(e,t){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.get(e,t)})}static getAll(e){return Object(n.a)(this,void 0,void 0,function*(){return yield v.singletonInstance.getAll(e)})}}v.EVENTS=c},function(e,t,i){"use strict";i.d(t,"a",function(){return b});var n=i(0),o=i(14),s=i(20),r=i(6),a=i(10),c=i(15),l=i(11),d=i(9);const u=4e3,g=3001,p=18080,h=["outcomes","on_focus"];class b{static getBuildEnv(){return o.a.Production}static getApiEnv(){return o.a.Production}static getIntegration(e){return Object(n.a)(this,void 0,void 0,function*(){if(l.a.isSafari())return c.a.Secure;const t=window===window.top,i="https:"===window.location.protocol;if(void 0===e){if("undefined"==typeof OneSignal||!OneSignal.context||!OneSignal.context.appConfig)throw new a.a("usingProxyOrigin",a.b.Empty);e=!!OneSignal.context.appConfig.subdomain}if(t)return i?e?c.a.SecureProxy:c.a.Secure:!d.b.isLocalhostAllowedAsSecureOrigin()||"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname?c.a.InsecureProxy:c.a.Secure;if(i){return(yield b.isFrameContextInsecure())?c.a.InsecureProxy:e?c.a.SecureProxy:c.a.Secure}return c.a.InsecureProxy})}static isFrameContextInsecure(){return Object(n.a)(this,void 0,void 0,function*(){if(window===window.top||!("serviceWorker"in navigator)||void 0===navigator.serviceWorker.getRegistration)return!1;return!(yield OneSignal.context.serviceWorkerManager.getRegistration())})}static isInsecureOrigin(){return"http:"===window.location.protocol}static getOrigin(){return l.a.isBrowser()?window.location.origin:"undefined"!=typeof self&&"undefined"!=typeof ServiceWorkerGlobalScope?self.location.origin:"Unknown"}static getWindowEnv(){return"undefined"==typeof window?"undefined"!=typeof self&&"undefined"!=typeof ServiceWorkerGlobalScope?r.a.ServiceWorker:r.a.Unknown:window===window.top?-1!==location.href.indexOf("initOneSignal")||"/subscribe"===location.pathname&&""===location.search&&(location.hostname.endsWith(".onesignal.com")||location.hostname.endsWith(".os.tc")||-1!==location.hostname.indexOf(".localhost")&&b.getBuildEnv()===o.a.Development)?r.a.OneSignalSubscriptionPopup:r.a.Host:"/webPushIframe"===location.pathname?r.a.OneSignalProxyFrame:"/webPushModal"===location.pathname?r.a.OneSignalSubscriptionModal:r.a.CustomIframe}static getTestEnv(){return s.a.None}static getBuildEnvPrefix(e=b.getBuildEnv()){switch(e){case o.a.Development:return"Dev-";case o.a.Staging:return"Staging-";case o.a.Production:return"";default:throw new a.a("buildEnv",a.b.EnumOutOfRange)}}static getOneSignalApiUrl(e=b.getApiEnv(),t){switch(e){case o.a.Development:return b.isTurbineEndpoint(t)?new URL(`https://onesignal.com:${p}/api/v1`):new URL(`https://onesignal.com:${g}/api/v1`);case o.a.Staging:case o.a.Production:return new URL("https://onesignal.com/api/v1");default:throw new a.a("buildEnv",a.b.EnumOutOfRange)}}static getOneSignalResourceUrlPath(e=b.getBuildEnv()){let t;const i=u;switch(e){case o.a.Development:t=`http://localhost:${i}`;break;case o.a.Staging:t="https://localhost";break;case o.a.Production:t="https://onesignal.com";break;default:throw new a.a("buildEnv",a.b.EnumOutOfRange)}return new URL(`${t}/sdks`)}static getOneSignalCssFileName(e=b.getBuildEnv()){switch(e){case o.a.Development:return"Dev-OneSignalSDKStyles.css";case o.a.Staging:return"Staging-OneSignalSDKStyles.css";case o.a.Production:return"OneSignalSDKStyles.css";default:throw new a.a("buildEnv",a.b.EnumOutOfRange)}}static isTurbineEndpoint(e){return!!e&&h.some(t=>e.indexOf(t)>-1)}}},function(e,t,i){"use strict";var n=i(0),o=i(12);class s extends o.a{constructor(e="The asynchronous operation has timed out."){super(e),this.message=e,Object.setPrototypeOf(this,s.prototype)}}var r=i(16);i.d(t,"a",function(){return a});class a{static contains(e,t){return!!e&&-1!==e.indexOf(t)}static getConsoleStyle(e){return"code"==e?'padding: 0 1px 1px 5px;border: 1px solid #ddd;border-radius: 3px;font-family: Monaco,"DejaVu Sans Mono","Courier New",monospace;color: #444;':"bold"==e?"font-weight: 600;color: rgb(51, 51, 51);":"alert"==e?"font-weight: 600;color: red;":"event"==e?"color: green;":"postmessage"==e?"color: orange;":"serviceworkermessage"==e?"color: purple;":""}static trimUndefined(e){for(var t in e)e.hasOwnProperty(t)&&void 0===e[t]&&delete e[t];return e}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static isNullOrUndefined(e){return void 0===e||null===e}static valueOrDefault(e,t){return void 0===e||null===e?t:e}static stringify(e){return JSON.stringify(e,(e,t)=>"function"==typeof t?"[Function]":t,4)}static encodeHashAsUriComponent(e){let t="";const i=Object.keys(e);for(var n of i){const i=e[n];t+=`${encodeURIComponent(n)}=${encodeURIComponent(i)}`}return t}static timeoutPromise(e,t){const i=new Promise((e,i)=>{setTimeout(()=>{i(new s)},t)});return Promise.race([e,i])}static getValueOrDefault(e,t){return void 0!==e&&null!==e?e:t}static padStart(e,t,i){let n=e;for(;n.length<t;)n=i+n;return n}static parseVersionString(e){const t=e.toString().split("."),i=a.padStart(t[0],2,"0");let n;return n=t[1]?a.padStart(t[1],2,"0"):"00",Number(`${i}.${n}`)}static lastParts(e,t,i){const n=e.split(t),o=Math.max(n.length-i,0);return n.slice(o).join(t)}static enforceAppId(e){if(!e)throw new Error("App id cannot be empty")}static enforcePlayerId(e){if(!e)throw new Error("Player id cannot be empty")}static enforceAppIdAndPlayerId(e,t,i){return Object(n.a)(this,void 0,void 0,function*(){a.enforceAppId(e),a.enforcePlayerId(t);try{return yield i()}catch(e){throw e&&Array.isArray(e.errors)&&e.errors.length>0&&a.contains(e.errors[0],"app_id not found")?new r.a(r.b.MissingAppId):e}})}static sortArrayOfObjects(e,t,i=!1,n=!0){const o=n?e:e.slice();return o.sort((e,n)=>{const o=t(e),s=t(n);return o>s?i?-1:1:o<s?i?1:-1:0}),o}}t.b=a},function(e,t,i){"use strict";var n;i.d(t,"a",function(){return n}),function(e){e.ServiceWorker="ServiceWorker",e.Host="Host",e.OneSignalSubscriptionPopup="Popup",e.OneSignalSubscriptionModal="Modal",e.OneSignalProxyFrame="ProxyFrame",e.CustomIframe="CustomFrame",e.Unknown="Unknown"}(n||(n={}))},function(e,t,i){"use strict";i.d(t,"a",function(){return g});var n=i(0),o=i(11),s=i(4),r=i(6),a=i(1),c=i(5);const l=["notifyButtonHovering","notifyButtonHover","notifyButtonButtonClick","notifyButtonLauncherClick","animatedElementHiding","animatedElementHidden","animatedElementShowing","animatedElementShown","activeAnimatedElementActivating","activeAnimatedElementActive","activeAnimatedElementInactivating","activeAnimatedElementInactive","dbRetrieved","dbSet","testEvent"],d=["onesignal.prompt.custom.clicked","onesignal.prompt.native.permissionchanged","onesignal.subscription.changed","onesignal.internal.subscriptionset","dbRebuilt","initialize","subscriptionSet","sendWelcomeNotification","subscriptionChange","notificationPermissionChange","dbSet","register","notificationDisplay","notificationDismiss","notificationClick","permissionPromptDisplay","testWouldDisplay","testInitOptionDisabled","popupWindowTimeout"],u={notificationPermissionChange:"onesignal.prompt.native.permissionchanged",subscriptionChange:"onesignal.subscription.changed",customPromptClick:"onesignal.prompt.custom.clicked"};class g{static trigger(e,t,i=null){return Object(n.a)(this,void 0,void 0,function*(){if(!c.b.contains(l,e)){let n=t,o=c.b.capitalize(s.a.getWindowEnv().toString());i&&(o=`${o} ⬸ ${c.b.capitalize(i)}`),n||!1===n?a.a.debug(`(${o}) » %c${e}:`,c.b.getConsoleStyle("event"),n):a.a.debug(`(${o}) » %c${e}`,c.b.getConsoleStyle("event"))}if(o.a.isBrowser()){if(e===OneSignal.EVENTS.SDK_INITIALIZED){if(OneSignal.initialized)return;OneSignal.initialized=!0}yield OneSignal.emitter.emit(e,t)}if(u.hasOwnProperty(e)){let i=u[e];g._triggerLegacy(i,t)}if(o.a.isBrowser()&&(s.a.getWindowEnv()===r.a.OneSignalSubscriptionPopup||s.a.getWindowEnv()===r.a.OneSignalProxyFrame)){opener||parent?c.b.contains(d,e)&&(s.a.getWindowEnv()===r.a.OneSignalSubscriptionPopup?OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.REMOTE_RETRIGGER_EVENT,{eventName:e,eventData:t}):OneSignal.proxyFrame.retriggerRemoteEvent(e,t)):a.a.error(`Could not send event '${e}' back to host page because no creator (opener or parent) found!`)}})}static _triggerLegacy(e,t){const i=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:t});window.dispatchEvent(i)}}},function(e,t,i){var n;n=function(){var e=!0;function t(t){function i(e){var i=t.match(e);return i&&i.length>1&&i[1]||""}var n,o,s,r=i(/(ipod|iphone|ipad)/i).toLowerCase(),a=!/like android/i.test(t)&&/android/i.test(t),c=/nexus\s*[0-6]\s*/i.test(t),l=!c&&/nexus\s*[0-9]+/i.test(t),d=/CrOS/.test(t),u=/silk/i.test(t),g=/sailfish/i.test(t),p=/tizen/i.test(t),h=/(web|hpw)os/i.test(t),b=/windows phone/i.test(t),f=(/SamsungBrowser/i.test(t),!b&&/windows/i.test(t)),m=!r&&!u&&/macintosh/i.test(t),S=!a&&!g&&!p&&!h&&/linux/i.test(t),v=i(/edge\/(\d+(\.\d+)?)/i),O=i(/version\/(\d+(\.\d+)?)/i),y=/tablet/i.test(t)&&!/tablet pc/i.test(t),w=!y&&/[^-]mobi/i.test(t),E=/xbox/i.test(t);/opera/i.test(t)?n={name:"Opera",opera:e,version:O||i(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?n={name:"Opera",opera:e,version:i(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||O}:/SamsungBrowser/i.test(t)?n={name:"Samsung Internet for Android",samsungBrowser:e,version:O||i(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?n={name:"Opera Coast",coast:e,version:O||i(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?n={name:"Yandex Browser",yandexbrowser:e,version:O||i(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?n={name:"UC Browser",ucbrowser:e,version:i(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?n={name:"Maxthon",maxthon:e,version:i(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?n={name:"Epiphany",epiphany:e,version:i(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?n={name:"Puffin",puffin:e,version:i(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?n={name:"Sleipnir",sleipnir:e,version:i(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?n={name:"K-Meleon",kMeleon:e,version:i(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:b?(n={name:"Windows Phone",windowsphone:e},v?(n.msedge=e,n.version=v):(n.msie=e,n.version=i(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?n={name:"Internet Explorer",msie:e,version:i(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:d?n={name:"Chrome",chromeos:e,chromeBook:e,chrome:e,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(t)?n={name:"Microsoft Edge",msedge:e,version:v}:/vivaldi/i.test(t)?n={name:"Vivaldi",vivaldi:e,version:i(/vivaldi\/(\d+(\.\d+)?)/i)||O}:g?n={name:"Sailfish",sailfish:e,version:i(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?n={name:"SeaMonkey",seamonkey:e,version:i(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(n={name:"Firefox",firefox:e,version:i(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(n.firefoxos=e)):u?n={name:"Amazon Silk",silk:e,version:i(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?n={name:"PhantomJS",phantom:e,version:i(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?n={name:"SlimerJS",slimer:e,version:i(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?n={name:"BlackBerry",blackberry:e,version:O||i(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:h?(n={name:"WebOS",webos:e,version:O||i(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(n.touchpad=e)):/bada/i.test(t)?n={name:"Bada",bada:e,version:i(/dolfin\/(\d+(\.\d+)?)/i)}:p?n={name:"Tizen",tizen:e,version:i(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||O}:/qupzilla/i.test(t)?n={name:"QupZilla",qupzilla:e,version:i(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||O}:/chromium/i.test(t)?n={name:"Chromium",chromium:e,version:i(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||O}:/chrome|crios|crmo/i.test(t)?n={name:"Chrome",chrome:e,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:a?n={name:"Android",version:O}:/safari|applewebkit/i.test(t)?(n={name:"Safari",safari:e},O&&(n.version=O)):r?(n={name:"iphone"==r?"iPhone":"ipad"==r?"iPad":"iPod"},O&&(n.version=O)):n=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:i(/googlebot\/(\d+(\.\d+))/i)||O}:{name:i(/^(.*)\/(.*) /),version:(o=/^(.*)\/(.*) /,s=t.match(o),s&&s.length>1&&s[2]||"")},!n.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(n.name=n.name||"Blink",n.blink=e):(n.name=n.name||"Webkit",n.webkit=e),!n.version&&O&&(n.version=O)):!n.opera&&/gecko\//i.test(t)&&(n.name=n.name||"Gecko",n.gecko=e,n.version=n.version||i(/gecko\/(\d+(\.\d+)?)/i)),n.windowsphone||n.msedge||!a&&!n.silk?n.windowsphone||n.msedge||!r?m?n.mac=e:E?n.xbox=e:f?n.windows=e:S&&(n.linux=e):(n[r]=e,n.ios=e):n.android=e;var P="";n.windows?P=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(i(/Windows ((NT|XP)( \d\d?.\d)?)/i)):n.windowsphone?P=i(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.mac?P=(P=i(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):r?P=(P=i(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):a?P=i(/android[ \/-](\d+(\.\d+)*)/i):n.webos?P=i(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?P=i(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?P=i(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(P=i(/tizen[\/\s](\d+(\.\d+)*)/i)),P&&(n.osversion=P);var I=!n.windows&&P.split(".")[0];return y||l||"ipad"==r||a&&(3==I||I>=4&&!w)||n.silk?n.tablet=e:(w||"iphone"==r||"ipod"==r||a||c||n.blackberry||n.webos||n.bada)&&(n.mobile=e),n.msedge||n.msie&&n.version>=10||n.yandexbrowser&&n.version>=15||n.vivaldi&&n.version>=1||n.chrome&&n.version>=20||n.samsungBrowser&&n.version>=4||n.firefox&&n.version>=20||n.safari&&n.version>=6||n.opera&&n.version>=10||n.ios&&n.osversion&&n.osversion.split(".")[0]>=6||n.blackberry&&n.version>=10.1||n.chromium&&n.version>=20?n.a=e:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6||n.chromium&&n.version<20?n.c=e:n.x=e,n}var i=t("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function o(e,t){var i,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(i=0;i<e.length;i++)n.push(t(e[i]));return n}function s(e){for(var t=Math.max(n(e[0]),n(e[1])),i=o(e,function(e){var i=t-n(e);return o((e+=new Array(i+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(i[0][t]>i[1][t])return 1;if(i[0][t]!==i[1][t])return-1;if(0===t)return 0}}function r(e,n,o){var r=i;"string"==typeof n&&(o=n,n=void 0),void 0===n&&(n=!1),o&&(r=t(o));var a=""+r.version;for(var c in e)if(e.hasOwnProperty(c)&&r[c]){if("string"!=typeof e[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(e));return s([a,e[c]])<0}return n}return i.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in i)return!0}return!1},i.isUnsupportedBrowser=r,i.compareVersions=s,i.check=function(e,t,i){return!r(e,t,i)},i._detect=t,i},void 0!==e&&e.exports?e.exports=n():i(28)("bowser",n)},function(e,t,i){"use strict";(function(e){i.d(t,"a",function(){return d});var n=i(8),o=i.n(n),s=i(4),r=i(11),a=i(6),c=i(1),l=i(5);class d{static getBaseUrl(){return location.origin}static isLocalhostAllowedAsSecureOrigin(){return OneSignal.config&&OneSignal.config.userConfig&&!0===OneSignal.config.userConfig.allowLocalhostAsSecureOrigin}static isUsingSubscriptionWorkaround(){const e=s.a.getWindowEnv();if(!OneSignal.config)throw new Error(`(${e.toString()}) isUsingSubscriptionWorkaround() cannot be called until OneSignal.config exists.`);if(o.a.safari)return!1;const t=this.isLocalhostAllowedAsSecureOrigin();return d.internalIsUsingSubscriptionWorkaround(OneSignal.config.subdomain,t)}static internalIsUsingSubscriptionWorkaround(e,t){if(o.a.safari)return!1;if(!0===t&&("localhost"===location.hostname||"127.0.0.1"===location.hostname))return!1;const i=s.a.getWindowEnv();return!(i!==a.a.Host&&i!==a.a.CustomIframe||!e&&"http:"!==location.protocol)}static redetectBrowserUserAgent(){return""===o.a.name&&""===o.a.version?o.a._detect(navigator.userAgent):o.a}static isValidUuid(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/.test(e)}static getRandomUuid(){let t="";const i="undefined"==typeof window?e.crypto:window.crypto||window.msCrypto;return t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i?function(e){var t=i.getRandomValues(new Uint8Array(1))[0]%16|0;return("x"==e?t:3&t|8).toString(16)}:function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}static logMethodCall(e,...t){return c.a.debug(`Called %c${e}(${t.map(l.a.stringify).join(", ")})`,l.a.getConsoleStyle("code"),".")}static isHttps(){return d.isSafari()?"https:"===window.location.protocol:!d.isUsingSubscriptionWorkaround()}static isSafari(){return r.a.isBrowser()&&void 0!==window.safari}}t.b=d}).call(this,i(27))},function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return InvalidArgumentError});var n,o=i(12);!function(e){e[e.Empty=0]="Empty",e[e.Malformed=1]="Malformed",e[e.EnumOutOfRange=2]="EnumOutOfRange"}(n||(n={}));class InvalidArgumentError extends o.a{constructor(e,t){let i;switch(t){case n.Empty:i=`Supply a non-empty value to '${e}'.`;break;case n.Malformed:i=`The value for '${e}' was malformed.`;break;case n.EnumOutOfRange:i=`The value for '${e}' was out of range of the expected input enum.`}super(i),this.argument=e,this.reason=n[t],Object.setPrototypeOf(this,InvalidArgumentError.prototype)}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(4),o=i(6),s=i(8),r=i.n(s);class a{static isBrowser(){return"undefined"!=typeof window}static isSafari(){return a.isBrowser()&&r.a.safari}static version(){return Number(151302)}static get TRADITIONAL_CHINESE_LANGUAGE_TAG(){return["tw","hant"]}static get SIMPLIFIED_CHINESE_LANGUAGE_TAG(){return["cn","hans"]}static getLanguage(){let e=navigator.language;if(e){let t=(e=e.toLowerCase()).split("-");if("zh"==t[0]){for(let e of a.TRADITIONAL_CHINESE_LANGUAGE_TAG)if(-1!==t.indexOf(e))return"zh-Hant";for(let e of a.SIMPLIFIED_CHINESE_LANGUAGE_TAG)if(-1!==t.indexOf(e))return"zh-Hans";return"zh-Hant"}return t[0].substring(0,2)}return"en"}static supportsServiceWorkers(){switch(n.a.getWindowEnv()){case o.a.ServiceWorker:return!0;default:return"undefined"!=typeof navigator&&"serviceWorker"in navigator}}static getSdkStylesVersionHash(){return"undefined"==typeof __SRC_STYLESHEETS_MD5_HASH__?"2":__SRC_STYLESHEETS_MD5_HASH__}}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});class n extends Error{constructor(e=""){super(e),Object.defineProperty(this,"message",{configurable:!0,enumerable:!1,value:e,writable:!0}),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:this.constructor.name,writable:!0}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,this.constructor):(Object.defineProperty(this,"stack",{configurable:!0,enumerable:!1,value:new Error(e).stack,writable:!0}),Object.setPrototypeOf(this,n.prototype))}}},function(e,t,i){"use strict";var n,o;i.d(t,"c",function(){return n}),i.d(t,"b",function(){return o}),i.d(t,"a",function(){return s}),i.d(t,"d",function(){return r}),function(e){e.Active="active",e.Inactive="inactive",e.Expired="expired"}(n||(n={})),function(e){e[e.PlayerCreate=1]="PlayerCreate",e[e.PlayerOnSession=2]="PlayerOnSession",e[e.VisibilityVisible=3]="VisibilityVisible",e[e.VisibilityHidden=4]="VisibilityHidden",e[e.BeforeUnload=5]="BeforeUnload",e[e.PageRefresh=6]="PageRefresh",e[e.Focus=7]="Focus",e[e.Blur=8]="Blur"}(o||(o={}));const s="oneSignalSession";function r(e){const t=(new Date).getTime(),i=e&&e.sessionKey||s,o=e&&e.notificationId||null;return{sessionKey:i,appId:e.appId,deviceId:e.deviceId,deviceType:e.deviceType,startTimestamp:t,accumulatedDuration:0,notificationId:o,status:n.Active,lastDeactivatedTimestamp:null,lastActivatedTimestamp:t}}},function(e,t,i){"use strict";var n;i.d(t,"a",function(){return n}),function(e){e.Development="Development",e.Staging="Staging",e.Production="Production"}(n||(n={}))},function(e,t,i){"use strict";var n;i.d(t,"a",function(){return n}),function(e){e.Secure="Secure",e.SecureProxy="Secure Proxy",e.InsecureProxy="Insecure Proxy"}(n||(n={}))},function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return s});var n,o=i(12);!function(e){e[e.MissingAppId=0]="MissingAppId"}(n||(n={}));class s extends o.a{constructor(e){let t;switch(e){case n.MissingAppId:t="The API call is missing an app ID."}super(t),Object.setPrototypeOf(this,s.prototype)}}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(0),o=i(3),s=i(7);class r{static triggerNotificationPermissionChanged(e=!1){return Object(n.a)(this,void 0,void 0,function*(){const t=yield OneSignal.privateGetNotificationPermission();(t!==(yield o.a.get("Options","notificationPermission"))||e)&&(yield o.a.put("Options",{key:"notificationPermission",value:t}),s.a.trigger(OneSignal.EVENTS.NATIVE_PROMPT_PERMISSIONCHANGED,{to:t}))})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0);class o{constructor(){this._events={}}on(e,t){return this._events[e]=this._events[e]||[],this._events[e].push(t),this}once(e,t){const i=this;function n(){i.off(e,n),t.apply(this,arguments)}return n.listener=t,this.on(e,n),this}off(e,t){const i=this._events[e];if(void 0!==i){for(let e=0;e<i.length;e+=1)if(i[e]===t||i[e].listener===t){i.splice(e,1);break}0===i.length&&this.removeAllListeners(e)}return this}removeAllListeners(e){try{e?delete this._events[e]:this._events={}}catch(e){}return this}listeners(e){try{return this._events[e]}catch(e){return}}numberOfListeners(e){const t=this.listeners(e);return t?t.length:0}emit(...e){return Object(n.a)(this,void 0,void 0,function*(){const t=e.shift();let i=this._events[t];if(void 0!==i){const t=(i=i.slice(0)).length;for(let n=0;n<t;n+=1)yield i[n].apply(this,e)}return this})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return n});class n{constructor(e,t,i){this.emailId=e,this.emailAddress=t,this.identifierAuthHash=i}serialize(){return{identifierAuthHash:this.identifierAuthHash,emailAddress:this.emailAddress,emailId:this.emailId}}static deserialize(e){return new n(e.emailId,e.emailAddress,e.identifierAuthHash)}}},function(e,t,i){"use strict";var n;i.d(t,"a",function(){return n}),function(e){e.None="None",e.UnitTesting="Unit Testing"}(n||(n={}))},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(11);class o{static decodeHtmlEntities(e){return n.a.isBrowser()&&(o.decodeTextArea||(o.decodeTextArea=document.createElement("textarea"))),o.decodeTextArea?(o.decodeTextArea.innerHTML=e,o.decodeTextArea.value):e}}o.decodeTextArea=null},function(e,t,i){"use strict";i.d(t,"a",function(){return n});class n{serialize(){return{deviceId:this.deviceId,subscriptionToken:this.subscriptionToken,optedOut:this.optedOut,createdAt:this.createdAt,expirationTime:this.expirationTime}}static deserialize(e){const t=new n;return t.deviceId=e.deviceId,t.subscriptionToken=e.subscriptionToken,t.optedOut=e.optedOut,t.createdAt=e.createdAt,t.expirationTime=e.expirationTime,t}}},function(e,t,i){"use strict";i.d(t,"a",function(){return c});var n=i(0),o=i(18),s=i(1),r=i(5);const a=3;class c{constructor(e){this.databaseName=e,this.emitter=new o.a}open(e){return new Promise(t=>{let i=void 0;try{i=indexedDB.open(e,a)}catch(e){}if(!i)return null;i.onerror=this.onDatabaseOpenError,i.onblocked=this.onDatabaseOpenBlocked,i.onupgradeneeded=this.onDatabaseUpgradeNeeded,i.onsuccess=(()=>{this.database=i.result,this.database.onerror=this.onDatabaseError,this.database.onversionchange=this.onDatabaseVersionChange,t(this.database)})})}ensureDatabaseOpen(){return Object(n.a)(this,void 0,void 0,function*(){return this.openLock||(this.openLock=this.open(this.databaseName)),yield this.openLock})}onDatabaseOpenError(e){e.preventDefault();const t=e.target.error;r.b.contains(t.message,"The operation failed for reasons unrelated to the database itself and not covered by any other error code")||r.b.contains(t.message,"A mutation operation was attempted on a database that did not allow mutations")?s.a.warn("OneSignal: IndexedDb web storage is not available on this origin since this profile's IndexedDb schema has been upgraded in a newer version of Firefox. See: https://bugzilla.mozilla.org/show_bug.cgi?id=1236557#c6"):s.a.warn("OneSignal: Fatal error opening IndexedDb database:",t)}onDatabaseError(e){s.a.debug("IndexedDb: Generic database error",e.target.errorCode)}onDatabaseOpenBlocked(){s.a.debug("IndexedDb: Blocked event")}onDatabaseVersionChange(e){s.a.debug("IndexedDb: versionchange event")}onDatabaseUpgradeNeeded(e){s.a.debug("IndexedDb: Database is being rebuilt or upgraded (upgradeneeded event).");const t=e.target.result;e.oldVersion<1&&(t.createObjectStore("Ids",{keyPath:"type"}),t.createObjectStore("NotificationOpened",{keyPath:"url"}),t.createObjectStore("Options",{keyPath:"key"})),e.oldVersion<2&&(t.createObjectStore("Sessions",{keyPath:"sessionKey"}),t.createObjectStore("NotificationReceived",{keyPath:"notificationId"}),t.createObjectStore("NotificationClicked",{keyPath:"notificationId"})),e.oldVersion<3&&t.createObjectStore("SentUniqueOutcome",{keyPath:"outcomeName"}),"undefined"!=typeof OneSignal&&(OneSignal._isNewVisitor=!0)}get(e,t){return Object(n.a)(this,void 0,void 0,function*(){const i=yield this.ensureDatabaseOpen();return t?yield new Promise((n,o)=>{const s=i.transaction(e).objectStore(e).get(t);s.onsuccess=(()=>{n(s.result)}),s.onerror=(()=>{o(s.error)})}):yield new Promise((t,n)=>{let o={},s=i.transaction(e).objectStore(e).openCursor();s.onsuccess=(e=>{const i=e.target.result;if(i){let e=i.key;o[e]=i.value,i.continue()}else t(o)}),s.onerror=(()=>{n(s.error)})})})}getAll(e){return Object(n.a)(this,void 0,void 0,function*(){return yield new Promise((t,i)=>Object(n.a)(this,void 0,void 0,function*(){let n=(yield this.ensureDatabaseOpen()).transaction(e).objectStore(e).openCursor();const o=[];n.onsuccess=(e=>{const i=e.target.result;i?(o.push(i.value),i.continue()):t(o)}),n.onerror=(()=>{i(n.error)})}))})}put(e,t){return Object(n.a)(this,void 0,void 0,function*(){return yield this.ensureDatabaseOpen(),yield new Promise((i,n)=>{try{let o=this.database.transaction([e],"readwrite").objectStore(e).put(t);o.onsuccess=(()=>{i(t)}),o.onerror=(e=>{s.a.error("Database PUT Transaction Error:",e),n(e)})}catch(e){s.a.error("Database PUT Error:",e),n(e)}})})}remove(e,t){return Object(n.a)(this,void 0,void 0,function*(){const i=yield this.ensureDatabaseOpen();return new Promise((n,o)=>{try{const r=i.transaction([e],"readwrite").objectStore(e),a=t?r.delete(t):r.clear();a.onsuccess=(()=>{n(t)}),a.onerror=(e=>{s.a.error("Database REMOVE Transaction Error:",e),o(e)})}catch(e){s.a.error("Database REMOVE Error:",e),o(e)}})})}}},function(e,t){e.exports=function(e,t,o){"function"==typeof t&&(o=t,t={});t||(t={});var s,r,a=t.prefix||"__jp",c=t.name||a+i++,l=t.param||"callback",d=null!=t.timeout?t.timeout:6e4,u=encodeURIComponent,g=document.getElementsByTagName("script")[0]||document.head;d&&(r=setTimeout(function(){p(),o&&o(new Error("Timeout"))},d));function p(){s.parentNode&&s.parentNode.removeChild(s),window[c]=n,r&&clearTimeout(r)}return window[c]=function(e){p(),o&&o(null,e)},e=(e+=(~e.indexOf("?")?"&":"?")+l+"="+u(c)).replace("?&","?"),(s=document.createElement("script")).src=e,g.parentNode.insertBefore(s,g),function(){window[c]&&p()}};var i=0;function n(){}},function(e,t,i){"use strict";i.r(t);var n=i(1),o=i(2);class s{static doReplay(e){e&&(Array.isArray(e)?s.processAsArray(e):e.constructor&&"OneSignalStubES6"===e.constructor.name?s.processAsES6Stub(e):n.a.error("window.OneSignal is an unexpected type! Should be an Array, OneSignalStubES6, or undefined."))}static processAsArray(e){for(const t of e)try{OneSignal.push(t)}catch(e){n.a.error(e)}}static processAsES6Stub(e){e.SERVICE_WORKER_PATH&&(OneSignal.SERVICE_WORKER_PATH=e.SERVICE_WORKER_PATH),e.SERVICE_WORKER_UPDATER_PATH&&(OneSignal.SERVICE_WORKER_UPDATER_PATH=e.SERVICE_WORKER_UPDATER_PATH),e.currentLogLevel&&OneSignal.log.setLevel(e.currentLogLevel),e.SERVICE_WORKER_PARAM&&(OneSignal.SERVICE_WORKER_PARAM=e.SERVICE_WORKER_PARAM),e.preExistingArray&&s.processAsArray(e.preExistingArray);for(const t of e.directFunctionCallsArray){const e=OneSignal[t.functionName].apply(OneSignal,t.args);t.delayedPromise&&e instanceof Promise&&e.then(function(...e){t.delayedPromise&&t.delayedPromise.resolve&&t.delayedPromise.resolve.apply(null,e)}).catch(function(...e){t.delayedPromise&&t.delayedPromise.reject&&t.delayedPromise.reject.apply(null,e)})}}}"undefined"!=typeof window&&function(){if(Object(o.p)(),Object(o.n)()>1)return n.a.warn("OneSignal: The web push SDK is included more than once. For optimal performance, please include our SDK only once on your page."),void n.a.debug("OneSignal: Exiting from SDK initialization to prevent double-initialization errors. "+`Occurred ${Object(o.n)()} times.`);const e=window.OneSignal;window.OneSignal=i(26).default,s.doReplay(e)}()},function(e,t,i){"use strict";i.r(t);var n,o,s,r,a,c,l,d=i(0),u=i(8),g=i.n(u),p=i(11),InvalidArgumentError=i(10),h=i(12);!function(e){e[e.HttpsPermissionRequest="HTTPS permission request"]="HttpsPermissionRequest",e[e.FullscreenHttpPermissionMessage="fullscreen HTTP permission message"]="FullscreenHttpPermissionMessage",e[e.FullscreenHttpsPermissionMessage="fullscreen HTTPS permission message"]="FullscreenHttpsPermissionMessage",e[e.SlidedownPermissionMessage="slidedown permission message"]="SlidedownPermissionMessage",e[e.SubscriptionBell="subscription bell"]="SubscriptionBell"}(n||(n={})),(s=o||(o={}))[s.MissingAppId=0]="MissingAppId",s[s.RedundantPermissionMessage=1]="RedundantPermissionMessage",s[s.PushPermissionAlreadyGranted=2]="PushPermissionAlreadyGranted",s[s.UnsupportedEnvironment=3]="UnsupportedEnvironment",s[s.MissingDomElement=4]="MissingDomElement",s[s.ServiceWorkerNotActivated=5]="ServiceWorkerNotActivated",s[s.NoProxyFrame=6]="NoProxyFrame";class b extends h.a{constructor(e,t){let i;switch(e){case o.MissingAppId:i="Missing required app ID.";break;case o.RedundantPermissionMessage:let s="";t&&t.permissionPromptType&&(s=`(${n[t.permissionPromptType]})`),i=`Another permission message ${s} is being displayed.`;break;case o.PushPermissionAlreadyGranted:i="Push permission has already been granted.";break;case o.UnsupportedEnvironment:i="The current environment does not support this operation.";break;case o.ServiceWorkerNotActivated:i="The service worker must be activated first.";break;case o.NoProxyFrame:i="No proxy frame."}super(i),this.description=o[e],this.reason=e,Object.setPrototypeOf(this,b.prototype)}}(a=r||(r={}))[a.Unknown=0]="Unknown",a[a.NoDeviceId=1]="NoDeviceId",a[a.NoEmailSet=2]="NoEmailSet",a[a.OptedOut=3]="OptedOut";class f extends h.a{constructor(e){let t;switch(e){case r.Unknown||r.NoDeviceId:t="This operation can only be performed after the user is subscribed.";break;case r.NoEmailSet:t="No email is currently set.";break;case r.OptedOut:t="The user has manually opted out of receiving of notifications. This operation can only be performed after the user is fully resubscribed."}super(t),this.reason=r[e],Object.setPrototypeOf(this,f.prototype)}}(l=c||(c={}))[l.InvalidAppId=0]="InvalidAppId",l[l.AppNotConfiguredForWebPush=1]="AppNotConfiguredForWebPush",l[l.MissingSubdomain=2]="MissingSubdomain",l[l.WrongSiteUrl=3]="WrongSiteUrl",l[l.MultipleInitialization=4]="MultipleInitialization",l[l.MissingSafariWebId=5]="MissingSafariWebId",l[l.Unknown=6]="Unknown";class m extends h.a{constructor(e,t){let i;switch(e){case c.InvalidAppId:i="OneSignal: This app ID does not match any existing app. Double check your app ID.";break;case c.AppNotConfiguredForWebPush:i="OneSignal: This app ID does not have any web platforms enabled. Double check your app ID, or see step 1 on our setup guide (https://goo.gl/01h7fZ).";break;case c.MissingSubdomain:i="OneSignal: Non-HTTPS pages require a subdomain of OneSignal to be chosen on your dashboard. See step 1.4 on our setup guide (https://goo.gl/xip6JB).";break;case c.WrongSiteUrl:i=t&&t.siteUrl?`OneSignal: This web push config can only be used on ${new URL(t.siteUrl).origin}.`+` Your current origin is ${location.origin}.`:"OneSignal: This web push config can not be used on the current site.";break;case c.MultipleInitialization:i="OneSignal: The OneSignal web SDK can only be initialized once. Extra initializations are ignored. Please remove calls initializing the SDK more than once.";break;case c.MissingSafariWebId:i="OneSignal: Safari browser support on Mac OS X requires the Safari web platform to be enabled. Please see the Safari Support steps in our web setup guide.";break;case c.Unknown:i="OneSignal: An unknown initialization error occurred."}super(i),this.reason=c[e],Object.setPrototypeOf(this,m.prototype)}}var S=i(7);class v{static put(e,t){return void 0===v.store[e]&&(v.store[e]=[null,null]),v.store[e].push(t),v.store[e].length==v.LIMIT+1&&v.store[e].shift(),v.store[e]}static get(e){return void 0===v.store[e]&&(v.store[e]=[null,null]),v.store[e]}static getFirst(e){return v.get(e)[0]}static getLast(e){return v.get(e)[1]}static remove(e){delete v.store[e]}static isEmpty(e){let t=v.get(e);return null===t[0]&&null===t[1]}}v.store={},v.LIMIT=2;var O,y=i(16);class w extends h.a{constructor(){super("This code is not implemented yet."),Object.setPrototypeOf(this,w.prototype)}}!function(e){e[e.ChromeLike=5]="ChromeLike",e[e.Safari=7]="Safari",e[e.Firefox=8]="Firefox",e[e.Edge=12]="Edge",e[e.Email=11]="Email"}(O||(O={}));var E=i(9);class P{constructor(){this.language=p.a.getLanguage(),this.timezone=-60*(new Date).getTimezoneOffset(),this.timezoneId=Intl.DateTimeFormat().resolvedOptions().timeZone;const e=parseInt(String(g.a.version),10);this.browserVersion=isNaN(e)?-1:e,this.deviceModel=navigator.platform,this.sdkVersion=p.a.version().toString(),this.deliveryPlatform=this.getDeliveryPlatform()}isSafari(){return g.a.safari&&void 0!==window.safari&&void 0!==window.safari.pushNotification}getDeliveryPlatform(){const e=E.a.redetectBrowserUserAgent();return this.isSafari()?O.Safari:e.firefox?O.Firefox:e.msedge?O.Edge:O.ChromeLike}serialize(){const e={device_type:this.deliveryPlatform,language:this.language,timezone:this.timezone,timezone_id:this.timezoneId,device_os:this.browserVersion,device_model:this.deviceModel,sdk:this.sdkVersion,notification_types:this.subscriptionState};return this.appId&&(e.app_id=this.appId),e}deserialize(e){throw new w}}class I extends P{constructor(e,t,i){super(),this.email=e,this.identifierAuthHash=t,this.pushDeviceRecordId=i,this.deliveryPlatform=O.Email}serialize(){const e=super.serialize();return this.email&&(e.identifier=this.email),this.identifierAuthHash&&(e.identifier_auth_hash=this.identifierAuthHash),this.pushDeviceRecordId&&(e.device_player_id=this.pushDeviceRecordId),e}deserialize(e){throw new w}}var C=i(4),T=i(5),A=i(1);class N{static get(e,t,i){return N.call("GET",e,t,i)}static post(e,t,i){return N.call("POST",e,t,i)}static put(e,t,i){return N.call("PUT",e,t,i)}static delete(e,t,i){return N.call("DELETE",e,t,i)}static call(e,t,i,n){if("GET"===e){if(t.indexOf("players")>-1&&-1===t.indexOf("app_id="))return console.error("Calls to player api are not permitted without app_id"),Promise.reject(new y.a(y.b.MissingAppId))}else if(t.indexOf("players")>-1&&(!i||!i.app_id))return console.error("Calls to player api are not permitted without app_id"),Promise.reject(new y.a(y.b.MissingAppId));let o=new Headers;if(o.append("Origin",C.a.getOrigin()),o.append("SDK-Version",`onesignal/web/${p.a.version()}`),o.append("Content-Type","application/json;charset=UTF-8"),n)for(let e of Object.keys(n))o.append(e,n[e]);const s={method:e||"NO_METHOD_SPECIFIED",headers:o,cache:"no-cache"};let r;return i&&(s.body=JSON.stringify(i)),fetch(C.a.getOneSignalApiUrl(void 0,t).toString()+"/"+t,s).then(e=>(r=e.status,e.json())).then(e=>{if(r>=200&&r<300)return e;if("no-user-id-error"!==N.identifyError(e))return Promise.reject(e)}).catch(e=>(A.a.warn(`Could not complete request to /${t}`,e),Promise.reject(e)))}static identifyError(e){if(!e||!e.errors)return"no-error";let t=e.errors;return T.a.contains(t,"No user with this id found")||T.a.contains(t,"Could not find app_id for given player id.")?"no-user-id-error":"unknown-error"}}var M=N;class k{static getPlayer(e,t){return T.b.enforceAppId(e),T.b.enforcePlayerId(t),M.get(`players/${t}?app_id=${e}`)}static updatePlayer(e,t,i){return T.b.enforceAppId(e),T.b.enforcePlayerId(t),M.put(`players/${t}`,Object.assign({app_id:e},i))}static sendNotification(e,t,i,n,o,s,r,a){var c={app_id:e,contents:n,include_player_ids:t,isAnyWeb:!0,data:r,web_buttons:a};return i&&(c.headings=i),o&&(c.url=o),s&&(c.chrome_web_icon=s,c.firefox_icon=s),T.b.trimUndefined(c),M.post("notifications",c)}static createUser(e){return Object(d.a)(this,void 0,void 0,function*(){const t=e.serialize();T.b.enforceAppId(t.app_id);const i=yield M.post("players",t);return i&&i.success?i.id:null})}static createEmailRecord(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){T.b.enforceAppId(e.appId);const n=new I(t.emailAddress,t.identifierAuthHash,i);n.appId=e.appId;const o=yield M.post("players",n.serialize());return o&&o.success?o.id:null})}static updateEmailRecord(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){T.b.enforceAppId(e.appId),T.b.enforcePlayerId(t.emailId);const n=new I(t.emailAddress,t.identifierAuthHash,i);n.appId=e.appId;const o=yield M.put(`players/${t.emailId}`,n.serialize());return o&&o.success?o.id:null})}static logoutEmail(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){T.b.enforceAppId(e.appId),T.b.enforcePlayerId(i);const n=yield M.post(`players/${i}/email_logout`,{app_id:e.appId,parent_player_id:t.emailId,identifier_auth_hash:t.identifierAuthHash?t.identifierAuthHash:void 0});return!(!n||!n.success)})}static updateUserSession(e,t){return Object(d.a)(this,void 0,void 0,function*(){try{const i=t.serialize();T.b.enforceAppId(i.app_id),T.b.enforcePlayerId(e);const n=yield M.post(`players/${e}/on_session`,i);return n.id?n.id:e}catch(e){throw e&&Array.isArray(e.errors)&&e.errors.length>0&&T.b.contains(e.errors[0],"app_id not found")?new y.a(y.b.MissingAppId):e}})}static sendOutcome(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.info("Outcome payload:",e);try{yield M.post("outcomes/measure",e)}catch(e){A.a.error("sendOutcome",e)}})}}var x=i(3),_=i(2);class j{static initialize(e){return Object(d.a)(this,void 0,void 0,function*(){if(!e||!e.enabled)return;if(A.a.info("Inititalize CustomLink"),0!==(yield OneSignal.context.dynamicResourceLoader.loadSdkStylesheet()))return void A.a.debug("Not initializing custom link button because styles failed to load.");document.querySelectorAll(j.containerSelector).forEach(t=>{j.isInitialized(t)||j.injectMarkup(t,e)});const t=yield OneSignal.privateIsPushNotificationsEnabled(),i=yield OneSignal.internalIsOptedOut();document.querySelectorAll(j.subscribeSelector).forEach(n=>j.initSubscribeElement(n,e,t,i)),document.querySelectorAll(j.explanationSelector).forEach(i=>j.initExplanationElement(i,e,t))})}static injectMarkup(e,t){if(t.text){if(e.innerHTML="",t.text.explanation){const t=document.createElement("p");Object(_.a)(t,j.explanationClass),e.appendChild(t)}if(t.text.subscribe){const t=document.createElement("button");Object(_.a)(t,j.subscribeClass),e.appendChild(t)}j.markAsInitialized(e)}else A.a.error("CustomLink: required property 'text' is missing in the config")}static initSubscribeElement(e,t,i,n){t.text&&t.text.subscribe&&(i||(e.textContent=t.text.subscribe)),t.text&&t.text.unsubscribe&&i&&(e.textContent=t.text.unsubscribe),j.setResetClass(e),j.setStateClass(e,i),j.setStyleClass(e,t),j.setSizeClass(e,t),j.setCustomColors(e,t),!0!==t.unsubscribeEnabled&&Object(_.a)(e,"hide"),e.setAttribute(j.subscriptionStateAttribute,i.toString()),e.setAttribute(j.optedOutAttribute,n.toString()),j.isInitialized(e)||(e.addEventListener("click",()=>{A.a.info("CustomLink: subscribe clicked"),j.handleClick(e)}),j.markAsInitialized(e))}static handleClick(e){return Object(d.a)(this,void 0,void 0,function*(){const t="true"===e.getAttribute(j.subscriptionStateAttribute),i="true"===e.getAttribute(j.optedOutAttribute);if(t){(yield OneSignal.privateIsPushNotificationsEnabled())&&(yield OneSignal.setSubscription(!1))}else if(i)yield OneSignal.setSubscription(!0);else{const e={autoAccept:!OneSignal.environmentInfo.requiresUserInteraction};yield OneSignal.registerForPushNotifications(e)}})}static initExplanationElement(e,t,i){t.text&&t.text.explanation&&(e.textContent=t.text.explanation),j.setResetClass(e),j.setStateClass(e,i),j.setSizeClass(e,t),!0!==t.unsubscribeEnabled&&Object(_.a)(e,"hide")}static setCustomColors(e,t){"button"===t.style&&t.color&&t.color.button&&t.color.text?(e.style.backgroundColor=t.color.button,e.style.color=t.color.text):"link"===t.style&&t.color&&t.color.text&&(e.style.color=t.color.text)}static setStateClass(e,t){const i=t?"state-unsubscribed":"state-subscribed",n=t?"state-subscribed":"state-unsubscribed";Object(_.o)(e,i)&&Object(_.v)(e,i),Object(_.o)(e,n)||Object(_.a)(e,n)}static setStyleClass(e,t){if(!t||!t.style)return;const i=t.style;Object(_.o)(e,i)||Object(_.a)(e,i)}static setSizeClass(e,t){if(!t||!t.size)return;const i=t.size;Object(_.o)(e,i)||Object(_.a)(e,i)}static setResetClass(e){const t=j.resetClass;Object(_.o)(e,t)||Object(_.a)(e,t)}static markAsInitialized(e){e.setAttribute(j.initializedAttribute,"true")}static isInitialized(e){return"true"===e.getAttribute(j.initializedAttribute)}}j.initializedAttribute="data-cl-initialized",j.subscriptionStateAttribute="data-cl-state",j.optedOutAttribute="data-cl-optedout",j.containerClass="onesignal-customlink-container",j.containerSelector=`.${j.containerClass}`,j.subscribeClass="onesignal-customlink-subscribe",j.subscribeSelector=`.${j.subscribeClass}`,j.explanationClass="onesignal-customlink-explanation",j.explanationSelector=`.${j.explanationClass}`,j.resetClass="onesignal-reset";var D,R,U=i(21);!function(e){e.Native="native",e.Push="push",e.Category="category",e.Sms="sms",e.Email="email",e.SmsAndEmail="smsAndEmail"}(D||(D={}));class W{static isCategorySlidedownConfigured(e){if(!e)return!1;const t=W.getFirstSlidedownPromptOptionsWithType(e,D.Category);return!!t&&(!!t.categories&&t.categories.length>0)}static isCategorySlidedownConfiguredVersion1(e){var t,i;return((null===(i=null===(t=null===e||void 0===e?void 0:e.categories)||void 0===t?void 0:t.tags)||void 0===i?void 0:i.length)||0)>0}static getFirstSlidedownPromptOptionsWithType(e,t){return e?e.filter(e=>e.type===t)[0]:void 0}static isSlidedownAutoPromptConfigured(e){if(!e)return!1;for(let t=0;t<e.length;t++)if(e[t].autoPrompt)return!0;return!1}}!function(e){e.Default="default",e.Granted="granted",e.Denied="denied"}(R||(R={}));class B{static get STORED_PERMISSION_KEY(){return"storedNotificationPermission"}getNotificationPermission(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield this.getReportedNotificationPermission(e);return(yield this.isPermissionEnvironmentAmbiguous(t))?yield this.getInterpretedAmbiguousPermission(t):t})}getReportedNotificationPermission(e){return Object(d.a)(this,void 0,void 0,function*(){if(g.a.safari)return B.getSafariNotificationPermission(e);if(E.b.isUsingSubscriptionWorkaround())return yield this.getOneSignalSubdomainNotificationPermission(e);{const e=this.getW3cNotificationPermission();return(yield this.isPermissionEnvironmentAmbiguous(e))?yield this.getInterpretedAmbiguousPermission(e):this.getW3cNotificationPermission()}})}static getSafariNotificationPermission(e){if(e)return window.safari.pushNotification.permission(e).permission;throw new InvalidArgumentError.a("safariWebId",InvalidArgumentError.b.Empty)}getW3cNotificationPermission(){return Notification.permission}getOneSignalSubdomainNotificationPermission(e){return Object(d.a)(this,void 0,void 0,function*(){return new Promise(t=>{OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION,{safariWebId:e},e=>{const i=e.data;t(i)})})})}isPermissionEnvironmentAmbiguous(e){return Object(d.a)(this,void 0,void 0,function*(){const t=E.b.redetectBrowserUserAgent();return!t.safari&&!t.firefox&&e===R.Denied&&(this.isCurrentFrameContextCrossOrigin()||(yield C.a.isFrameContextInsecure())||E.b.isUsingSubscriptionWorkaround()||C.a.isInsecureOrigin())})}isCurrentFrameContextCrossOrigin(){let e;try{e=window.top.location.origin}catch(e){return!0}return window.top!==window&&e!==window.location.origin}getInterpretedAmbiguousPermission(e){return Object(d.a)(this,void 0,void 0,function*(){switch(e){case R.Denied:const t=this.getStoredPermission();return t||R.Default;default:return e}})}getStoredPermission(){return H.getStoredPermission()}setStoredPermission(e){H.setStoredPermission(e)}updateStoredPermission(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield this.getNotificationPermission();return this.setStoredPermission(e)})}}const L="isOptedOut",V="isPushNotificationsEnabled",F="os_pageViews";class H{static getIsOptedOut(){return"true"===localStorage.getItem(L)}static getIsPushNotificationsEnabled(){return"true"===localStorage.getItem(V)}static setIsOptedOut(e){localStorage.setItem(L,e.toString())}static setIsPushNotificationsEnabled(e){localStorage.setItem(V,e.toString())}static setStoredPermission(e){localStorage.setItem(B.STORED_PERMISSION_KEY,e)}static getStoredPermission(){switch(localStorage.getItem(B.STORED_PERMISSION_KEY)||"default"){case"granted":return R.Granted;case"denied":return R.Denied;default:return R.Default}}static setLocalPageViewCount(e){localStorage.setItem(F,e.toString())}static getLocalPageViewCount(){return Number(localStorage.getItem(F))}}class ${static onNotificationPermissionChange(){$.checkAndTriggerSubscriptionChanged()}static onInternalSubscriptionSet(e){return Object(d.a)(this,void 0,void 0,function*(){v.put("subscription.optedOut",e)})}static checkAndTriggerSubscriptionChanged(){return Object(d.a)(this,void 0,void 0,function*(){E.a.logMethodCall("checkAndTriggerSubscriptionChanged");const e=yield OneSignal.context.subscriptionManager.getSubscriptionState(),t=yield OneSignal.privateIsPushNotificationsEnabled(),i=yield x.a.getAppState(),{lastKnownPushEnabled:n}=i;(null===n||t!==n)&&(A.a.info("The user's subscription state changed from "+`${null===n?"(not stored)":n} ⟶ ${e.subscribed}`),H.setIsPushNotificationsEnabled(t),i.lastKnownPushEnabled=t,yield x.a.setAppState(i),$.triggerSubscriptionChanged(t))})}static _onSubscriptionChanged(e){return Object(d.a)(this,void 0,void 0,function*(){$.onSubscriptionChanged_showWelcomeNotification(e),$.onSubscriptionChanged_sendCategorySlidedownTags(e),$.onSubscriptionChanged_evaluateNotifyButtonDisplayPredicate(),$.onSubscriptionChanged_updateCustomLink()})}static onSubscriptionChanged_sendCategorySlidedownTags(e){return Object(d.a)(this,void 0,void 0,function*(){var t,i;if(!0!==e)return;const n=null===(i=null===(t=OneSignal.context.appConfig.userConfig.promptOptions)||void 0===t?void 0:t.slidedown)||void 0===i?void 0:i.prompts;W.isCategorySlidedownConfigured(n)&&(yield OneSignal.context.tagManager.sendTags(!1))})}static onSubscriptionChanged_showWelcomeNotification(e){return Object(d.a)(this,void 0,void 0,function*(){if(OneSignal.__doNotShowWelcomeNotification)A.a.debug("Not showing welcome notification because user has previously subscribed.");else if(!0===e){const{deviceId:e}=yield x.a.getSubscription(),{appId:t}=yield x.a.getAppConfig();let i=OneSignal.config.userConfig.welcomeNotification,n=void 0!==i&&!0===i.disable,o=void 0!==i&&void 0!==i.title&&null!==i.title?i.title:"",s=void 0!==i&&void 0!==i.message&&null!==i.message&&i.message.length>0?i.message:"Thanks for subscribing!",r=new URL(location.href).origin+"?_osp=do_not_open",a=i&&i.url&&i.url.length>0?i.url:r;o=U.a.decodeHtmlEntities(o),s=U.a.decodeHtmlEntities(s),n||(A.a.debug("Sending welcome notification."),k.sendNotification(t,[e],{en:o},{en:s},a,null,{__isOneSignalWelcomeNotification:!0},void 0),S.a.trigger(OneSignal.EVENTS.WELCOME_NOTIFICATION_SENT,{title:o,message:s,url:a}))}})}static onSubscriptionChanged_evaluateNotifyButtonDisplayPredicate(){return Object(d.a)(this,void 0,void 0,function*(){if(!OneSignal.config.userConfig.notifyButton)return;const e=OneSignal.config.userConfig.notifyButton.displayPredicate;if(e&&"function"==typeof e&&OneSignal.notifyButton){!1!==(yield e())?(A.a.debug("Showing notify button because display predicate returned true."),OneSignal.notifyButton.launcher.show()):(A.a.debug("Hiding notify button because display predicate returned false."),OneSignal.notifyButton.launcher.hide())}})}static onSubscriptionChanged_updateCustomLink(){return Object(d.a)(this,void 0,void 0,function*(){OneSignal.config.userConfig.promptOptions&&(yield j.initialize(OneSignal.config.userConfig.promptOptions.customlink))})}static triggerSubscriptionChanged(e){S.a.trigger(OneSignal.EVENTS.SUBSCRIPTION_CHANGED,e)}static fireStoredNotificationClicks(e=document.URL){return Object(d.a)(this,void 0,void 0,function*(){function t(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield x.a.getAppState();t.clickedNotifications[e.url]=null,yield x.a.setAppState(t);const{data:i,timestamp:n}=e;if(n){if((Date.now()-n)/1e3/60>5)return}S.a.trigger(OneSignal.EVENTS.NOTIFICATION_CLICKED,i)})}const i=yield x.a.getAppState();if("origin"===(yield x.a.get("Options","notificationClickHandlerMatch"))){for(const e of Object.keys(i.clickedNotifications))if(new URL(e).origin===location.origin){yield t(i.clickedNotifications[e])}}else{var n=i.clickedNotifications[e];if(n)yield t(n);else if(!n&&e.endsWith("/")){var o=e.substring(0,e.length-1);(n=i.clickedNotifications[o])&&(yield t(n))}}})}}var z,G=i(6);class K{static promiseStub(){return{then:K.promiseStub,catch:K.promiseStub}}static ensureBackwardsCompatibility(e){K.environmentPolyfill(e),K.postmams(e),e.syncHashedEmail=K.promiseStub}static environmentPolyfill(e){e.environment={},e.environment.getEnv=function(){return""},e.environment.isPopup=function(){return C.a.getWindowEnv()===G.a.OneSignalSubscriptionPopup},e.environment.isIframe=function(){return C.a.getWindowEnv()===G.a.OneSignalProxyFrame}}static postmams(e){const t=function(){this.messenger.message.apply(this.messenger,arguments)},i=function(){this.messenger.postMessage.apply(this.messenger,arguments)};function n(e){e.message=t,e.postMessage=i}e.proxyFrame&&(e.iframePostmam=e.proxyFrame,n(e.iframePostmam)),e.subscriptionPopup&&(e.popupPostmam=e.subscriptionPopup,n(e.popupPostmam)),e.subscriptionModal&&(e.modalPostmam=e.subscriptionModal,n(e.modalPostmam))}}class q{static isLocalStorageSupported(){try{return"undefined"!=typeof localStorage&&(localStorage.getItem("test"),!0)}catch(e){return!1}}static setItem(e,t,i){if(!q.isLocalStorageSupported())return;const n=void 0!==i?60*i*1e3:0,o={value:JSON.stringify(t),timestamp:void 0!==i?(new Date).getTime()+n:void 0};localStorage.setItem(e,JSON.stringify(o))}static getItem(e){if(!q.isLocalStorageSupported())return null;const t=localStorage.getItem(e);let i;try{i=JSON.parse(t)}catch(e){return null}if(null===i)return null;if(i.timestamp&&(new Date).getTime()>=i.timestamp)return localStorage.removeItem(e),null;let n=i.value;try{n=JSON.parse(i.value)}catch(e){return n}return n}static removeItem(e){if(!q.isLocalStorageSupported())return null;localStorage.removeItem(e)}}!function(e){e[e.Default=0]="Default",e[e.Subscribed=1]="Subscribed",e[e.MutedByApi=-2]="MutedByApi",e[e.NotSubscribed=-10]="NotSubscribed",e[e.TemporaryWebRecord=-20]="TemporaryWebRecord",e[e.PermissionRevoked=-21]="PermissionRevoked",e[e.PushSubscriptionRevoked=-22]="PushSubscriptionRevoked",e[e.ServiceWorkerStatus403=-23]="ServiceWorkerStatus403",e[e.ServiceWorkerStatus404=-24]="ServiceWorkerStatus404"}(z||(z={}));class Y extends P{constructor(e){super(),this.subscription=e}serialize(){const e=super.serialize();return this.subscription&&(e.identifier=g.a.safari?this.subscription.safariDeviceToken:this.subscription.w3cEndpoint?this.subscription.w3cEndpoint.toString():null,e.web_auth=this.subscription.w3cAuth,e.web_p256=this.subscription.w3cP256dh),e}static createFromPushSubscription(e,t,i){const n=new Y(t);return n.appId=e,n.subscriptionState=t?z.Subscribed:z.NotSubscribed,i&&(n.subscriptionState=i),n}deserialize(e){throw new w}}var J,Z,X=i(17);(Z=J||(J={}))[Z.Blocked=0]="Blocked",Z[Z.Dismissed=1]="Dismissed",Z[Z.Default=2]="Default";class Q extends h.a{constructor(e){let t;switch(e){case J.Dismissed:t="The user dismissed the permission prompt.";break;case J.Blocked:t="Notification permissions are blocked.";break;case J.Default:t="Notification permissions have not been granted yet."}super(t),this.reason=e,Object.setPrototypeOf(this,Q.prototype)}}class ee{isNewSubscription(){return this.existingW3cPushSubscription?!!this.existingW3cPushSubscription.w3cEndpoint!=!!this.w3cEndpoint||(!(!this.existingW3cPushSubscription.w3cEndpoint||!this.w3cEndpoint||this.existingW3cPushSubscription.w3cEndpoint.toString()===this.w3cEndpoint.toString())||(this.existingW3cPushSubscription.w3cP256dh!==this.w3cP256dh||this.existingW3cPushSubscription.w3cAuth!==this.w3cAuth)):!this.existingSafariDeviceToken||this.existingSafariDeviceToken!==this.safariDeviceToken}static setFromW3cSubscription(e){const t=new ee;if(e&&(t.w3cEndpoint=new URL(e.endpoint),e.getKey)){let i=null;try{i=e.getKey("p256dh")}catch(e){}let n=null;try{n=e.getKey("auth")}catch(e){}if(i){let e=btoa(String.fromCharCode.apply(null,new Uint8Array(i)));t.w3cP256dh=e}if(n){let e=btoa(String.fromCharCode.apply(null,new Uint8Array(n)));t.w3cAuth=e}}return t}setFromSafariSubscription(e){this.safariDeviceToken=e}serialize(){return{w3cEndpoint:this.w3cEndpoint?this.w3cEndpoint.toString():null,w3cP256dh:this.w3cP256dh,w3cAuth:this.w3cAuth,safariDeviceToken:this.safariDeviceToken,existingPushSubscription:this.existingW3cPushSubscription?this.existingW3cPushSubscription.serialize():null,existingSafariDeviceToken:this.existingSafariDeviceToken}}static deserialize(e){const t=new ee;if(!e)return t;try{t.w3cEndpoint=new URL(e.w3cEndpoint)}catch(e){}return t.w3cP256dh=e.w3cP256dh,t.w3cAuth=e.w3cAuth,t.existingW3cPushSubscription=void 0,e.existingW3cPushSubscription?t.existingW3cPushSubscription=ee.deserialize(e.existingW3cPushSubscription):e.existingPushSubscription&&(t.existingW3cPushSubscription=ee.deserialize(e.existingPushSubscription)),t.safariDeviceToken=e.safariDeviceToken,t.existingSafariDeviceToken=e.existingSafariDeviceToken,t}}var te,ie=i(13);!function(e){e.Safari="safari",e.Firefox="firefox",e.Chrome="chrome",e.Opera="opera",e.Edge="edge",e.Other="other"}(te||(te={}));class ne{static registerForPush(){return Object(d.a)(this,void 0,void 0,function*(){const e=H.getIsPushNotificationsEnabled();return yield ne.internalRegisterForPush(e)})}static internalRegisterForPush(e){return Object(d.a)(this,void 0,void 0,function*(){const t=OneSignal.context;let i=null;if(e&&!t.pageViewManager.isFirstPageView()){A.a.debug("Not registering for push because the user is subscribed and this is not the first page view."),A.a.debug("But we want to rekindle their session.");const e=yield oe.getDeviceId();if(e){const t=yield oe.createDeviceRecord(OneSignal.config.appId,!0);yield OneSignal.context.sessionManager.upsertSession(e,t,ie.b.PageRefresh)}else A.a.error("Should have been impossible to have push as enabled but no device id.");return null}if("undefined"!=typeof OneSignal){if(OneSignal._isRegisteringForPush)return null;OneSignal._isRegisteringForPush=!0}switch(C.a.getWindowEnv()){case G.a.Host:case G.a.OneSignalSubscriptionModal:try{const e=yield t.subscriptionManager.subscribe(0);i=yield t.subscriptionManager.registerSubscription(e),t.pageViewManager.incrementPageViewCount(),yield X.a.triggerNotificationPermissionChanged(),yield $.checkAndTriggerSubscriptionChanged()}catch(e){A.a.info(e)}break;case G.a.OneSignalSubscriptionPopup:const e=opener||parent;let n;yield t.permissionManager.updateStoredPermission();try{n=yield t.subscriptionManager.subscribe(1),yield t.permissionManager.updateStoredPermission()}catch(i){if(yield t.permissionManager.updateStoredPermission(),i instanceof Q)switch(i.reason){case J.Blocked:yield t.permissionManager.updateStoredPermission(),OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION_CHANGED,{permission:R.Denied,forceUpdatePermission:!1});break;case J.Dismissed:OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION_CHANGED,{permission:R.Default,forceUpdatePermission:!0})}if(e)return window.close(),null}OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.FINISH_REMOTE_REGISTRATION,{rawPushSubscription:n.serialize()},t=>{!0===t.data.progress?(A.a.debug("Got message from host page that remote reg. is in progress, closing popup."),e&&window.close()):A.a.debug("Got message from host page that remote reg. could not be finished.")});break;default:throw"undefined"!=typeof OneSignal&&(OneSignal._isRegisteringForPush=!1),new b(o.UnsupportedEnvironment)}return"undefined"!=typeof OneSignal&&(OneSignal._isRegisteringForPush=!1),i})}static getRawPushSubscriptionForSafari(e){const t=new ee,{deviceToken:i}=window.safari.pushNotification.permission(e);return t.existingSafariDeviceToken=i,t}static getRawPushSubscriptionFromServiceWorkerRegistration(e){return Object(d.a)(this,void 0,void 0,function*(){if(!e)return null;const t=yield e.pushManager.getSubscription();return t?ee.setFromW3cSubscription(t):null})}static getRawPushSubscriptionWhenUsingSubscriptionWorkaround(){return Object(d.a)(this,void 0,void 0,function*(){return null})}static getRawPushSubscription(e,t){return Object(d.a)(this,void 0,void 0,function*(){if(e.browserType===te.Safari)return ne.getRawPushSubscriptionForSafari(t);if(e.isUsingSubscriptionWorkaround)return ne.getRawPushSubscriptionWhenUsingSubscriptionWorkaround();if(e.isBrowserAndSupportsServiceWorkers){const e=yield OneSignal.context.serviceWorkerManager.getRegistration();return yield ne.getRawPushSubscriptionFromServiceWorkerRegistration(e)}return null})}}class oe{static getCurrentNotificationType(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.context.appConfig.safariWebId);if(e===R.Default)return z.Default;if(e===R.Denied)return E.a.isUsingSubscriptionWorkaround()?z.Default:z.NotSubscribed;const t=yield OneSignal.context.subscriptionManager.isAlreadyRegisteredWithOneSignal();if(e===R.Granted&&t){return(yield OneSignal.privateIsPushNotificationsEnabled())?z.Subscribed:z.MutedByApi}return z.Default})}static getNotificationTypeFromOptIn(e){return 1==e||null==e?z.Subscribed:z.MutedByApi}static wasHttpsNativePromptDismissed(){return"dismissed"===q.getItem("onesignal-notification-prompt")}static markHttpSlidedownShown(){sessionStorage.setItem("ONESIGNAL_HTTP_PROMPT_SHOWN","true")}static isHttpPromptAlreadyShown(){return"true"==sessionStorage.getItem("ONESIGNAL_HTTP_PROMPT_SHOWN")}static checkAndTriggerNotificationPermissionChanged(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield x.a.get("Options","notificationPermission"),t=yield OneSignal.getNotificationPermission();e!==t&&(yield X.a.triggerNotificationPermissionChanged(),yield x.a.put("Options",{key:"notificationPermission",value:t}))})}static getNotificationIcons(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield oe.getAppId();if(!e)throw new b(o.MissingAppId);const t=`${C.a.getOneSignalApiUrl().toString()}/apps/${e}/icon`,i=yield(yield fetch(t)).json();if(i.errors)throw A.a.error(`API call %c${t}`,T.a.getConsoleStyle("code"),"failed with:",i.errors),new Error("Failed to get notification icons.");return i})}static getSlidedownOptions(e){return T.a.getValueOrDefault(e.slidedown,{prompts:[]})}static getFullscreenPermissionMessageOptions(e){return e?e.fullscreen?{autoAcceptTitle:e.fullscreen.autoAcceptTitle,actionMessage:e.fullscreen.actionMessage,exampleNotificationTitleDesktop:e.fullscreen.title,exampleNotificationTitleMobile:e.fullscreen.title,exampleNotificationMessageDesktop:e.fullscreen.message,exampleNotificationMessageMobile:e.fullscreen.message,exampleNotificationCaption:e.fullscreen.caption,acceptButton:e.fullscreen.acceptButton,cancelButton:e.fullscreen.cancelButton}:e:null}static getPromptOptionsQueryString(){let e="";if(oe.getFullscreenPermissionMessageOptions(OneSignal.config.userConfig.promptOptions)){let t=oe.getPromptOptionsPostHash();for(let i of Object.keys(t)){e+="&"+i+"="+t[i]}}return e}static getPromptOptionsPostHash(){let e=oe.getFullscreenPermissionMessageOptions(OneSignal.config.userConfig.promptOptions);if(e){var t={exampleNotificationTitleDesktop:"exampleNotificationTitle",exampleNotificationMessageDesktop:"exampleNotificationMessage",exampleNotificationTitleMobile:"exampleNotificationTitle",exampleNotificationMessageMobile:"exampleNotificationMessage"};for(let i of Object.keys(t)){let n=t[i];e[i]&&(e[n]=e[i])}for(var i=["autoAcceptTitle","siteName","autoAcceptTitle","subscribeText","showGraphic","actionMessage","exampleNotificationTitle","exampleNotificationMessage","exampleNotificationCaption","acceptButton","cancelButton","timeout"],n={},o=0;o<i.length;o++){var s=i[o],r=e[s],a=encodeURIComponent(r);(r||!1===r||""===r)&&(n[s]=a)}}return n}static triggerCustomPromptClicked(e){S.a.trigger(OneSignal.EVENTS.CUSTOM_PROMPT_CLICKED,{result:e})}static getAppId(){return Object(d.a)(this,void 0,void 0,function*(){if(OneSignal.config.appId)return Promise.resolve(OneSignal.config.appId);return yield x.a.get("Ids","appId")})}static createDeviceRecord(e,t=!1){return Object(d.a)(this,void 0,void 0,function*(){let i;if(t){const e=yield ne.getRawPushSubscription(OneSignal.environmentInfo,OneSignal.config.safariWebId);e&&(i=e)}const n=new Y(i);return n.appId=e,n.subscriptionState=yield oe.getCurrentNotificationType(),n})}static getDeviceId(){return Object(d.a)(this,void 0,void 0,function*(){return(yield OneSignal.database.getSubscription()).deviceId||void 0})}}var se,re,ae=i(18);class ce{constructor(e,t,i){if(this.windowReference=e,this.sendToOrigin=t,this.receiveFromOrigin=i,!window||!window.postMessage)throw new Error("Must pass in a valid window reference supporting postMessage():"+e);if(!t||!i)throw new Error("Invalid origin. Must be set.");this.emitter=new ae.a,this.channel=new MessageChannel,this.messagePort=null,this.isListening=!1,this.isConnected=!1,this.replies={}}static get HANDSHAKE_MESSAGE(){return"onesignal.postmam.handshake"}static get CONNECTED_MESSAGE(){return"onesignal.postmam.connected"}listen(){A.a.debug("(Postmam) Called listen()."),this.isListening?A.a.debug("(Postmam) Already listening for Postmam connections."):p.a.isBrowser()&&(this.isListening=!0,A.a.debug("(Postmam) Listening for Postmam connections.",this),window.addEventListener("message",this.onWindowMessagePostmanConnectReceived.bind(this)))}startPostMessageReceive(){window.addEventListener("message",this.onWindowPostMessageReceived.bind(this))}stopPostMessageReceive(){window.removeEventListener("message",this.onWindowPostMessageReceived)}destroy(){this.stopPostMessageReceive(),this.emitter.removeAllListeners()}onWindowPostMessageReceived(e){if(!this.isSafeOrigin(e.origin))return;let{id:t,command:i,data:n,source:o}=e.data;if(i===ce.CONNECTED_MESSAGE)return this.emitter.emit("connect"),void(this.isConnected=!0);let s={id:t,command:i,data:n,source:o},r=Object.assign({reply:this.reply.bind(this,s)},s);if(this.replies.hasOwnProperty(t)){A.a.info("(Postmam) This message is a reply."),!1===this.replies[t].bind(window)(r)&&delete this.replies[t]}else this.emitter.emit(i,r)}onWindowMessagePostmanConnectReceived(e){const t=C.a.getWindowEnv().toString();if(A.a.debug(`(Postmam) (${t}) Window postmessage for Postman connect received:`,e),this.isSafeOrigin(e.origin)){var{handshake:i}=e.data;i===ce.HANDSHAKE_MESSAGE?(A.a.info("(Postmam) Got our expected Postmam handshake message (and connecting...):",e.data),window.removeEventListener("message",this.onWindowMessagePostmanConnectReceived),this.messagePort=e.ports[0],this.messagePort.addEventListener("message",this.onMessageReceived.bind(this),!1),A.a.info("(Postmam) Removed previous message event listener for handshakes, replaced with main message listener."),this.messagePort.start(),this.isConnected=!0,A.a.info(`(Postmam) (${t}) Connected.`),this.message(ce.CONNECTED_MESSAGE),this.emitter.emit("connect")):A.a.info("(Postmam) Got a postmam message, but not our expected handshake:",e.data)}}connect(){A.a.info(`(Postmam) (${C.a.getWindowEnv().toString()}) Establishing a connection to ${this.sendToOrigin}.`),this.messagePort=this.channel.port1,this.messagePort.addEventListener("message",this.onMessageReceived.bind(this),!1),this.messagePort.start(),this.windowReference.postMessage({handshake:ce.HANDSHAKE_MESSAGE},this.sendToOrigin,[this.channel.port2])}onMessageReceived(e){if(!e.data)return void A.a.debug(`(${C.a.getWindowEnv().toString()}) Received an empty Postmam message:`,e);let{id:t,command:i,data:n,source:o}=e.data;if(i===ce.CONNECTED_MESSAGE)return this.emitter.emit("connect"),void(this.isConnected=!0);let s={id:t,command:i,data:n,source:o},r=Object.assign({reply:this.reply.bind(this,s)},s);if(this.replies.hasOwnProperty(t)){!1===this.replies[t].bind(window)(r)&&delete this.replies[t]}else this.emitter.emit(i,r)}reply(e,t,i){const n={id:e.id,command:e.command,data:t,source:C.a.getWindowEnv().toString(),isReply:!0};"function"==typeof i&&(this.replies[n.id]=i),this.messagePort.postMessage(n)}postMessage(e,t,i){if(!e||""==e)throw new Error("(Postmam) Postmam command must not be empty.");if("function"==typeof t)return void A.a.debug("You passed a function to data, did you mean to pass null?");const n={id:E.a.getRandomUuid(),command:e,data:t,source:C.a.getWindowEnv().toString()};"function"==typeof i&&(this.replies[n.id]=i),this.windowReference.postMessage(n,"*")}message(e,t,i){if(!e||""==e)throw new Error("(Postmam) Postmam command must not be empty.");if("function"==typeof t)return void A.a.debug("You passed a function to data, did you mean to pass null?");const n={id:E.a.getRandomUuid(),command:e,data:t,source:C.a.getWindowEnv().toString()};"function"==typeof i&&(this.replies[n.id]=i),this.messagePort.postMessage(n)}generateSafeOrigins(e){const t=[];try{const i=new URL(e);let n=i.host;0===i.host.indexOf("www.")&&(n=i.host.replace("www.","")),"https:"===i.protocol?(t.push(`https://${n}`),t.push(`https://www.${n}`)):"http:"===i.protocol&&(t.push(`http://${n}`),t.push(`http://www.${n}`),t.push(`https://${n}`),t.push(`https://www.${n}`))}catch(e){}return t}isSafeOrigin(e){if(OneSignal.config)t=OneSignal.config.subdomain;else var t="x";const i=this.generateSafeOrigins(this.receiveFromOrigin);return"https://onesignal.com"===e||e===`https://${t||""}.onesignal.com`||e===`https://${t||""}.os.tc`||e===`https://${t||""}.os.tc:3001`||e===C.a.getOneSignalApiUrl().origin||"*"===this.receiveFromOrigin||T.a.contains(i,e)}on(...e){return Object(d.a)(this,void 0,void 0,function*(){return this.emitter.on.apply(this.emitter,e)})}off(...e){return Object(d.a)(this,void 0,void 0,function*(){return this.emitter.off.apply(this.emitter,e)})}once(...e){return Object(d.a)(this,void 0,void 0,function*(){return this.emitter.once.apply(this.emitter,e)})}}class le{constructor(e,t){this.appId=e,this.registrationOptions=t}load(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield OneSignal.isPushNotificationsEnabled(),t=yield OneSignal.getNotificationPermission();this.url=C.a.getOneSignalApiUrl(),this.url.pathname="webPushModal",this.url.search=`${oe.getPromptOptionsQueryString()}&id=${this.appId}&httpsPrompt=true&pushEnabled=${e}&permissionBlocked=${"denied"===t}&promptType=modal`,A.a.info(`Loading iFrame for HTTPS subscription modal at ${this.url.toString()}`),this.modal=this.createHiddenSubscriptionDomModal(this.url.toString()),this.establishCrossOriginMessaging()})}createHiddenSubscriptionDomModal(e){let t=document.createElement("div");t.setAttribute("id","OneSignal-iframe-modal"),t.setAttribute("style","display:none !important"),t.innerHTML='<div id="notif-permission" style="background: rgba(0, 0, 0, 0.7); position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 3000000000; display: flex; align-items: center; justify-content: center;"></div>',document.body.appendChild(t);let i=document.createElement("style");i.innerHTML="@media (max-width: 560px) { .OneSignal-permission-iframe { width: 100%; height: 100%;} }",document.getElementsByTagName("head")[0].appendChild(i);let n=document.createElement("iframe");return n.className="OneSignal-permission-iframe",n.setAttribute("frameborder","0"),n.width=OneSignal._windowWidth.toString(),n.height=OneSignal._windowHeight.toString(),n.src=e,document.getElementById("notif-permission").appendChild(n),n}removeFrame(){const e=document.querySelector("#OneSignal-iframe-modal");e&&e.remove()}showSubscriptionDomModal(){document.getElementById("OneSignal-iframe-modal").setAttribute("style","")}establishCrossOriginMessaging(){this.messenger=new ce(this.modal,this.url.origin,this.url.origin),this.messenger.startPostMessageReceive(),this.messenger.once(OneSignal.POSTMAM_COMMANDS.MODAL_LOADED,this.onModalLoaded.bind(this)),this.messenger.once(OneSignal.POSTMAM_COMMANDS.MODAL_PROMPT_ACCEPTED,this.onModalAccepted.bind(this)),this.messenger.once(OneSignal.POSTMAM_COMMANDS.MODAL_PROMPT_REJECTED,this.onModalRejected.bind(this)),this.messenger.once(OneSignal.POSTMAM_COMMANDS.POPUP_CLOSING,this.onModalClosing.bind(this))}onModalLoaded(e){this.showSubscriptionDomModal(),S.a.trigger("modalLoaded")}onModalAccepted(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug("User accepted the HTTPS modal prompt.",location.origin),OneSignal._sessionInitAlreadyRunning=!1,this.dispose(),oe.triggerCustomPromptClicked("granted"),A.a.debug("Calling setSubscription(true)"),yield ne.registerForPush(),yield OneSignal.setSubscription(!0)})}onModalRejected(e){A.a.debug("User rejected the HTTPS modal prompt."),OneSignal._sessionInitAlreadyRunning=!1,this.dispose(),oe.triggerCustomPromptClicked("denied")}onModalClosing(e){A.a.info("Detected modal is closing."),this.dispose()}dispose(){this.messenger&&this.messenger.destroy(),this.removeFrame()}message(){this.messenger.message.apply(this.messenger,arguments)}}class de{static getRegistration(e){return Object(d.a)(this,void 0,void 0,function*(){try{const t=location.origin+e;return yield navigator.serviceWorker.getRegistration(t)}catch(t){return A.a.warn("[Service Worker Status] Error Checking service worker registration",e,t),null}})}static getAvailableServiceWorker(e){const t=e.active||e.installing||e.waiting;return t||A.a.warn("Could not find an available ServiceWorker instance!"),t}}(re=se||(se={})).WorkerVersion="GetWorkerVersion",re.Subscribe="Subscribe",re.SubscribeNew="SubscribeNew",re.AmpSubscriptionState="amp-web-push-subscription-state",re.AmpSubscribe="amp-web-push-subscribe",re.AmpUnsubscribe="amp-web-push-unsubscribe",re.NotificationDisplayed="notification.displayed",re.NotificationClicked="notification.clicked",re.NotificationDismissed="notification.dismissed",re.RedirectPage="command.redirect",re.SessionUpsert="os.session.upsert",re.SessionDeactivate="os.session.deactivate",re.AreYouVisible="os.page_focused_request",re.AreYouVisibleResponse="os.page_focused_response",re.SetLogging="os.set_sw_logging";class ue{constructor(){this.replies={}}addListener(e,t,i){const n={callback:t,onceListenerOnly:i},o=this.replies[e.toString()];o?o.push(n):this.replies[e.toString()]=[n]}findListenersForMessage(e){return this.replies[e.toString()]||[]}deleteListenerRecords(e){this.replies[e.toString()]=null}deleteAllListenerRecords(){this.replies={}}deleteListenerRecord(e,t){const i=this.replies[e.toString()];if(null!=i)for(let e=i.length-1;e>=0;e--){i[e]===t&&i.splice(e,1)}}}class ge{constructor(e,t=new ue){this.context=e,this.replies=t}broadcast(e,t){return Object(d.a)(this,void 0,void 0,function*(){if(C.a.getWindowEnv()!==G.a.ServiceWorker)return;const i=yield self.clients.matchAll({type:"window",includeUncontrolled:!0});for(const n of i)A.a.debug(`[Worker Messenger] [SW -> Page] Broadcasting '${e.toString()}' to window client ${n.url}.`),n.postMessage({command:e,payload:t})})}unicast(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){if(C.a.getWindowEnv()===G.a.ServiceWorker){if(!i)throw new InvalidArgumentError.a("windowClient",InvalidArgumentError.b.Empty);A.a.debug(`[Worker Messenger] [SW -> Page] Unicasting '${e.toString()}' to window client ${i.url}.`),i.postMessage({command:e,payload:t})}else A.a.debug(`[Worker Messenger] [Page -> SW] Unicasting '${e.toString()}' to service worker.`),this.directPostMessageToSW(e,t)})}directPostMessageToSW(e,t){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug(`[Worker Messenger] [Page -> SW] Direct command '${e.toString()}' to service worker.`);const i=yield this.context.serviceWorkerManager.getRegistration();if(!i)return void A.a.error("`[Worker Messenger] [Page -> SW] Could not get ServiceWorkerRegistration to postMessage!");const n=de.getAvailableServiceWorker(i);n?n.postMessage({command:e,payload:t}):A.a.error("`[Worker Messenger] [Page -> SW] Could not get ServiceWorker to postMessage!")})}listen(){return Object(d.a)(this,void 0,void 0,function*(){if(!p.a.supportsServiceWorkers())return;C.a.getWindowEnv()===G.a.ServiceWorker?(self.addEventListener("message",this.onWorkerMessageReceivedFromPage.bind(this)),A.a.debug("[Worker Messenger] Service worker is now listening for messages.")):yield this.listenForPage()})}listenForPage(){return Object(d.a)(this,void 0,void 0,function*(){navigator.serviceWorker.addEventListener("message",this.onPageMessageReceivedFromServiceWorker.bind(this)),A.a.debug(`(${location.origin}) [Worker Messenger] Page is now listening for messages.`)})}onWorkerMessageReceivedFromPage(e){const t=e.data;if(!t||!t.command)return;const i=this.replies.findListenersForMessage(t.command),n=[],o=[];A.a.debug("[Worker Messenger] Service worker received message:",e.data);for(let e of i)e.onceListenerOnly&&n.push(e),o.push(e);for(let e=n.length-1;e>=0;e--){const i=n[e];this.replies.deleteListenerRecord(t.command,i)}for(let e of o)e.callback.apply(null,[t.payload])}onPageMessageReceivedFromServiceWorker(e){const t=e.data;if(!t||!t.command)return;const i=this.replies.findListenersForMessage(t.command),n=[],o=[];A.a.debug("[Worker Messenger] Page received message:",e.data);for(let e of i)e.onceListenerOnly&&n.push(e),o.push(e);for(let e=n.length-1;e>=0;e--){const i=n[e];this.replies.deleteListenerRecord(t.command,i)}for(let e of o)e.callback.apply(null,[t.payload])}on(e,t){this.replies.addListener(e,t,!1)}once(e,t){this.replies.addListener(e,t,!0)}off(e){e?this.replies.deleteListenerRecords(e):this.replies.deleteAllListenerRecords()}}class pe{constructor(){this.cache={}}getCache(){return Object.assign({},this.cache)}loadSdkStylesheet(){return Object(d.a)(this,void 0,void 0,function*(){const e=C.a.getOneSignalResourceUrlPath(),t=C.a.getOneSignalCssFileName();return yield this.loadIfNew(0,new URL(`${e}/${t}?v=${p.a.getSdkStylesVersionHash()}`))})}loadFetchPolyfill(){return Object(d.a)(this,void 0,void 0,function*(){return yield this.loadIfNew(1,new URL("https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"))})}loadIfNew(e,t){return Object(d.a)(this,void 0,void 0,function*(){return this.cache[t.toString()]||(this.cache[t.toString()]=pe.load(e,t)),yield this.cache[t.toString()]})}static load(e,t){return Object(d.a)(this,void 0,void 0,function*(){try{return yield new Promise((i,n)=>{switch(e){case 1:(o=document.createElement("script")).setAttribute("type","text/javascript"),o.setAttribute("async","async"),o.setAttribute("src",t.toString());break;case 0:var o;(o=document.createElement("link")).setAttribute("rel","stylesheet"),o.setAttribute("href",t.toString())}o.onerror=n,o.onload=i,document.querySelector("head").appendChild(o)}),0}catch(e){return 1}})}}var he=i(15),be=i(22);class fe{constructor(e,t,i,n="shown",o=["opacity","transform"],s,r=500){this.selector=e,this.showClass=t,this.hideClass=i,this.state=n,this.targetTransitionEvents=o,this.nestedContentSelector=s,this.transitionCheckTimeout=r}show(){return this.hidden?new Promise(e=>{this.state="showing",S.a.trigger(fe.EVENTS.SHOWING,this);const t=this.element;if(t?(this.hideClass&&Object(_.v)(t,this.hideClass),this.showClass&&Object(_.a)(t,this.showClass)):A.a.error(`(show) could not find animated element with selector ${this.selector}`),0==this.targetTransitionEvents.length)return e(this);var i=setTimeout(()=>{A.a.debug(`Element did not completely show (state: ${this.state}).`)},this.transitionCheckTimeout);Object(_.u)(this.element,"transitionend",(t,n)=>{if(t.target===this.element&&Object(_.f)(this.targetTransitionEvents,t.propertyName))return clearTimeout(i),n(),this.state="shown",S.a.trigger(fe.EVENTS.SHOWN,this),e(this)},!0)}):Promise.resolve(this)}hide(){return this.shown?new Promise(e=>{this.state="hiding",S.a.trigger(fe.EVENTS.HIDING,this);const t=this.element;if(t?(this.showClass&&Object(_.v)(t,this.showClass),this.hideClass&&Object(_.a)(t,this.hideClass)):A.a.error(`(hide) could not find animated element with selector ${this.selector}`),0==this.targetTransitionEvents.length)return e(this);Object(_.u)(this.element,"transitionend",(t,i)=>{var n=setTimeout(()=>{A.a.debug(`Element did not completely hide (state: ${this.state}).`)},this.transitionCheckTimeout);if(t.target===this.element&&Object(_.f)(this.targetTransitionEvents,t.propertyName))return clearTimeout(n),i(),this.state="hidden",S.a.trigger(fe.EVENTS.HIDDEN,this),e(this)},!0)}):Promise.resolve(this)}waitUntilShown(){return"shown"===this.state?Promise.resolve(this):new Promise(e=>{ti.emitter.once(fe.EVENTS.SHOWN,t=>{if(t===this)return e(this)})})}waitUntilHidden(){return"hidden"===this.state?Promise.resolve(this):new Promise(e=>{ti.emitter.once(fe.EVENTS.HIDDEN,t=>{if(t===this)return e(this)})})}static get EVENTS(){return{SHOWING:"animatedElementShowing",SHOWN:"animatedElementShown",HIDING:"animatedElementHiding",HIDDEN:"animatedElementHidden"}}get content(){if(!this.element)return"";if(this.nestedContentSelector){const e=this.element.querySelector(this.nestedContentSelector);return e?e.innerHTML:""}return this.element.innerHTML}set content(e){if(this.element)if(this.nestedContentSelector){const t=this.element.querySelector(this.nestedContentSelector);t&&(t.innerHTML=e)}else this.element.innerHTML=e}get element(){return document.querySelector(this.selector)}get showing(){return"showing"===this.state}get shown(){return"shown"===this.state}get hiding(){return"hiding"===this.state}get hidden(){return"hidden"===this.state}}class me extends fe{constructor(e,t,i,n,o,s="shown",r="active",a=["opacity","transform"],c){super(e,t,i,s,a),this.selector=e,this.showClass=t,this.hideClass=i,this.activeClass=n,this.inactiveClass=o,this.state=s,this.activeState=r,this.targetTransitionEvents=a,this.nestedContentSelector=c}activate(){return this.inactive&&this.shown?new Promise(e=>{this.activeState="activating",S.a.trigger(me.EVENTS.ACTIVATING,this);const t=this.element;if(t?(this.inactiveClass&&Object(_.v)(t,this.inactiveClass),this.activeClass&&Object(_.a)(t,this.activeClass)):A.a.error("Could not find active animated element"),!this.shown)return A.a.debug("Ending activate() transition (alternative)."),this.activeState="active",S.a.trigger(me.EVENTS.ACTIVE,this),e(this);if(0==this.targetTransitionEvents.length)return e(this);var i=setTimeout(()=>{A.a.debug(`Element did not completely activate (state: ${this.state}, activeState: ${this.activeState}).`)},this.transitionCheckTimeout);Object(_.u)(this.element,"transitionend",(t,n)=>{if(t.target===this.element&&Object(_.f)(this.targetTransitionEvents,t.propertyName))return clearTimeout(i),n(),this.activeState="active",S.a.trigger(me.EVENTS.ACTIVE,this),e(this)},!0)}):Promise.resolve(this)}inactivate(){return this.active?new Promise(e=>{this.activeState="inactivating",S.a.trigger(me.EVENTS.INACTIVATING,this);const t=this.element;if(t?(this.activeClass&&Object(_.v)(t,this.activeClass),this.inactiveClass&&Object(_.a)(t,this.inactiveClass)):A.a.error("Could not find active animated element"),!this.shown)return this.activeState="inactive",S.a.trigger(me.EVENTS.INACTIVE,this),e(this);if(0==this.targetTransitionEvents.length)return e(this);var i=setTimeout(()=>{A.a.debug(`Element did not completely inactivate (state: ${this.state}, activeState: ${this.activeState}).`)},this.transitionCheckTimeout);Object(_.u)(this.element,"transitionend",(t,n)=>{if(t.target===this.element&&Object(_.f)(this.targetTransitionEvents,t.propertyName))return clearTimeout(i),n(),this.activeState="inactive",S.a.trigger(me.EVENTS.INACTIVE,this),e(this)},!0)}):Promise.resolve(this)}waitUntilActive(){return this.active?Promise.resolve(this):new Promise(e=>{ti.emitter.once(me.EVENTS.ACTIVE,t=>{if(t===this)return e(this)})})}waitUntilInactive(){return this.inactive?Promise.resolve(this):new Promise(e=>{ti.emitter.once(me.EVENTS.INACTIVE,t=>{if(t===this)return e(this)})})}static get EVENTS(){return Object.assign(Object.assign({},fe.EVENTS),{ACTIVATING:"activeAnimatedElementActivating",ACTIVE:"activeAnimatedElementActive",INACTIVATING:"activeAnimatedElementInactivating",INACTIVE:"activeAnimatedElementInactive"})}get activating(){return"activating"===this.activeState}get active(){return"active"===this.activeState}get inactivating(){return"inactivating"===this.activeState}get inactive(){return"inactive"===this.activeState}}class Se extends me{constructor(){super(".onesignal-bell-launcher-badge","onesignal-bell-launcher-badge-opened",null,"onesignal-bell-launcher-badge-active",null,"hidden")}increment(){if(!isNaN(this.content)){let e=+this.content;e+=1,this.content=e.toString()}}show(){const e=super.show();return OneSignal.notifyButton.setCustomColorsIfSpecified(),e}decrement(){if(!isNaN(this.content)){let e=+this.content;e-=1,this.content=e>0?e.toString():""}}}class ve extends fe{constructor(e){super(".onesignal-bell-launcher-message","onesignal-bell-launcher-message-opened",void 0,"hidden",["opacity","transform"],".onesignal-bell-launcher-message-body"),this.bell=e,this.contentType="",this.queued=[]}static get TIMEOUT(){return 2500}static get TYPES(){return{TIP:"tip",MESSAGE:"message",QUEUED:"queued"}}display(e,t,i=0){return A.a.debug(`Calling %cdisplay(${e}, ${t}, ${i}).`,Object(_.k)("code")),(this.shown?this.hide():Object(_.t)()).then(()=>{this.content=Object(_.g)(t),this.contentType=e}).then(()=>this.show()).then(()=>Object(_.i)(i)).then(()=>this.hide()).then(()=>{this.content=this.getTipForState(),this.contentType="tip"})}getTipForState(){return this.bell.state===Ae.STATES.UNSUBSCRIBED?this.bell.options.text["tip.state.unsubscribed"]:this.bell.state===Ae.STATES.SUBSCRIBED?this.bell.options.text["tip.state.subscribed"]:this.bell.state===Ae.STATES.BLOCKED?this.bell.options.text["tip.state.blocked"]:""}enqueue(e){return this.queued.push(Object(_.g)(e)),new Promise(e=>{this.bell.badge.shown?this.bell.badge.hide().then(()=>this.bell.badge.increment()).then(()=>this.bell.badge.show()).then(e):(this.bell.badge.increment(),this.bell.initialized?this.bell.badge.show().then(e):e())})}dequeue(e){let t=this.queued.pop(e);return new Promise(e=>{this.bell.badge.shown?this.bell.badge.hide().then(()=>this.bell.badge.decrement()).then(e=>e>0?this.bell.badge.show():Promise.resolve(this)).then(e(t)):(this.bell.badge.decrement(),e(t))})}}class Oe extends me{constructor(e){super(".onesignal-bell-launcher-button",void 0,void 0,"onesignal-bell-launcher-button-active",void 0,"shown",""),this.bell=e,this.events={mouse:"bell.launcher.button.mouse"};const t=this.element;t&&(t.addEventListener("touchstart",()=>{this.onHovering(),this.onTap()},{passive:!0}),t.addEventListener("mouseenter",()=>{this.onHovering()}),t.addEventListener("mouseleave",()=>{this.onHovered()}),t.addEventListener("touchmove",()=>{this.onHovered()},{passive:!0}),t.addEventListener("mousedown",()=>{this.onTap()}),t.addEventListener("mouseup",()=>{this.onEndTap()}),t.addEventListener("click",()=>{this.onHovered(),this.onClick()}))}onHovering(){(v.isEmpty(this.events.mouse)||"out"===v.getLast(this.events.mouse))&&S.a.trigger(Ae.EVENTS.HOVERING),v.put(this.events.mouse,"over")}onHovered(){v.put(this.events.mouse,"out"),S.a.trigger(Ae.EVENTS.HOVERED)}onTap(){this.pulse(),this.activate(),this.bell.badge.activate()}onEndTap(){this.inactivate(),this.bell.badge.inactivate()}onClick(){if(S.a.trigger(Ae.EVENTS.BELL_CLICK),S.a.trigger(Ae.EVENTS.LAUNCHER_CLICK),!this.bell.message.shown||this.bell.message.contentType!=ve.TYPES.MESSAGE){var e=v.getLast("subscription.optedOut");return this.bell.unsubscribed?e?this.bell.launcher.activateIfInactive().then(()=>{this.bell.showDialogProcedure()}):(ti.registerForPushNotifications(),this.bell._ignoreSubscriptionState=!0,ti.emitter.once(ti.EVENTS.SUBSCRIPTION_CHANGED,()=>{this.bell.message.display(ve.TYPES.MESSAGE,this.bell.options.text["message.action.subscribed"],ve.TIMEOUT).then(()=>{this.bell._ignoreSubscriptionState=!1,this.bell.launcher.inactivate()})})):this.bell.subscribed?this.bell.launcher.activateIfInactive().then(()=>{this.bell.showDialogProcedure()}):this.bell.blocked&&(Object(_.q)()?ti.registerForPushNotifications():this.bell.launcher.activateIfInactive().then(()=>{this.bell.showDialogProcedure()})),this.bell.message.hide()}}pulse(){Object(_.w)(".pulse-ring"),this.element&&Object(_.b)(this.element,"beforeend",'<div class="pulse-ring"></div>'),this.bell.setCustomColorsIfSpecified()}}class ye extends fe{constructor(e){super(".onesignal-bell-launcher-dialog","onesignal-bell-launcher-dialog-opened",void 0,"hidden",["opacity","transform"],".onesignal-bell-launcher-dialog-body"),this.bell=e,this.subscribeButtonId="#onesignal-bell-container .onesignal-bell-launcher #subscribe-button",this.unsubscribeButtonId="#onesignal-bell-container .onesignal-bell-launcher #unsubscribe-button",this.notificationIcons=null}show(){return this.updateBellLauncherDialogBody().then(()=>super.show())}get subscribeButtonSelectorId(){return"subscribe-button"}get unsubscribeButtonSelectorId(){return"unsubscribe-button"}get subscribeButton(){return this.element?this.element.querySelector("#"+this.subscribeButtonSelectorId):null}get unsubscribeButton(){return this.element?this.element.querySelector("#"+this.unsubscribeButtonSelectorId):null}updateBellLauncherDialogBody(){return OneSignal.getSubscription().then(e=>{this.nestedContentSelector&&Object(_.e)(this.nestedContentSelector);let t="Nothing to show.";var i="";if(this.bell.options.showCredit&&(i='<div class="divider"></div><div class="kickback">Powered by <a href="https://onesignal.com" class="kickback" target="_blank">OneSignal</a></div>'),this.bell.state===Ae.STATES.SUBSCRIBED&&!0===e||this.bell.state===Ae.STATES.UNSUBSCRIBED&&!1===e){let e="",n=Object(_.m)(this.notificationIcons);e="default-icon"!=n?`<div class="push-notification-icon"><img src="${n}"></div>`:'<div class="push-notification-icon push-notification-icon-default"></div>';let o="";o=this.bell.state!==Ae.STATES.SUBSCRIBED?`<button type="button" class="action" id="${this.subscribeButtonSelectorId}">${this.bell.options.text["dialog.main.button.subscribe"]}</button>`:`<button type="button" class="action" id="${this.unsubscribeButtonSelectorId}">${this.bell.options.text["dialog.main.button.unsubscribe"]}</button>`,t=`<h1>${this.bell.options.text["dialog.main.title"]}</h1><div class="divider"></div><div class="push-notification">${e}<div class="push-notification-text-container"><div class="push-notification-text push-notification-text-short"></div><div class="push-notification-text"></div><div class="push-notification-text push-notification-text-medium"></div><div class="push-notification-text"></div><div class="push-notification-text push-notification-text-medium"></div></div></div><div class="action-container">${o}</div>${i}`}else if(this.bell.state===Ae.STATES.BLOCKED){let e=null;g.a.chrome?g.a.mobile||g.a.tablet||(e="/bell/chrome-unblock.jpg"):g.a.firefox?e="/bell/firefox-unblock.jpg":g.a.safari?e="/bell/safari-unblock.jpg":g.a.msedge&&(e="/bell/edge-unblock.png");let n="";e&&(n=`<a href="${e=C.a.getOneSignalApiUrl().origin+e}" target="_blank"><img src="${e}"></a></div>`),(g.a.mobile||g.a.tablet)&&g.a.chrome&&(n="<ol><li>Access <strong>Settings</strong> by tapping the three menu dots <strong>⋮</strong></li><li>Click <strong>Site settings</strong> under Advanced.</li><li>Click <strong>Notifications</strong>.</li><li>Find and click this entry for this website.</li><li>Click <strong>Notifications</strong> and set it to <strong>Allow</strong>.</li></ol>"),t=`<h1>${this.bell.options.text["dialog.blocked.title"]}</h1><div class="divider"></div><div class="instructions"><p>${this.bell.options.text["dialog.blocked.message"]}</p>${n}</div>${i}`}this.nestedContentSelector&&Object(_.b)(this.nestedContentSelector,"beforeend",t),this.subscribeButton&&this.subscribeButton.addEventListener("click",()=>{OneSignal.__doNotShowWelcomeNotification=!1,S.a.trigger(Ae.EVENTS.SUBSCRIBE_CLICK)}),this.unsubscribeButton&&this.unsubscribeButton.addEventListener("click",()=>S.a.trigger(Ae.EVENTS.UNSUBSCRIBE_CLICK)),this.bell.setCustomColorsIfSpecified()})}}class we extends me{constructor(e){super(".onesignal-bell-launcher","onesignal-bell-launcher-active",void 0,void 0,"onesignal-bell-launcher-inactive","hidden","active"),this.bell=e,this.wasInactive=!1}resize(e){return Object(d.a)(this,void 0,void 0,function*(){if(!this.element)throw new b(o.MissingDomElement);if("small"===e&&Object(_.o)(this.element,"onesignal-bell-launcher-sm")||"medium"===e&&Object(_.o)(this.element,"onesignal-bell-launcher-md")||"large"===e&&Object(_.o)(this.element,"onesignal-bell-launcher-lg"))return Promise.resolve(this);if(Object(_.v)(this.element,"onesignal-bell-launcher-sm"),Object(_.v)(this.element,"onesignal-bell-launcher-md"),Object(_.v)(this.element,"onesignal-bell-launcher-lg"),"small"===e)Object(_.a)(this.element,"onesignal-bell-launcher-sm");else if("medium"===e)Object(_.a)(this.element,"onesignal-bell-launcher-md");else{if("large"!==e)throw new Error("Invalid OneSignal bell size "+e);Object(_.a)(this.element,"onesignal-bell-launcher-lg")}return this.shown?yield new Promise(e=>{if(0==this.targetTransitionEvents.length)return e(this);var t=setTimeout(()=>{A.a.debug(`Launcher did not completely resize (state: ${this.state}, activeState: ${this.activeState}).`)},this.transitionCheckTimeout);Object(_.u)(this.element,"transitionend",(i,n)=>{if(i.target===this.element&&Object(_.f)(this.targetTransitionEvents,i.propertyName))return clearTimeout(t),n(),e(this)},!0)}):this})}activateIfInactive(){return this.inactive?(this.wasInactive=!0,this.activate()):Object(_.t)()}inactivateIfWasInactive(){return this.wasInactive?(this.wasInactive=!1,this.inactivate()):Object(_.t)()}clearIfWasInactive(){this.wasInactive=!1}inactivate(){return this.bell.message.hide().then(()=>this.bell.badge.content.length>0?this.bell.badge.hide().then(()=>Promise.all([super.inactivate(),this.resize("small")])).then(()=>this.bell.badge.show()):Promise.all([super.inactivate(),this.resize("small")]))}activate(){return this.bell.badge.content.length>0?this.bell.badge.hide().then(()=>Promise.all([super.activate(),this.resize(this.bell.options.size)])):Promise.all([super.activate(),this.resize(this.bell.options.size)])}}var Ee,Pe,Ie,Ce,Te='<svg class="onesignal-bell-svg" xmlns="http://www.w3.org/2000/svg" width="99.7" height="99.7" viewBox="0 0 99.7 99.7"><circle class="background" cx="49.9" cy="49.9" r="49.9"/><path class="foreground" d="M50.1 66.2H27.7s-2-.2-2-2.1c0-1.9 1.7-2 1.7-2s6.7-3.2 6.7-5.5S33 52.7 33 43.3s6-16.6 13.2-16.6c0 0 1-2.4 3.9-2.4 2.8 0 3.8 2.4 3.8 2.4 7.2 0 13.2 7.2 13.2 16.6s-1 11-1 13.3c0 2.3 6.7 5.5 6.7 5.5s1.7.1 1.7 2c0 1.8-2.1 2.1-2.1 2.1H50.1zm-7.2 2.3h14.5s-1 6.3-7.2 6.3-7.3-6.3-7.3-6.3z"/><ellipse class="stroke" cx="49.9" cy="49.9" rx="37.4" ry="36.9"/></svg>';class Ae{constructor(e,t){this.state=Ae.STATES.UNINITIALIZED,this._ignoreSubscriptionState=!1,this.hovering=!1,this.initialized=!1,this.DEFAULT_SIZE="medium",this.DEFAULT_POSITION="bottom-right",this.DEFAULT_THEME="default",this.options={enable:e.enable||!1,size:e.size||this.DEFAULT_SIZE,position:e.position||this.DEFAULT_POSITION,theme:e.theme||this.DEFAULT_THEME,showLauncherAfter:e.showLauncherAfter||10,showBadgeAfter:e.showBadgeAfter||300,text:this.setDefaultTextOptions(e.text||{}),prenotify:e.prenotify,showCredit:e.showCredit,colors:e.colors,offset:e.offset},t&&(this._launcher=t),this.options.enable&&(this.validateOptions(this.options),this.state=Ae.STATES.UNINITIALIZED,this._ignoreSubscriptionState=!1,this.installEventHooks(),this.updateState())}static get EVENTS(){return{STATE_CHANGED:"notifyButtonStateChange",LAUNCHER_CLICK:"notifyButtonLauncherClick",BELL_CLICK:"notifyButtonButtonClick",SUBSCRIBE_CLICK:"notifyButtonSubscribeClick",UNSUBSCRIBE_CLICK:"notifyButtonUnsubscribeClick",HOVERING:"notifyButtonHovering",HOVERED:"notifyButtonHover"}}static get STATES(){return{UNINITIALIZED:"uninitialized",SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed",BLOCKED:"blocked"}}static get TEXT_SUBS(){return{"prompt.native.grant":{default:"Allow",chrome:"Allow",firefox:"Always Receive Notifications",safari:"Allow"}}}showDialogProcedure(){this.dialog.shown||this.dialog.show().then(()=>{Object(_.u)(document,"click",(e,t)=>{this.dialog.element.contains(e.target)||(t(),this.dialog.shown&&this.dialog.hide().then(()=>{this.launcher.inactivateIfWasInactive()}))},!0)})}validateOptions(e){if(!e.size||!Object(_.f)(["small","medium","large"],e.size))throw new Error(`Invalid size ${e.size} for notify button. Choose among 'small', 'medium', or 'large'.`);if(!e.position||!Object(_.f)(["bottom-left","bottom-right"],e.position))throw new Error(`Invalid position ${e.position} for notify button. Choose either 'bottom-left', or 'bottom-right'.`);if(!e.theme||!Object(_.f)(["default","inverse"],e.theme))throw new Error(`Invalid theme ${e.theme} for notify button. Choose either 'default', or 'inverse'.`);if(!e.showLauncherAfter||e.showLauncherAfter<0)throw new Error(`Invalid delay duration of ${this.options.showLauncherAfter} for showing the notify button. Choose a value above 0.`);if(!e.showBadgeAfter||e.showBadgeAfter<0)throw new Error(`Invalid delay duration of ${this.options.showBadgeAfter} for showing the notify button's badge. Choose a value above 0.`)}setDefaultTextOptions(e){return{"tip.state.unsubscribed":e["tip.state.unsubscribed"]||"Subscribe to notifications","tip.state.subscribed":e["tip.state.subscribed"]||"You're subscribed to notifications","tip.state.blocked":e["tip.state.blocked"]||"You've blocked notifications","message.prenotify":e["message.prenotify"]||"Click to subscribe to notifications","message.action.subscribed":e["message.action.subscribed"]||"Thanks for subscribing!","message.action.resubscribed":e["message.action.resubscribed"]||"You're subscribed to notifications","message.action.subscribing":e["message.action.subscribing"]||"Click <strong>{{prompt.native.grant}}</strong> to receive notifications","message.action.unsubscribed":e["message.action.unsubscribed"]||"You won't receive notifications again","dialog.main.title":e["dialog.main.title"]||"Manage Site Notifications","dialog.main.button.subscribe":e["dialog.main.button.subscribe"]||"SUBSCRIBE","dialog.main.button.unsubscribe":e["dialog.main.button.unsubscribe"]||"UNSUBSCRIBE","dialog.blocked.title":e["dialog.blocked.title"]||"Unblock Notifications","dialog.blocked.message":e["dialog.blocked.message"]||"Follow these instructions to allow notifications:"}}installEventHooks(){ti.emitter.on(Ae.EVENTS.SUBSCRIBE_CLICK,()=>{this.dialog.subscribeButton.disabled=!0,this._ignoreSubscriptionState=!0,ti.setSubscription(!0).then(()=>(this.dialog.subscribeButton.disabled=!1,this.dialog.hide())).then(()=>this.message.display(ve.TYPES.MESSAGE,this.options.text["message.action.resubscribed"],ve.TIMEOUT)).then(()=>(this._ignoreSubscriptionState=!1,this.launcher.clearIfWasInactive(),this.launcher.inactivate())).then(()=>this.updateState())}),ti.emitter.on(Ae.EVENTS.UNSUBSCRIBE_CLICK,()=>{this.dialog.unsubscribeButton.disabled=!0,ti.setSubscription(!1).then(()=>(this.dialog.unsubscribeButton.disabled=!1,this.dialog.hide())).then(()=>(this.launcher.clearIfWasInactive(),this.launcher.activate())).then(()=>this.message.display(ve.TYPES.MESSAGE,this.options.text["message.action.unsubscribed"],ve.TIMEOUT)).then(()=>this.updateState())}),ti.emitter.on(Ae.EVENTS.HOVERING,()=>{this.hovering=!0,this.launcher.activateIfInactive(),this.message.shown||this.dialog.shown?this.hovering=!1:this.message.contentType!==ve.TYPES.MESSAGE?new Promise(e=>{if(this.message.queued.length>0)return this.message.dequeue().then(t=>{this.message.content=t,this.message.contentType=ve.TYPES.QUEUED,e()});this.message.content=Object(_.g)(this.message.getTipForState()),this.message.contentType=ve.TYPES.TIP,e()}).then(()=>this.message.show()).then(()=>{this.hovering=!1}):this.hovering=!1}),ti.emitter.on(Ae.EVENTS.HOVERED,()=>{this.message.contentType!==ve.TYPES.MESSAGE&&this.dialog.hidden&&(this.hovering&&(this.hovering=!1,this.message.waitUntilShown().then(()=>Object(_.i)(ve.TIMEOUT)).then(()=>this.message.hide()).then(()=>{this.launcher.wasInactive&&this.dialog.hidden&&(this.launcher.inactivate(),this.launcher.wasInactive=!1)})),this.message.shown&&this.message.hide().then(()=>{this.launcher.wasInactive&&this.dialog.hidden&&(this.launcher.inactivate(),this.launcher.wasInactive=!1)}))}),ti.emitter.on(ti.EVENTS.SUBSCRIPTION_CHANGED,e=>Object(d.a)(this,void 0,void 0,function*(){if(1==e&&(this.badge.shown&&this.options.prenotify&&this.badge.hide(),null===this.dialog.notificationIcons)){const e=yield oe.getNotificationIcons();this.dialog.notificationIcons=e}ti.getNotificationPermission(t=>{let i;i=e?Ae.STATES.SUBSCRIBED:t===R.Denied?Ae.STATES.BLOCKED:Ae.STATES.UNSUBSCRIBED,this.setState(i,this._ignoreSubscriptionState)})})),ti.emitter.on(Ae.EVENTS.STATE_CHANGED,e=>{this.launcher.element&&(e.to===Ae.STATES.SUBSCRIBED?this.launcher.inactivate():(e.to===Ae.STATES.UNSUBSCRIBED||Ae.STATES.BLOCKED)&&this.launcher.activate())}),ti.emitter.on(ti.EVENTS.NATIVE_PROMPT_PERMISSIONCHANGED,()=>{this.updateState()})}addDefaultClasses(){const e=this.container;if("bottom-left"===this.options.position)e&&Object(_.a)(e,"onesignal-bell-container-bottom-left"),Object(_.a)(this.launcher.selector,"onesignal-bell-launcher-bottom-left");else{if("bottom-right"!==this.options.position)throw new Error("Invalid OneSignal notify button position "+this.options.position);e&&Object(_.a)(e,"onesignal-bell-container-bottom-right"),Object(_.a)(this.launcher.selector,"onesignal-bell-launcher-bottom-right")}if("default"===this.options.theme)Object(_.a)(this.launcher.selector,"onesignal-bell-launcher-theme-default");else{if("inverse"!==this.options.theme)throw new Error("Invalid OneSignal notify button theme "+this.options.theme);Object(_.a)(this.launcher.selector,"onesignal-bell-launcher-theme-inverse")}}create(){return Object(d.a)(this,void 0,void 0,function*(){if(!this.options.enable)return;if(0!==(yield ti.context.dynamicResourceLoader.loadSdkStylesheet()))return void A.a.debug("Not showing notify button because styles failed to load.");this.container&&Object(_.w)("#onesignal-bell-container"),Object(_.b)("body","beforeend",'<div id="onesignal-bell-container" class="onesignal-bell-container onesignal-reset"></div>'),this.container&&Object(_.b)(this.container,"beforeend",'<div id="onesignal-bell-launcher" class="onesignal-bell-launcher"></div>'),Object(_.b)(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-button"></div>'),Object(_.b)(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-badge"></div>'),Object(_.b)(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-message"></div>'),Object(_.b)(this.message.selector,"beforeend",'<div class="onesignal-bell-launcher-message-body"></div>'),Object(_.b)(this.launcher.selector,"beforeend",'<div class="onesignal-bell-launcher-dialog"></div>'),Object(_.b)(this.dialog.selector,"beforeend",'<div class="onesignal-bell-launcher-dialog-body"></div>'),Object(_.b)(this.button.selector,"beforeend",Te);const e=yield ti.isPushNotificationsEnabled(),t=yield ti.getSubscription(),i=yield oe.wasHttpsNativePromptDismissed();let n=e?"small":this.options.size||this.DEFAULT_SIZE;yield this.launcher.resize(n),this.addDefaultClasses(),this.applyOffsetIfSpecified(),this.setCustomColorsIfSpecified(),this.patchSafariSvgFilterBug(),A.a.info("Showing the notify button."),yield(e?this.launcher.inactivate():Object(_.t)()).then(()=>ti.getSubscription()).then(t=>!e&&t||null!==this.dialog.notificationIcons?Object(_.t)():oe.getNotificationIcons().then(e=>{this.dialog.notificationIcons=e})).then(()=>Object(_.i)(this.options.showLauncherAfter||0)).then(()=>Object(_.q)()&&t&&!0!==i&&!e&&!0===ti.config.userConfig.promptOptions.autoPrompt&&!oe.isHttpPromptAlreadyShown()?(A.a.debug("Not showing notify button because slidedown will be shown."),Object(_.t)()):this.launcher.show()).then(()=>Object(_.i)(this.options.showBadgeAfter||0)).then(()=>this.options.prenotify&&!e&&ti._isNewVisitor?this.message.enqueue(this.options.text["message.prenotify"]).then(()=>this.badge.show()):Object(_.t)()).then(()=>this.initialized=!0)})}patchSafariSvgFilterBug(){if(!(g.a.safari&&Number(g.a.version)>=9.1)){let e="drop-shadow(0 2px 4px rgba(34,36,38,0.35));",t="drop-shadow(0 2px 4px rgba(34,36,38,0));",i="drop-shadow(0px 2px 2px rgba(34,36,38,.15));";this.graphic.setAttribute("style",`filter: ${e}; -webkit-filter: ${e};`),this.badge.element.setAttribute("style",`filter: ${t}; -webkit-filter: ${t};`),this.dialog.element.setAttribute("style",`filter: ${i}; -webkit-filter: ${i};`)}g.a.safari&&this.badge.element.setAttribute("style","display: none;")}applyOffsetIfSpecified(){let e=this.options.offset;if(e){const t=this.launcher.element;if(!t)return void A.a.error("Could not find bell dom element");t.style.cssText="",e.bottom&&(t.style.cssText+=`bottom: ${e.bottom};`),"bottom-right"===this.options.position?e.right&&(t.style.cssText+=`right: ${e.right};`):"bottom-left"===this.options.position&&e.left&&(t.style.cssText+=`left: ${e.left};`)}}setCustomColorsIfSpecified(){let e=this.dialog.element.querySelector("button.action"),t=this.button.element.querySelector(".pulse-ring");this.graphic.querySelector(".background").style.cssText="";let i=this.graphic.querySelectorAll(".foreground");for(let e=0;e<i.length;e++){i[e].style.cssText=""}if(this.graphic.querySelector(".stroke").style.cssText="",this.badge.element.style.cssText="",e&&(e.style.cssText="",e.style.cssText=""),t&&(t.style.cssText=""),this.options.colors){let i=this.options.colors;if(i["circle.background"]&&(this.graphic.querySelector(".background").style.cssText+=`fill: ${i["circle.background"]}`),i["circle.foreground"]){let e=this.graphic.querySelectorAll(".foreground");for(let t=0;t<e.length;t++){e[t].style.cssText+=`fill: ${i["circle.foreground"]}`}this.graphic.querySelector(".stroke").style.cssText+=`stroke: ${i["circle.foreground"]}`}i["badge.background"]&&(this.badge.element.style.cssText+=`background: ${i["badge.background"]}`),i["badge.bordercolor"]&&(this.badge.element.style.cssText+=`border-color: ${i["badge.bordercolor"]}`),i["badge.foreground"]&&(this.badge.element.style.cssText+=`color: ${i["badge.foreground"]}`),e&&(i["dialog.button.background"]&&(this.dialog.element.querySelector("button.action").style.cssText+=`background: ${i["dialog.button.background"]}`),i["dialog.button.foreground"]&&(this.dialog.element.querySelector("button.action").style.cssText+=`color: ${i["dialog.button.foreground"]}`),i["dialog.button.background.hovering"]&&this.addCssToHead("onesignal-background-hover-style",`#onesignal-bell-container.onesignal-reset .onesignal-bell-launcher .onesignal-bell-launcher-dialog button.action:hover { background: ${i["dialog.button.background.hovering"]} !important; }`),i["dialog.button.background.active"]&&this.addCssToHead("onesignal-background-active-style",`#onesignal-bell-container.onesignal-reset .onesignal-bell-launcher .onesignal-bell-launcher-dialog button.action:active { background: ${i["dialog.button.background.active"]} !important; }`)),t&&i["pulse.color"]&&(this.button.element.querySelector(".pulse-ring").style.cssText=`border-color: ${i["pulse.color"]}`)}}addCssToHead(e,t){if(document.getElementById(e))return;let i=document.createElement("style");i.id=e,i.type="text/css",i.appendChild(document.createTextNode(t)),document.head.appendChild(i)}updateState(){Promise.all([ti.privateIsPushNotificationsEnabled(),ti.privateGetNotificationPermission()]).then(([e,t])=>{this.setState(e?Ae.STATES.SUBSCRIBED:Ae.STATES.UNSUBSCRIBED),t===R.Denied&&this.setState(Ae.STATES.BLOCKED)})}setState(e,t=!1){let i=this.state;this.state=e,i===e||t||S.a.trigger(Ae.EVENTS.STATE_CHANGED,{from:i,to:e})}get container(){return document.querySelector("#onesignal-bell-container")}get graphic(){return this.button.element.querySelector("svg")}get launcher(){return this._launcher||(this._launcher=new we(this)),this._launcher}get button(){return this._button||(this._button=new Oe(this)),this._button}get badge(){return this._badge||(this._badge=new Se),this._badge}get message(){return this._message||(this._message=new ve(this)),this._message}get dialog(){return this._dialog||(this._dialog=new ye(this)),this._dialog}get subscribed(){return this.state===Ae.STATES.SUBSCRIBED}get unsubscribed(){return this.state===Ae.STATES.UNSUBSCRIBED}get blocked(){return this.state===Ae.STATES.BLOCKED}}class Ne{constructor(e,t){this.url=e,this.url.pathname="subscribe",this.options=t||{}}load(){const e=Object.assign(Object.assign({},oe.getPromptOptionsPostHash()),{promptType:"popup",parentHostname:encodeURIComponent(location.hostname)});return this.options.autoAccept&&(e.autoAccept=!0),A.a.info(`Opening a popup to ${this.url.toString()} with POST data:`,e),this.popupWindow=this.openWindowViaPost(this.url.toString(),e,null),this.establishCrossOriginMessaging(),this.loadPromise={},this.loadPromise.promise=new Promise((e,t)=>{this.loadPromise.resolver=e,this.loadPromise.rejector=t}),this.loadPromise.promise}openWindowViaPost(e,t,i){var n=document.createElement("form");n.action=e,n.method="POST",n.target="onesignal-http-popup";var o=void 0!=window.screenLeft?window.screenLeft:screen.left,s=void 0!=window.screenTop?window.screenTop:screen.top,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,c=OneSignal._windowWidth,l=OneSignal._windowHeight,d=r/2-c/2+o,u=a/2-l/2+s;i&&(i.childWidth&&(c=i.childWidth),i.childHeight&&(l=i.childHeight),i.left&&(d=i.left),i.top&&(u=i.top));const g=window.open("about:blank","onesignal-http-popup",`'scrollbars=yes, width=${c}, height=${l}, top=${u}, left=${d}`);if(t)for(var p in t){var h=document.createElement("textarea");h.name=p,h.value="object"==typeof t[p]?JSON.stringify(t[p]):t[p],n.appendChild(h)}return n.style.display="none",document.body.appendChild(n),n.submit(),document.body.removeChild(n),g}establishCrossOriginMessaging(){this.messenger=new ce(this.popupWindow,this.url.toString(),this.url.toString()),this.messenger.on(OneSignal.POSTMAM_COMMANDS.POPUP_BEGIN_MESSAGEPORT_COMMS,this.onBeginMessagePortCommunications.bind(this)),this.messenger.once(OneSignal.POSTMAM_COMMANDS.POPUP_LOADED,this.onPopupLoaded.bind(this)),this.messenger.once(OneSignal.POSTMAM_COMMANDS.POPUP_ACCEPTED,this.onPopupAccepted.bind(this)),this.messenger.once(OneSignal.POSTMAM_COMMANDS.POPUP_REJECTED,this.onPopupRejected.bind(this)),this.messenger.once(OneSignal.POSTMAM_COMMANDS.POPUP_CLOSING,this.onPopupClosing.bind(this)),this.messenger.once(OneSignal.POSTMAM_COMMANDS.SET_SESSION_COUNT,this.onSetSessionCount.bind(this)),this.messenger.once(OneSignal.POSTMAM_COMMANDS.WINDOW_TIMEOUT,this.onWindowTimeout.bind(this)),this.messenger.once(OneSignal.POSTMAM_COMMANDS.FINISH_REMOTE_REGISTRATION,this.onFinishingRegistrationRemotely.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_RETRIGGER_EVENT,this.onRemoteRetriggerEvent.bind(this)),this.messenger.startPostMessageReceive()}dispose(){this.messenger.destroy()}onBeginMessagePortCommunications(e){return Object(d.a)(this,void 0,void 0,function*(){return A.a.debug(`(${C.a.getWindowEnv().toString()}) Successfully established cross-origin messaging with the popup window.`),this.messenger.connect(),!1})}onPopupLoaded(e){return Object(d.a)(this,void 0,void 0,function*(){this.loadPromise.resolver(),S.a.trigger("popupLoad")})}onPopupAccepted(e){return Object(d.a)(this,void 0,void 0,function*(){oe.triggerCustomPromptClicked("granted")})}onPopupRejected(e){return Object(d.a)(this,void 0,void 0,function*(){oe.triggerCustomPromptClicked("denied")})}onPopupClosing(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.info("Popup window is closing, running cleanup events."),S.a.trigger(OneSignal.EVENTS.POPUP_CLOSING),this.dispose()})}onSetSessionCount(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug(C.a.getWindowEnv().toString()+" Marking current session as a continuing browsing session.");const{sessionCount:t}=e.data;OneSignal.context.pageViewManager.setPageViewCount(t)})}onWindowTimeout(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug(C.a.getWindowEnv().toString()+" Popup window timed out and was closed."),S.a.trigger(OneSignal.EVENTS.POPUP_WINDOW_TIMEOUT)})}onFinishingRegistrationRemotely(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug(location.origin,C.a.getWindowEnv().toString()+" Finishing HTTP popup registration inside the iFrame, sent from popup."),e.reply({progress:!0});const{rawPushSubscription:t}=e.data;this.messenger&&this.messenger.stopPostMessageReceive(),yield OneSignal.context.subscriptionManager.registerSubscription(t),yield $.checkAndTriggerSubscriptionChanged(),yield oe.checkAndTriggerNotificationPermissionChanged()})}onRemoteRetriggerEvent(e){let{eventName:t,eventData:i}=e.data;return S.a.trigger(t,i,e.source),!1}message(){this.messenger&&this.messenger.message.apply(this.messenger,arguments)}}function Me(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}class ke{getPropertiesAsJson(){return{origin:location.origin,url:location.href,sdkVersion:p.a.version()}}}class xe{}(Pe=Ee||(Ee={})).HttpPermissionRequest="HttpPermissionRequest",Pe.SyncHashedEmail="SyncHashedEmail";class _e extends ke{constructor(e){super(),this.apiName=e}getEventName(){return"api-usage"}getPropertiesAsJson(){return Object.assign({api:this.apiName.toString()},super.getPropertiesAsJson())}}class je extends xe{constructor(){super()}getProfileName(){return"all_websites"}getDateUtc(){const e=new Date;return`${e.getUTCMonth()+1}_${e.getUTCDate()}_${e.getUTCFullYear()}`}getOperationData(){const e={$add:{},$ignore_time:!0};return e.$add[`pageview_${this.getDateUtc()}`]=1,e}}class De{constructor(e,t){this.isFeatureEnabled=e,this.mixpanelReportingToken=t}static get MIXPANEL_REPORTING_URL(){return"https://api.mixpanel.com"}isEnabled(){return this.isFeatureEnabled&&!!this.mixpanelReportingToken}reportEvent(e){if(!this.isEnabled())return Promise.resolve(null);const t={event:e.getEventName(),properties:Object.assign({token:this.mixpanelReportingToken},e.getPropertiesAsJson())},i=Me(JSON.stringify(t)),n={method:"GET",headers:new Headers,cache:"no-cache"};return fetch(`${De.MIXPANEL_REPORTING_URL}/track/?data=${i}`,n)}reportEngagement(e){if(!this.isEnabled())return Promise.resolve(null);let t={$token:this.mixpanelReportingToken,$distinct_id:e.getProfileName()};t=Object.assign(Object.assign({},t),e.getOperationData());const i=Me(JSON.stringify(t)),n={method:"GET",headers:new Headers,cache:"no-cache"};return fetch(`${De.MIXPANEL_REPORTING_URL}/engage/?data=${i}`,n)}shouldCollectPageView(){const e=new Date;return e.getUTCMonth()+1<=2&&e.getUTCDate()<=10&&e.getUTCFullYear()<=2018&&e.getUTCMonth()+1>=2&&e.getUTCDate()>=8&&e.getUTCFullYear()>=2018}reportPageView(){this.shouldCollectPageView()&&this.reportEngagement(new je)}}(Ce=Ie||(Ie={}))[Ce.HttpPermissionRequest=0]="HttpPermissionRequest",Ce[Ce.SyncHashedEmail=1]="SyncHashedEmail";class Re extends h.a{constructor(e){let t,i;switch(e){case Ie.HttpPermissionRequest:t="The HTTP permission request has been deprecated. Please remove any custom popups from your code.",i=Ee.HttpPermissionRequest;break;case Ie.SyncHashedEmail:t="API syncHashedEmail() has been deprecated and will be removed in a future SDK release. Please remove any usages from your code.",i=Ee.SyncHashedEmail}super(t),this.reportUsage(i),Object.setPrototypeOf(this,Re.prototype)}reportUsage(e){"undefined"!=typeof OneSignal&&OneSignal.context&&OneSignal.context.metricsManager&&OneSignal.context.metricsManager.reportEvent(new _e(e))}}class Ue{static internalInit(){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug("Called %cinternalInit()",Object(_.k)("code")),yield OneSignal.context.serviceWorkerManager.installWorker();const e=OneSignal.context.sessionManager;OneSignal.emitter.on(OneSignal.EVENTS.SESSION_STARTED,e.sendOnSessionUpdateFromPage.bind(e)),OneSignal.context.pageViewManager.incrementPageViewCount(),"visible"===document.visibilityState?yield Ue.sessionInit():Ue.postponeSessionInitUntilPageIsInFocus()})}static postponeSessionInitUntilPageIsInFocus(){Object(_.u)(document,"visibilitychange",(e,t)=>{"visible"===document.visibilityState&&(t(),Ue.sessionInit())},!0)}static sessionInit(){return Object(d.a)(this,void 0,void 0,function*(){if(A.a.debug("Called %csessionInit()",Object(_.k)("code")),OneSignal._sessionInitAlreadyRunning)return void A.a.debug("Returning from sessionInit because it has already been called.");OneSignal._sessionInitAlreadyRunning=!0;try{yield Ue.doInitialize()}catch(e){if(e instanceof m)return;throw e}const e=yield OneSignal.internalIsOptedOut();H.setIsOptedOut(!!e),E.a.isUsingSubscriptionWorkaround()||(yield Ue.handleAutoResubscribe(e));const t=yield OneSignal.privateIsPushNotificationsEnabled();if(H.setIsPushNotificationsEnabled(!!t),OneSignal.config.userConfig.promptOptions.autoPrompt&&!e&&!t){const{environmentInfo:e}=OneSignal,{browserType:t,browserVersion:i,requiresUserInteraction:n}=e,o="chrome"===t&&Number(i)>=63&&(g.a.tablet||g.a.mobile)||n,s=OneSignal.context.appConfig.userConfig.promptOptions.slidedown.categories;yield OneSignal.context.promptsManager.internalShowAutoPrompt({forceSlidedownOverNative:o,categoryOptions:s})}OneSignal._sessionInitAlreadyRunning=!1,yield S.a.trigger(OneSignal.EVENTS.SDK_INITIALIZED)})}static registerForPushNotifications(e={}){return Object(d.a)(this,void 0,void 0,function*(){if(e&&e.modalPrompt)return OneSignal.subscriptionModalHost=new le(OneSignal.config.appId,e),void(yield OneSignal.subscriptionModalHost.load());if(E.a.isUsingSubscriptionWorkaround())return e.httpPermissionRequest?void A.a.error(new Re(Ie.HttpPermissionRequest)):void(yield Ue.loadSubscriptionPopup(e));H.getIsOptedOut()||(yield ne.registerForPush())})}static onSdkInitialized(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield Ue.processExpiringSubscriptions();(yield OneSignal.context.subscriptionManager.isAlreadyRegisteredWithOneSignal())?(OneSignal.context.sessionManager.setupSessionEventListeners(),e||(yield OneSignal.context.updateManager.sendOnSessionUpdate())):OneSignal.config.userConfig.promptOptions.autoPrompt||OneSignal.config.userConfig.autoResubscribe||(yield OneSignal.context.updateManager.sendOnSessionUpdate()),yield S.a.trigger(OneSignal.EVENTS.SDK_INITIALIZED_PUBLIC)})}static loadSubscriptionPopup(e){return Object(d.a)(this,void 0,void 0,function*(){OneSignal.subscriptionPopupHost=new Ne(OneSignal.proxyFrameHost.url,e),yield OneSignal.subscriptionPopupHost.load()})}static storeInitialValues(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield OneSignal.privateIsPushNotificationsEnabled(),t=yield OneSignal.privateGetNotificationPermission(),i=yield OneSignal.internalIsOptedOut();v.put("subscription.optedOut",i),yield x.a.put("Options",{key:"isPushEnabled",value:e}),yield x.a.put("Options",{key:"notificationPermission",value:t})})}static setWelcomeNotificationFlag(){return Object(d.a)(this,void 0,void 0,function*(){(yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.context.appConfig.safariWebId))===R.Granted&&(OneSignal.__doNotShowWelcomeNotification=!0)})}static establishServiceWorkerChannel(){return Object(d.a)(this,void 0,void 0,function*(){if(navigator.serviceWorker&&"https:"===window.location.protocol&&!(yield C.a.isFrameContextInsecure()))try{yield OneSignal.context.serviceWorkerManager.establishServiceWorkerChannel()}catch(e){A.a.error(e)}})}static processExpiringSubscriptions(){return Object(d.a)(this,void 0,void 0,function*(){const e=OneSignal.context;if(A.a.debug("Checking subscription expiration..."),!(yield e.subscriptionManager.isSubscriptionExpiring()))return A.a.debug("Subscription is not considered expired."),!1;const t=yield C.a.getIntegration(),i=C.a.getWindowEnv();switch(A.a.debug("Subscription is considered expiring. Current Integration:",t),t){case he.a.Secure:const n=yield e.subscriptionManager.subscribe(1);yield e.subscriptionManager.registerSubscription(n);break;case he.a.SecureProxy:if(i===G.a.OneSignalProxyFrame)yield this.registerSubscriptionInProxyFrame(e);else{yield OneSignal.proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.PROCESS_EXPIRING_SUBSCRIPTIONS)}break;case he.a.InsecureProxy:yield x.a.remove("Ids","registrationId"),A.a.debug("Unsubscribed expiring HTTP subscription by removing registration ID.")}return!0})}static registerSubscriptionInProxyFrame(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield new Promise(t=>{e.workerMessenger.once(se.SubscribeNew,e=>{t(be.a.deserialize(e))}),e.workerMessenger.unicast(se.SubscribeNew,e.appConfig)});return A.a.debug("Finished registering brand new subscription:",t),t})}static doInitialize(){return Object(d.a)(this,void 0,void 0,function*(){const e=[];e.push(Ue.storeInitialValues()),e.push(Ue.installNativePromptPermissionChangedHook()),e.push(Ue.setWelcomeNotificationFlag()),e.push(Ue.establishServiceWorkerChannel()),e.push(Ue.showNotifyButton()),e.push(Ue.showPromptsFromWebConfigEditor());try{yield Promise.all(e)}catch(e){throw A.a.error(e),new m(c.Unknown)}})}static showNotifyButton(){return Object(d.a)(this,void 0,void 0,function*(){if(p.a.isBrowser()&&!OneSignal.notifyButton){OneSignal.config.userConfig.notifyButton=OneSignal.config.userConfig.notifyButton||{},OneSignal.config.userConfig.bell&&(OneSignal.config.userConfig.bell=Object.assign(Object.assign({},OneSignal.config.userConfig.bell),OneSignal.config.userConfig.notifyButton),OneSignal.config.userConfig.notifyButton=Object.assign(Object.assign({},OneSignal.config.userConfig.notifyButton),OneSignal.config.userConfig.bell));const e=OneSignal.config.userConfig.notifyButton.displayPredicate;e&&"function"==typeof e?OneSignal.emitter.once(OneSignal.EVENTS.SDK_INITIALIZED,()=>Object(d.a)(this,void 0,void 0,function*(){!1!==(yield Promise.resolve(OneSignal.config.userConfig.notifyButton.displayPredicate()))?(OneSignal.notifyButton=new Ae(OneSignal.config.userConfig.notifyButton),OneSignal.notifyButton.create()):A.a.debug("Notify button display predicate returned false so not showing the notify button.")})):(OneSignal.notifyButton=new Ae(OneSignal.config.userConfig.notifyButton),OneSignal.notifyButton.create())}})}static updateEmailSessionCount(){return Object(d.a)(this,void 0,void 0,function*(){const e=OneSignal.context;if(e.pageViewManager.isFirstPageView()){const t=yield x.a.getEmailProfile();if(t.emailId){const i=new I(t.emailAddress,t.identifierAuthHash);i.appId=e.appConfig.appId,yield k.updateUserSession(t.emailId,i)}}})}static showPromptsFromWebConfigEditor(){return Object(d.a)(this,void 0,void 0,function*(){const e=OneSignal.config;e.userConfig.promptOptions&&(yield j.initialize(e.userConfig.promptOptions.customlink))})}static installNativePromptPermissionChangedHook(){return Object(d.a)(this,void 0,void 0,function*(){if(navigator.permissions&&!(g.a.firefox&&Number(g.a.version)<=45)){OneSignal._usingNativePermissionHook=!0,(yield navigator.permissions.query({name:"notifications"})).onchange=function(){Object(_.y)()}}})}static saveInitOptions(){return Object(d.a)(this,void 0,void 0,function*(){let e=[];const t=OneSignal.config.userConfig.persistNotification;e.push(x.a.put("Options",{key:"persistNotification",value:null==t||t}));let i=OneSignal.config.userConfig.webhooks;return["notification.displayed","notification.clicked","notification.dismissed"].forEach(t=>{i&&i[t]?e.push(x.a.put("Options",{key:`webhooks.${t}`,value:i[t]})):e.push(x.a.put("Options",{key:`webhooks.${t}`,value:!1}))}),i&&i.cors?e.push(x.a.put("Options",{key:"webhooks.cors",value:!0})):e.push(x.a.put("Options",{key:"webhooks.cors",value:!1})),OneSignal.config.userConfig.notificationClickHandlerMatch?e.push(x.a.put("Options",{key:"notificationClickHandlerMatch",value:OneSignal.config.userConfig.notificationClickHandlerMatch})):e.push(x.a.put("Options",{key:"notificationClickHandlerMatch",value:"exact"})),OneSignal.config.userConfig.notificationClickHandlerAction?e.push(x.a.put("Options",{key:"notificationClickHandlerAction",value:OneSignal.config.userConfig.notificationClickHandlerAction})):e.push(x.a.put("Options",{key:"notificationClickHandlerAction",value:"navigate"})),Promise.all(e)})}static initSaveState(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield oe.getAppId(),i=OneSignal.config;yield x.a.put("Ids",{type:"appId",id:t});const n=e||i.siteName||document.title||"Notification";yield x.a.put("Options",{key:"pageTitle",value:n}),A.a.info(`OneSignal: Set pageTitle to be '${n}'.`)})}static handleAutoResubscribe(e){return Object(d.a)(this,void 0,void 0,function*(){if(A.a.info("handleAutoResubscribe",{autoResubscribe:OneSignal.config.userConfig.autoResubscribe,isOptedOut:e}),OneSignal.config.userConfig.autoResubscribe&&!e){(yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.context.appConfig.safariWebId))==R.Granted&&(yield ne.registerForPush())}})}static polyfillSafariFetch(){return Object(d.a)(this,void 0,void 0,function*(){if(g.a.safari&&void 0===window.fetch){A.a.debug("Loading fetch polyfill for Safari..");try{yield(new pe).loadFetchPolyfill(),A.a.debug("Done loading fetch polyfill.")}catch(e){A.a.debug("Error loading fetch polyfill:",e)}}})}static errorIfInitAlreadyCalled(){if(OneSignal._initCalled)throw new m(c.MultipleInitialization);OneSignal._initCalled=!0}}class We{static markHttpsNativePromptDismissed(){return Object(d.a)(this,void 0,void 0,function*(){if(Object(_.q)())try{yield new Promise((e,t)=>{OneSignal.proxyFrameHost.message(OneSignal.POSTMAM_COMMANDS.MARK_PROMPT_DISMISSED,{},i=>{i.data===OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE?e():t()})})}catch(e){A.a.debug("Proxy Frame possibly didn't not receive MARK_PROMPT_DISMISSED message",e||"")}let e=yield x.a.get("Options","promptDismissCount");e||(e=0),Object(_.q)()||(e+=1);let t=3;2==e?t=7:e>2&&(t=30),A.a.debug(`(${C.a.getWindowEnv().toString()}) OneSignal: User dismissed the native notification prompt; reprompt after ${t} days.`),yield x.a.put("Options",{key:"promptDismissCount",value:e});const i=24*t*60;return q.setItem("onesignal-notification-prompt","dismissed",i)})}}class Be{constructor(){this.incrementedPageViewCount=!1}getPageViewCount(){try{const e=sessionStorage.getItem(Be.SESSION_STORAGE_KEY_NAME),t=e?parseInt(e):0;return isNaN(t)?0:t}catch(e){return 0}}setPageViewCount(e){try{sessionStorage.setItem(Be.SESSION_STORAGE_KEY_NAME,e.toString()),C.a.getWindowEnv()===G.a.OneSignalSubscriptionPopup&&OneSignal.subscriptionPopup&&OneSignal.subscriptionPopup.message(OneSignal.POSTMAM_COMMANDS.SET_SESSION_COUNT)}catch(e){}}incrementPageViewCount(){if(this.incrementedPageViewCount)return;const e=this.getPageViewCount()+1,t=this.getLocalPageViewCount()+1;this.setPageViewCount(e),this.setLocalPageViewCount(t),this.incrementedPageViewCount=!0,A.a.debug(`Incremented page view count: newCountSingleTab: ${e},\n      newCountAccrossTabs: ${t}.`)}simulatePageNavigationOrRefresh(){this.incrementedPageViewCount=!1}isFirstPageView(){return 1===this.getPageViewCount()}getLocalPageViewCount(){return H.getLocalPageViewCount()}setLocalPageViewCount(e){H.setLocalPageViewCount(e)}}Be.SESSION_STORAGE_KEY_NAME="onesignal-pageview-count";class Le{constructor(e){if(!e)throw new InvalidArgumentError.a("path",InvalidArgumentError.b.Empty);this.path=e.trim()}getQueryString(){const e=this.path.indexOf("?");return-1===e?null:this.path.length>e?this.path.substring(e+1):null}getWithoutQueryString(){return this.path.split(Le.QUERY_STRING)[0]}getFileName(){return this.getWithoutQueryString().split("\\").pop().split("/").pop()}getFileNameWithQuery(){return this.path.split("\\").pop().split("/").pop()}getFullPath(){return this.path}getPathWithoutFileName(){const e=this.getWithoutQueryString(),t=e.lastIndexOf(this.getFileName());let i=e.substring(0,t);return i=i.replace(/[\\\/]$/,"")}}Le.QUERY_STRING="?";class Ve extends h.a{constructor(e,t){super("Registration of a Service Worker failed."),this.status=e,this.statusText=t,Object.setPrototypeOf(this,Ve.prototype)}}var Fe,He=Ve;!function(e){e[e.Direct=1]="Direct",e[e.Indirect=2]="Indirect",e[e.Unattributed=3]="Unattributed",e[e.NotSupported=4]="NotSupported"}(Fe||(Fe={}));class $e{static downloadServerAppConfig(e){return Object(d.a)(this,void 0,void 0,function*(){return T.a.enforceAppId(e),yield new Promise((t,i)=>{t(N.get(`sync/${e}/web`,null))})})}static getUserIdFromSubscriptionIdentifier(e,t,i){return T.a.enforceAppId(e),N.post("players",{app_id:e,device_type:t,identifier:i,notification_types:z.TemporaryWebRecord}).then(e=>e&&e.id?e.id:null).catch(e=>(A.a.debug("Error getting user ID from subscription identifier:",e),null))}static updatePlayer(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){return yield T.a.enforceAppIdAndPlayerId(e,t,()=>Object(d.a)(this,void 0,void 0,function*(){yield N.put(`players/${t}`,Object.assign({app_id:e},i))}))})}static updateUserSession(e,t){return Object(d.a)(this,void 0,void 0,function*(){return yield T.a.enforceAppIdAndPlayerId(t.app_id,e,()=>Object(d.a)(this,void 0,void 0,function*(){const i=yield N.post(`players/${e}/on_session`,t);return i.id?i.id:e}))})}static sendSessionDuration(e,t,i,n,o){return Object(d.a)(this,void 0,void 0,function*(){T.a.enforceAppIdAndPlayerId(e,t,()=>Object(d.a)(this,void 0,void 0,function*(){const s={app_id:e,type:1,state:"ping",active_time:i,device_type:n};switch(o.type){case Fe.Direct:s.direct=!0,s.notification_ids=o.notificationIds;break;case Fe.Indirect:s.direct=!1,s.notification_ids=o.notificationIds}yield N.post(`players/${t}/on_focus`,s)}))})}}var ze=$e;class Ge{static debug(...e){self.shouldLog&&console.debug(...e)}static trace(...e){self.shouldLog&&console.trace(...e)}static info(...e){self.shouldLog&&console.info(...e)}static warn(...e){self.shouldLog&&console.warn(...e)}static error(...e){self.shouldLog&&console.error(...e)}}const Ke="sendOutcome",qe="sendUniqueOutcome";class Ye{constructor(e,t,i,n){this.outcomeName=i,this.config=t,this.appId=e,this.isUnique=n}getAttribution(){return Object(d.a)(this,void 0,void 0,function*(){return yield Ye.getAttribution(this.config)})}beforeOutcomeSend(){return Object(d.a)(this,void 0,void 0,function*(){const e=this.isUnique?qe:Ke;return Object(_.s)(e,this.outcomeName),this.config?this.outcomeName?(yield Object(_.c)(),!!(yield OneSignal.privateIsPushNotificationsEnabled())||(A.a.warn("Reporting outcomes is supported only for subscribed users."),!1)):(A.a.error("Outcome name is required"),!1):(A.a.debug("Outcomes feature not supported by main application yet."),!1)})}getAttributedNotifsByUniqueOutcomeName(){return Object(d.a)(this,void 0,void 0,function*(){return(yield x.a.getAll("SentUniqueOutcome")).filter(e=>e.outcomeName===this.outcomeName).reduce((e,t)=>{const i=t.notificationIds||[];return[...e,...i]},[])})}getNotifsToAttributeWithUniqueOutcome(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield this.getAttributedNotifsByUniqueOutcomeName();return e.filter(e=>-1===t.indexOf(e))})}shouldSendUnique(e,t){return e.type===Fe.Unattributed||t.length>0}saveSentUniqueOutcome(e){return Object(d.a)(this,void 0,void 0,function*(){const t=this.outcomeName,i=yield x.a.get("SentUniqueOutcome",t),n=yield x.a.getCurrentSession(),o=[...i?i.notificationIds:[],...e],s=n?n.startTimestamp:null;yield x.a.put("SentUniqueOutcome",{outcomeName:t,notificationIds:o,sentDuringSession:s})})}wasSentDuringSession(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield x.a.get("SentUniqueOutcome",this.outcomeName);if(!e)return!1;const t=yield x.a.getCurrentSession(),i=t&&e.sentDuringSession===t.startTimestamp,n=!t&&!!e.sentDuringSession;return i||n})}send(e){return Object(d.a)(this,void 0,void 0,function*(){const{type:t,notificationIds:i,weight:n}=e;switch(t){case Fe.Direct:return this.isUnique&&(yield this.saveSentUniqueOutcome(i)),void(yield OneSignal.context.updateManager.sendOutcomeDirect(this.appId,i,this.outcomeName,n));case Fe.Indirect:return this.isUnique&&(yield this.saveSentUniqueOutcome(i)),void(yield OneSignal.context.updateManager.sendOutcomeInfluenced(this.appId,i,this.outcomeName,n));case Fe.Unattributed:if(this.isUnique){if(yield this.wasSentDuringSession())return void A.a.warn("(Unattributed) unique outcome was already sent during this session");yield this.saveSentUniqueOutcome([])}return void(yield OneSignal.context.updateManager.sendOutcomeUnattributed(this.appId,this.outcomeName,n));default:return void A.a.warn("You are on a free plan. Please upgrade to use this functionality.")}})}static getAttribution(e){return Object(d.a)(this,void 0,void 0,function*(){if(e.direct&&e.direct.enabled){const e=yield x.a.getAll("NotificationClicked");if(e.length>0)return{type:Fe.Direct,notificationIds:[e[0].notificationId]}}if(e.indirect&&e.indirect.enabled){const t=60*e.indirect.influencedTimePeriodMin*1e3,i=new Date((new Date).getTime()-t).getTime(),n=yield x.a.getAll("NotificationReceived");if(A.a.debug(`\tFound total of ${n.length} received notifications`),n.length>0){const t=e.indirect.influencedNotificationsLimit,o=T.a.sortArrayOfObjects(n,e=>e.timestamp,!0,!1),s=o.filter(e=>e.timestamp>=i).slice(0,t).map(e=>e.notificationId);A.a.debug(`\tTotal of ${s.length} received notifications are within reporting window.`);const r=o.filter(e=>-1===s.indexOf(e.notificationId)).map(e=>e.notificationId);if(r.forEach(e=>x.a.remove("NotificationReceived",e)),A.a.debug(`\t${r.length} received notifications will be deleted.`),s.length>0)return{type:Fe.Indirect,notificationIds:s}}}return e.unattributed&&e.unattributed.enabled?{type:Fe.Unattributed,notificationIds:[]}:{type:Fe.NotSupported,notificationIds:[]}})}}const Je=()=>{Ge.debug("Do nothing")};function Ze(e,t){const i=1e3*t;let n,o=void 0;const s=new Promise((t,s)=>{let r=!1;n=self.setTimeout(()=>Object(d.a)(this,void 0,void 0,function*(){r=!0;try{yield e(),t()}catch(e){Ge.error("Failed to execute callback",e),s()}}),i),o=(()=>{Ge.debug("Cancel called"),self.clearTimeout(n),r||t()})});return o?{promise:s,cancel:o}:(Ge.warn("clearTimeoutHandle was not assigned."),{promise:s,cancel:Je})}class Xe{static getAlternatingServiceWorkerHref(e,t,i){let n;return n=e===Qe.WorkerA?t.workerBPath.getFullPath():t.workerAPath.getFullPath(),Xe.appendServiceWorkerParams(n,i)}static getPossibleServiceWorkerHrefs(e,t){return[e.workerAPath.getFullPath(),e.workerBPath.getFullPath()].map(e=>Xe.appendServiceWorkerParams(e,t))}static appendServiceWorkerParams(e,t){return`${new URL(e,E.a.getBaseUrl()).href}?${T.b.encodeHashAsUriComponent({appId:t})}`}static upsertSession(e,t,i,n,o,s){return Object(d.a)(this,void 0,void 0,function*(){if(!n)return void Ge.error("No deviceId provided for new session.");if(!i.app_id)return void Ge.error("No appId provided for new session.");const r=yield x.a.getCurrentSession();if(!r){const e=i.app_id,t=Object(ie.d)({deviceId:n,appId:e,deviceType:i.device_type}),s=yield x.a.getLastNotificationClicked(e);return s&&(t.notificationId=s.notificationId),yield x.a.upsertSession(t),void(yield Xe.sendOnSessionCallIfNecessary(o,i,n,t))}if(r.status===ie.c.Active)return void Ge.debug("Session already active",r);if(!r.lastDeactivatedTimestamp)return void Ge.debug("Session is in invalid state",r);const a=(new Date).getTime();if(Xe.timeInSecondsBetweenTimestamps(a,r.lastDeactivatedTimestamp)<=e)return r.status=ie.c.Active,r.lastActivatedTimestamp=a,r.lastDeactivatedTimestamp=null,void(yield x.a.upsertSession(r));yield Xe.finalizeSession(r,t,s);const c=Object(ie.d)({deviceId:n,appId:i.app_id,deviceType:i.device_type});yield x.a.upsertSession(c),yield Xe.sendOnSessionCallIfNecessary(o,i,n,c)})}static deactivateSession(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){const n=yield x.a.getCurrentSession();if(!n)return void Ge.debug("No active session found. Cannot deactivate.");if(n.status===ie.c.Inactive)return Ze(()=>Xe.finalizeSession(n,t,i),e);if(n.status!==ie.c.Active)return void Ge.warn(`Session in invalid state ${n.status}. Cannot deactivate.`);const o=(new Date).getTime(),s=Xe.timeInSecondsBetweenTimestamps(o,n.lastActivatedTimestamp);n.lastDeactivatedTimestamp=o,n.accumulatedDuration+=s,n.status=ie.c.Inactive;const r=Ze(()=>Xe.finalizeSession(n,t,i),e);return yield x.a.upsertSession(n),r})}static sendOnSessionCallIfNecessary(e,t,i,n){return Object(d.a)(this,void 0,void 0,function*(){if(e===ie.b.PlayerCreate)return;if(!t.identifier){const e=yield self.registration.pushManager.getSubscription();if(e){const i=ee.setFromW3cSubscription(e),n=new Y(i).serialize();t.identifier=n.identifier}}const o=yield $e.updateUserSession(i,t);o!==i&&(n.deviceId=o,yield Promise.all([x.a.setDeviceId(o),x.a.upsertSession(n),x.a.resetSentUniqueOutcomes()]))})}static finalizeSession(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){if(Ge.debug("Finalize session",`started: ${new Date(e.startTimestamp)}`,`duration: ${e.accumulatedDuration}s`),t){Ge.debug(`send on_focus reporting session duration -> ${e.accumulatedDuration}s`);const t=yield Ye.getAttribution(i);Ge.debug("send on_focus with attribution",t),yield $e.sendSessionDuration(e.appId,e.deviceId,e.accumulatedDuration,e.deviceType,t)}yield Promise.all([x.a.cleanupCurrentSession(),x.a.removeAllNotificationClicked()]),Ge.debug("Finalize session finished",`started: ${new Date(e.startTimestamp)}`)})}static timeInSecondsBetweenTimestamps(e,t){return e<=t?0:Math.floor((e-t)/1e3)}}var Qe,et,tt,it;(et=Qe||(Qe={})).WorkerA="Worker A (Main)",et.WorkerB="Worker B (Updater)",et.ThirdParty="3rd Party",et.None="None",et.Indeterminate="Indeterminate";class nt{constructor(e,t){this.context=e,this.config=t}getRegistration(){return Object(d.a)(this,void 0,void 0,function*(){return yield de.getRegistration(this.config.registrationOptions.scope)})}getActiveState(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield C.a.getIntegration();if(e===he.a.InsecureProxy)return Qe.Indeterminate;if(e===he.a.SecureProxy){switch(C.a.getWindowEnv()){case G.a.Host:case G.a.CustomIframe:const e=OneSignal.proxyFrameHost;return e?yield e.runCommand(OneSignal.POSTMAM_COMMANDS.SERVICE_WORKER_STATE):Qe.Indeterminate;case G.a.OneSignalSubscriptionPopup:break;case G.a.OneSignalSubscriptionModal:throw new w}}const t=yield this.context.serviceWorkerManager.getRegistration();if(!t)return Qe.None;const i=nt.activeSwFileName(t);return this.swActiveStateByFileName(i)})}static activeSwFileName(e){const t=de.getAvailableServiceWorker(e);if(!t)return null;const i=new URL(t.scriptURL).pathname,n=new Le(i).getFileName();if("akam-sw.js"==n){const e=new URLSearchParams(new URL(t.scriptURL).search).get("othersw");if(e)return A.a.debug("Found a ServiceWorker under Akamai's akam-sw.js?othersw=",e),new Le(new URL(e).pathname).getFileName()}return n}swActiveStateByFileName(e){return e?e==this.config.workerAPath.getFileName()?Qe.WorkerA:e==this.config.workerBPath.getFileName()?Qe.WorkerB:Qe.ThirdParty:Qe.None}getWorkerVersion(){return Object(d.a)(this,void 0,void 0,function*(){return new Promise(e=>Object(d.a)(this,void 0,void 0,function*(){if(E.b.isUsingSubscriptionWorkaround()){const t=OneSignal.proxyFrameHost;if(t){const i=yield t.runCommand(OneSignal.POSTMAM_COMMANDS.GET_WORKER_VERSION);e(i)}else e(NaN)}else this.context.workerMessenger.once(se.WorkerVersion,t=>{e(t)}),this.context.workerMessenger.unicast(se.WorkerVersion)}))})}shouldInstallWorker(){return Object(d.a)(this,void 0,void 0,function*(){if(!p.a.supportsServiceWorkers())return!1;if(!OneSignal.config)return!1;if(OneSignal.config.subdomain&&"safari"!==OneSignal.environmentInfo.browserType&&C.a.getWindowEnv()===G.a.Host)return!1;const e=yield this.getActiveState();if(A.a.debug("[shouldInstallWorker] workerState",e),e===Qe.None||e===Qe.ThirdParty){const e="granted"===(yield OneSignal.context.permissionManager.getNotificationPermission(OneSignal.config.safariWebId));return e&&A.a.info("[shouldInstallWorker] Notification Permissions enabled, will install ServiceWorker"),e}return!!(yield this.haveParamsChanged())||this.workerNeedsUpdate()})}haveParamsChanged(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield this.context.serviceWorkerManager.getRegistration();if(!e)return A.a.info("[changedServiceWorkerParams] workerRegistration not found at scope",this.config.registrationOptions.scope),!0;const t=new URL(e.scope).pathname,i=this.config.registrationOptions.scope;if(t!=i)return A.a.info("[changedServiceWorkerParams] ServiceWorker scope changing",{a_old:t,b_new:i}),!0;const n=de.getAvailableServiceWorker(e),o=Xe.getPossibleServiceWorkerHrefs(this.config,this.context.appConfig.appId);return null===n||void 0===n||!n.scriptURL||-1===o.indexOf(n.scriptURL)&&(A.a.info("[changedServiceWorkerParams] ServiceWorker href changing:",{a_old:null===n||void 0===n?void 0:n.scriptURL,b_new:o}),!0)})}workerNeedsUpdate(){return Object(d.a)(this,void 0,void 0,function*(){let e;A.a.info("[Service Worker Update] Checking service worker version...");try{e=yield T.a.timeoutPromise(this.getWorkerVersion(),2e3)}catch(e){return A.a.info("[Service Worker Update] Worker did not reply to version query; assuming older version and updating."),!0}return e!==p.a.version()?(A.a.info(`[Service Worker Update] Updating service worker from ${e} --\x3e ${p.a.version()}.`),!0):(A.a.info(`[Service Worker Update] Service worker version is current at ${e} (no update required).`),!1)})}installWorker(){return Object(d.a)(this,void 0,void 0,function*(){(yield this.shouldInstallWorker())&&(yield this.installAlternatingWorker(),(yield this.getActiveState())===Qe.WorkerB&&(yield this.installAlternatingWorker()),yield this.establishServiceWorkerChannel())})}establishServiceWorkerChannel(){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug("establishServiceWorkerChannel");const e=this.context.workerMessenger;e.off(),e.on(se.NotificationDisplayed,e=>{A.a.debug(location.origin,"Received notification display event from service worker."),S.a.trigger(OneSignal.EVENTS.NOTIFICATION_DISPLAYED,e)}),e.on(se.NotificationClicked,e=>Object(d.a)(this,void 0,void 0,function*(){let t;if(0===(t=C.a.getWindowEnv()===G.a.OneSignalProxyFrame?yield new Promise(e=>{const t=OneSignal.proxyFrame;t&&t.messenger.message(OneSignal.POSTMAM_COMMANDS.GET_EVENT_LISTENER_COUNT,OneSignal.EVENTS.NOTIFICATION_CLICKED,t=>{let i=t.data;e(i)})}):OneSignal.emitter.numberOfListeners(OneSignal.EVENTS.NOTIFICATION_CLICKED))){A.a.debug("notification.clicked event received, but no event listeners; storing event in IndexedDb for later retrieval.");let t=e.url;e.url||(t=location.href),yield x.a.put("NotificationOpened",{url:t,data:e,timestamp:Date.now()})}else S.a.trigger(OneSignal.EVENTS.NOTIFICATION_CLICKED,e)})),e.on(se.RedirectPage,e=>{A.a.debug(`${C.a.getWindowEnv().toString()} Picked up command.redirect to ${e}, forwarding to host page.`);const t=OneSignal.proxyFrame;t&&t.messenger.message(OneSignal.POSTMAM_COMMANDS.SERVICEWORKER_COMMAND_REDIRECT,e)}),e.on(se.NotificationDismissed,e=>{S.a.trigger(OneSignal.EVENTS.NOTIFICATION_DISMISSED,e)});const t=E.b.isHttps(),i=E.b.isSafari();e.on(se.AreYouVisible,n=>{if(t&&i){const t={timestamp:n.timestamp,focused:document.hasFocus()};e.directPostMessageToSW(se.AreYouVisibleResponse,t)}else{const e={timestamp:n.timestamp},t=OneSignal.proxyFrame;t&&t.messenger.message(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_REQUEST,e)}})})}installAlternatingWorker(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield this.getActiveState();e===Qe.ThirdParty&&A.a.info("[Service Worker Installation] 3rd party service worker detected.");const t=Xe.getAlternatingServiceWorkerHref(e,this.config,this.context.appConfig.appId),i=`${E.b.getBaseUrl()}${this.config.registrationOptions.scope}`;A.a.info(`[Service Worker Installation] Installing service worker ${t} ${i}.`);try{yield navigator.serviceWorker.register(t,{scope:i})}catch(e){if(A.a.error(`[Service Worker Installation] Installing service worker failed ${e}`),C.a.getWindowEnv()===G.a.OneSignalSubscriptionPopup)throw e;const i=yield fetch(t);if(403===i.status||404===i.status)throw new He(i.status,i.statusText);throw e}A.a.debug("[Service Worker Installation] Service worker installed.")})}}(it=tt||(tt={}))[it.InvalidSafariSetup=0]="InvalidSafariSetup",it[it.Blocked=1]="Blocked",it[it.Dismissed=2]="Dismissed";class ot extends h.a{constructor(e){let t;switch(e){case tt.InvalidSafariSetup:t="The Safari site URL, icon size, or push certificate is invalid, or Safari is in a private session.";break;case tt.Blocked:t="Notification permissions are blocked.";break;case tt.Dismissed:t="The notification permission prompt was dismissed."}super(t),Object.setPrototypeOf(this,ot.prototype)}}class st{constructor(e,t){this.context=e,this.config=t}static isSafari(){return p.a.isSafari()}subscribe(e){return Object(d.a)(this,void 0,void 0,function*(){const t=C.a.getWindowEnv();switch(t){case G.a.CustomIframe:case G.a.Unknown:case G.a.OneSignalProxyFrame:throw new b(o.UnsupportedEnvironment)}let i;switch(t){case G.a.ServiceWorker:i=yield this.subscribeFcmFromWorker(e);break;case G.a.Host:case G.a.OneSignalSubscriptionModal:case G.a.OneSignalSubscriptionPopup:if((yield OneSignal.privateGetNotificationPermission())===R.Denied)throw new Q(J.Blocked);if(st.isSafari()){i=yield this.subscribeSafari(),A.a.info("Installing SW on Safari");try{yield this.context.serviceWorkerManager.installWorker(),A.a.info("SW on Safari successfully installed")}catch(e){A.a.error("SW on Safari failed to install.")}}else i=yield this.subscribeFcmFromPage(e);break;default:throw new b(o.UnsupportedEnvironment)}return i})}registerSubscription(e,t){return Object(d.a)(this,void 0,void 0,function*(){e&&(e=ee.deserialize(e));const i=Y.createFromPushSubscription(this.config.appId,e,t);let n=void 0;(yield this.isAlreadyRegisteredWithOneSignal())?yield this.context.updateManager.sendPlayerUpdate(i):(n=yield this.context.updateManager.sendPlayerCreate(i))&&(yield this.associateSubscriptionWithEmail(n));const o=yield x.a.getSubscription();return o.deviceId=n,o.optedOut=!1,e?st.isSafari()?o.subscriptionToken=e.safariDeviceToken:o.subscriptionToken=e.w3cEndpoint?e.w3cEndpoint.toString():null:o.subscriptionToken=null,yield x.a.setSubscription(o),C.a.getWindowEnv()!==G.a.ServiceWorker&&S.a.trigger(OneSignal.EVENTS.REGISTERED),"undefined"!=typeof OneSignal&&(OneSignal._sessionInitAlreadyRunning=!1),o})}static requestPresubscribeNotificationPermission(){return Object(d.a)(this,void 0,void 0,function*(){return yield st.requestNotificationPermission()})}unsubscribe(e){return Object(d.a)(this,void 0,void 0,function*(){if(0===e)throw new w;if(1!==e)throw new w;if(C.a.getWindowEnv()!==G.a.ServiceWorker)throw new w;{const{deviceId:e}=yield x.a.getSubscription();yield k.updatePlayer(this.context.appConfig.appId,e,{notification_types:z.MutedByApi}),yield x.a.put("Options",{key:"optedOut",value:!0})}})}static requestNotificationPermission(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield window.Notification.requestPermission();return R[e]})}associateSubscriptionWithEmail(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield x.a.getEmailProfile();t.emailId&&(yield k.updatePlayer(this.config.appId,e,{parent_player_id:t.emailId,email:t.emailAddress}))})}isAlreadyRegisteredWithOneSignal(){return Object(d.a)(this,void 0,void 0,function*(){const{deviceId:e}=yield x.a.getSubscription();return!!e})}subscribeSafariPromptPermission(){return new Promise(e=>{window.safari.pushNotification.requestPermission(`${C.a.getOneSignalApiUrl().toString()}/safari`,this.config.safariWebId,{app_id:this.config.appId},t=>{t.deviceToken?e(t.deviceToken.toLowerCase()):e(null)})})}subscribeSafari(){return Object(d.a)(this,void 0,void 0,function*(){const e=new ee;if(!this.config.safariWebId)throw new m(c.MissingSafariWebId);const{deviceToken:t}=window.safari.pushNotification.permission(this.config.safariWebId);e.existingSafariDeviceToken=t,t||S.a.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED);const i=yield this.subscribeSafariPromptPermission();if(X.a.triggerNotificationPermissionChanged(),!i)throw new ot(tt.InvalidSafariSetup);return e.setFromSafariSubscription(i),e})}subscribeFcmFromPage(e){return Object(d.a)(this,void 0,void 0,function*(){if(C.a.getWindowEnv()!==G.a.ServiceWorker&&Notification.permission===R.Default){yield S.a.trigger(OneSignal.EVENTS.PERMISSION_PROMPT_DISPLAYED);const e=yield st.requestPresubscribeNotificationPermission();switch(e===R.Default&&(yield X.a.triggerNotificationPermissionChanged(!0)),e){case R.Default:throw A.a.debug("Exiting subscription and not registering worker because the permission was dismissed."),OneSignal._sessionInitAlreadyRunning=!1,OneSignal._isRegisteringForPush=!1,new Q(J.Dismissed);case R.Denied:throw A.a.debug("Exiting subscription and not registering worker because the permission was blocked."),OneSignal._sessionInitAlreadyRunning=!1,OneSignal._isRegisteringForPush=!1,new Q(J.Blocked)}}try{yield this.context.serviceWorkerManager.installWorker()}catch(e){throw e instanceof He&&(403===e.status?yield this.context.subscriptionManager.registerFailedSubscription(z.ServiceWorkerStatus403,this.context):404===e.status&&(yield this.context.subscriptionManager.registerFailedSubscription(z.ServiceWorkerStatus404,this.context))),e}A.a.debug("[Subscription Manager] Getting OneSignal service Worker...");const t=yield this.context.serviceWorkerManager.getRegistration();if(!t)throw new Error("OneSignal service worker not found!");return A.a.debug("[Subscription Manager] Service worker is ready to continue subscribing."),yield this.subscribeWithVapidKey(t.pushManager,e)})}subscribeFcmFromWorker(e){return Object(d.a)(this,void 0,void 0,function*(){const t=self.registration;if(!t.active&&!g.a.firefox)throw new b(o.ServiceWorkerNotActivated);const i=yield t.pushManager.permissionState({userVisibleOnly:!0});if("denied"===i)throw new Q(J.Blocked);if("prompt"===i)throw new Q(J.Default);return yield this.subscribeWithVapidKey(t.pushManager,e)})}getVapidKeyForBrowser(){let e=void 0;return(e=g.a.firefox?this.config.onesignalVapidPublicKey:this.config.vapidPublicKey)?function(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),n=new Uint8Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);return n}(e).buffer:void 0}subscribeWithVapidKey(e,t){return Object(d.a)(this,void 0,void 0,function*(){const i=yield e.getSubscription();switch(t){case 0:if(!i)break;i.options?A.a.debug("[Subscription Manager] An existing push subscription exists and it's options is not null."):(A.a.debug("[Subscription Manager] An existing push subscription exists and options is null. Unsubscribing from push first now."),yield st.doPushUnsubscribe(i));break;case 1:i&&(yield st.doPushUnsubscribe(i))}const[n,o]=yield st.doPushSubscribe(e,this.getVapidKeyForBrowser());yield st.updateSubscriptionTime(o,n.expirationTime);const s=ee.setFromW3cSubscription(n);return i&&(s.existingW3cPushSubscription=ee.setFromW3cSubscription(i)),s})}static updateSubscriptionTime(e,t){return Object(d.a)(this,void 0,void 0,function*(){const i=yield x.a.getSubscription();e&&(i.createdAt=(new Date).getTime()),i.expirationTime=t,yield x.a.setSubscription(i)})}static doPushUnsubscribe(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug("[Subscription Manager] Unsubscribing existing push subscription.");const t=yield e.unsubscribe();return A.a.debug(`[Subscription Manager] Unsubscribing existing push subscription result: ${t}`),t})}static doPushSubscribe(e,t){return Object(d.a)(this,void 0,void 0,function*(){if(!t)throw new Error("Missing required 'applicationServerKey' to subscribe for push notifications!");const i={userVisibleOnly:!0,applicationServerKey:t};A.a.debug("[Subscription Manager] Subscribing to web push with these options:",i);try{const t=yield e.getSubscription();return[yield e.subscribe(i),!t]}catch(t){if("InvalidStateError"==t.name){A.a.warn("[Subscription Manager] Couldn't re-subscribe due to applicationServerKey changing, unsubscribe and attempting to subscribe with new key.",t);const n=yield e.getSubscription();return n&&(yield st.doPushUnsubscribe(n)),[yield e.subscribe(i),!0]}throw t}})}isSubscriptionExpiring(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield C.a.getIntegration(),t=C.a.getWindowEnv();switch(e){case he.a.Secure:return yield this.isSubscriptionExpiringForSecureIntegration();case he.a.SecureProxy:if(t===G.a.Host){const e=OneSignal.proxyFrameHost;if(e)return yield e.runCommand(OneSignal.POSTMAM_COMMANDS.SUBSCRIPTION_EXPIRATION_STATE);throw new b(o.NoProxyFrame)}return yield this.isSubscriptionExpiringForSecureIntegration();case he.a.InsecureProxy:const{expirationTime:i}=yield x.a.getSubscription();return!!i&&(new Date).getTime()>=i}})}isSubscriptionExpiringForSecureIntegration(){return Object(d.a)(this,void 0,void 0,function*(){const e=yield this.context.serviceWorkerManager.getActiveState();if(e!==Qe.WorkerA&&e!==Qe.WorkerB)return!1;const t=yield this.context.serviceWorkerManager.getRegistration();if(!t)return!1;if(!t.pushManager)return!1;const i=yield t.pushManager.getSubscription();if(!i)return!1;if(!i.expirationTime)return!1;let{createdAt:n}=yield x.a.getSubscription();if(!n){const e=31536e6;n=(new Date).getTime()+e}const o=n+(i.expirationTime-n)/2;return!!i.expirationTime&&((new Date).getTime()>=i.expirationTime||(new Date).getTime()>=o)})}getSubscriptionState(){return Object(d.a)(this,void 0,void 0,function*(){if(st.isSafari())return this.getSubscriptionStateForSecure();const e=C.a.getWindowEnv();switch(e){case G.a.ServiceWorker:const t=yield self.registration.pushManager.getSubscription(),{optedOut:i}=yield x.a.getSubscription();return{subscribed:!!t,optedOut:!!i};default:switch(yield C.a.getIntegration()){case he.a.Secure:return this.getSubscriptionStateForSecure();case he.a.SecureProxy:switch(e){case G.a.OneSignalProxyFrame:case G.a.OneSignalSubscriptionPopup:case G.a.OneSignalSubscriptionModal:return this.getSubscriptionStateForSecure();default:return yield OneSignal.proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.GET_SUBSCRIPTION_STATE)}case he.a.InsecureProxy:return yield this.getSubscriptionStateForInsecure();default:throw new b(o.UnsupportedEnvironment)}}})}getSubscriptionStateForSecure(){return Object(d.a)(this,void 0,void 0,function*(){const{deviceId:e,optedOut:t}=yield x.a.getSubscription();if(st.isSafari()){const i=window.safari.pushNotification.permission(this.config.safariWebId);return{subscribed:!("granted"!==i.permission||!i.deviceToken||!e),optedOut:!!t}}const i=yield this.context.serviceWorkerManager.getActiveState(),n=yield this.context.serviceWorkerManager.getRegistration(),o=yield this.context.permissionManager.getNotificationPermission(this.context.appConfig.safariWebId),s=i===Qe.WorkerA||i===Qe.WorkerB;return n?{subscribed:!(!e||o!==R.Granted||!s),optedOut:!!t}:{subscribed:!1,optedOut:!!t}})}getSubscriptionStateForInsecure(){return Object(d.a)(this,void 0,void 0,function*(){const{deviceId:e,subscriptionToken:t,optedOut:i}=yield x.a.getSubscription(),n=yield this.context.permissionManager.getNotificationPermission(this.context.appConfig.safariWebId);return{subscribed:!(!e||!t||n!==R.Granted),optedOut:!!i}})}registerFailedSubscription(e,t){return Object(d.a)(this,void 0,void 0,function*(){t.pageViewManager.isFirstPageView()&&(t.subscriptionManager.registerSubscription(new ee,e),t.pageViewManager.incrementPageViewCount())})}}var rt=class{static getServiceWorkerManager(e){const t=e.appConfig,i=C.a.getBuildEnvPrefix(),n={workerAPath:new Le(`/${i}OneSignalSDKWorker.js`),workerBPath:new Le(`/${i}OneSignalSDKUpdaterWorker.js`),registrationOptions:{scope:"/"}};return t.userConfig&&(t.userConfig.path&&(n.workerAPath=new Le(`${t.userConfig.path}${t.userConfig.serviceWorkerPath}`),n.workerBPath=new Le(`${t.userConfig.path}${t.userConfig.serviceWorkerUpdaterPath}`)),t.userConfig.serviceWorkerParam&&(n.registrationOptions=t.userConfig.serviceWorkerParam)),new nt(e,n)}static getSubscriptionManager(e){const t=e.appConfig,i={safariWebId:t.safariWebId,appId:t.appId,vapidPublicKey:t.vapidPublicKey,onesignalVapidPublicKey:t.onesignalVapidPublicKey};return new st(e,i)}};class at{constructor(e){this.context=e,this.onSessionSent=e.pageViewManager.getPageViewCount()>1}getDeviceId(){return Object(d.a)(this,void 0,void 0,function*(){const{deviceId:e}=yield x.a.getSubscription();if(!e)throw new f(r.NoDeviceId);return e})}createDeviceRecord(){return Object(d.a)(this,void 0,void 0,function*(){return oe.createDeviceRecord(this.context.appConfig.appId)})}sendPlayerUpdate(e){return Object(d.a)(this,void 0,void 0,function*(){if(!(yield this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal()))return void A.a.debug("Not sending the update because user is not registered with OneSignal (no device id)");const t=yield this.getDeviceId();e||(e=yield this.createDeviceRecord()),this.onSessionSent?yield k.updatePlayer(this.context.appConfig.appId,t,Object.assign({notification_types:z.Subscribed},e.serialize())):yield this.sendOnSessionUpdate(e)})}sendOnSessionUpdate(e){return Object(d.a)(this,void 0,void 0,function*(){if(this.onSessionSent)return;if(!this.context.pageViewManager.isFirstPageView())return;if(!(yield this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal()))return void A.a.debug("Not sending the on session because user is not registered with OneSignal (no device id)");const t=yield this.getDeviceId();if(e||(e=yield this.createDeviceRecord()),e.subscriptionState===z.Subscribed||!0===OneSignal.config.enableOnSession)try{this.context.sessionManager.upsertSession(t,e,ie.b.PlayerOnSession),this.onSessionSent=!0}catch(e){A.a.error(`Failed to update user session. Error "${e.message}" ${e.stack}`)}})}sendPlayerCreate(e){return Object(d.a)(this,void 0,void 0,function*(){try{const t=yield k.createUser(e);return t?(A.a.info("Subscribed to web push and registered with OneSignal",e,t),this.onSessionSent=!0,this.context.sessionManager.upsertSession(t,e,ie.b.PlayerCreate),t):void A.a.error("Failed to create user.")}catch(e){return void A.a.error(`Failed to create user. Error "${e.message}" ${e.stack}`)}})}onSessionAlreadyCalled(){return this.onSessionSent}sendExternalUserIdUpdate(e,t){return Object(d.a)(this,void 0,void 0,function*(){const i=yield this.getDeviceId();t||(t=yield x.a.getExternalUserIdAuthHash());const n={external_user_id:T.b.getValueOrDefault(e,""),external_user_id_auth_hash:T.b.getValueOrDefault(t,void 0)};return yield k.updatePlayer(this.context.appConfig.appId,i,n)})}sendOutcomeDirect(e,t,i,n){return Object(d.a)(this,void 0,void 0,function*(){Object(_.s)("sendOutcomeDirect");const o=yield this.createDeviceRecord(),s={app_id:e,id:i,device_type:o.deliveryPlatform,notification_ids:t,direct:!0};void 0!==n&&(s.weight=n),yield k.sendOutcome(s)})}sendOutcomeInfluenced(e,t,i,n){return Object(d.a)(this,void 0,void 0,function*(){Object(_.s)("sendOutcomeInfluenced");const o=yield this.createDeviceRecord(),s={app_id:e,id:i,device_type:o.deliveryPlatform,notification_ids:t,direct:!1};void 0!==n&&(s.weight=n),yield k.sendOutcome(s)})}sendOutcomeUnattributed(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){Object(_.s)("sendOutcomeUnattributed");const n=yield this.createDeviceRecord(),o={app_id:e,id:t,device_type:n.deliveryPlatform};void 0!==i&&(o.weight=i),yield k.sendOutcome(o)})}}class ct extends h.a{constructor(){super("This operation can only be performed when the user is not subscribed."),Object.setPrototypeOf(this,ct.prototype)}}class lt extends h.a{constructor(){super("The permission message was previously dismissed."),Object.setPrototypeOf(this,lt.prototype)}}const dt={reportingThreshold:30,enableOnSessionForUnsubcribed:!1,enableOnFocus:!0},ut={pageViews:1,timeDelay:0},gt={actionMessage:"We'd like to show you notifications for the latest news and updates.",acceptButton:"Allow",cancelButton:"Cancel",errorButton:"Try Again",categoryDefaults:{updateMessage:"Update your push notification subscription preferences.",positiveUpdateButton:"Save Preferences",negativeUpdateButton:"Cancel"},savingText:"Saving..."};function pt(e){return`<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="24px" height="24px" fill="${e}"> <g transform="rotate(0 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.916s" repeatCount="indefinite"/> </rect> </g> <g transform="rotate(30 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.833s" repeatCount="indefinite"/> </rect> </g> <g transform="rotate(60 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.75s" repeatCount="indefinite"/> </rect> </g> <g transform="rotate(90 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.666s"/> </rect> </g> <g transform="rotate(120 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.583s"/> </rect> </g> <g transform="rotate(150 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.5s"/> </rect> </g> <g transform="rotate(180 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.416s"/> </rect> </g> <g transform="rotate(210 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.333s"/> </rect> </g> <g transform="rotate(240 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.25s"/> </rect> </g> <g transform="rotate(270 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.166s"/> </rect> </g> <g transform="rotate(300 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="-0.083s"/> </rect> </g> <g transform="rotate(330 50 50)"> <rect x="46" y="6" rx="36.8" ry="4.8" width="8" height="24" > <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" repeatCount="indefinite" begin="0s"/> </rect> </g> </svg>`}const ht={allowButton:"onesignal-slidedown-allow-button",body:"slidedown-body",buttonIndicatorHolder:"onesignal-button-indicator-holder",cancelButton:"onesignal-slidedown-cancel-button",container:"onesignal-slidedown-container",dialog:"onesignal-slidedown-dialog",footer:"slidedown-footer",reset:"onesignal-reset",savingStateButton:"onesignal-saving-state-button",slideUp:"slide-up",slideDown:"slide-down",closeSlidedown:"close-slidedown",icon:"slidedown-body-icon",message:"slidedown-body-message",defaultIcon:"default-icon",loadingContainer:"onesignal-loading-container",clearfix:"clearfix"},bt={allowButton:"onesignal-slidedown-allow-button",body:"slidedown-body",buttonIndicatorHolder:"onesignal-button-indicator-holder",cancelButton:"onesignal-slidedown-cancel-button",container:"onesignal-slidedown-container",dialog:"onesignal-slidedown-dialog",footer:"slidedown-footer",normalSlidedown:"normal-slidedown",loadingContainer:"onesignal-loading-container"},ft={alignRight:"align-right",primary:"primary",secondary:"secondary",slidedownButton:"slidedown-button"},mt={categoryLabelInput:"onesignal-category-label-input",categoryLabelText:"onesignal-category-label-text",categoryLabel:"onesignal-category-label",checkmark:"onesignal-checkmark",taggingContainer:"tagging-container",taggingContainerCol:"tagging-container-col",loadingMessage:"onesignal-loading-message"},St={taggingContainer:"tagging-container"},vt="data:image/svg+xml,%3Csvg fill='none' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'%3E%3Cg clip-path='url(%23clip0)'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M33.232 28.434a2.5 2.5 0 001.768.733 1.667 1.667 0 010 3.333H5a1.667 1.667 0 110-3.333 2.5 2.5 0 002.5-2.5v-8.104A13.262 13.262 0 0118.333 5.122V1.667a1.666 1.666 0 113.334 0v3.455A13.262 13.262 0 0132.5 18.563v8.104a2.5 2.5 0 00.732 1.767zM16.273 35h7.454a.413.413 0 01.413.37 4.167 4.167 0 11-8.28 0 .417.417 0 01.413-.37z' fill='%23BDC4CB'/%3E%3C/g%3E%3Cdefs%3E%3CclipPath id='clip0'%3E%3Cpath fill='%23fff' d='M0 0h40v40H0z'/%3E%3C/clipPath%3E%3C/defs%3E%3C/svg%3E",Ot={greyLoadingIndicator:"#95A1AC",whiteLoadingIndicator:"#FFFFFF"},yt={fetchingPreferences:"Fetching your preferences"};class wt{constructor(e){var t,i,n;switch(this.savingButton=gt.savingText,this.errorButton=gt.errorButton,this.options=e,this.options.text.actionMessage=e.text.actionMessage.substring(0,90),this.options.text.acceptButton=e.text.acceptButton.substring(0,16),this.options.text.cancelButton=e.text.cancelButton.substring(0,16),this.notificationIcons=null,this.isShowingFailureState=!1,e.type){case D.Category:this.negativeUpdateButton=null===(t=this.options.text.negativeUpdateButton)||void 0===t?void 0:t.substring(0,16),this.positiveUpdateButton=null===(i=this.options.text.positiveUpdateButton)||void 0===i?void 0:i.substring(0,16),this.updateMessage=null===(n=this.options.text.updateMessage)||void 0===n?void 0:n.substring(0,90),this.tagCategories=e.categories,this.errorButton=T.a.getValueOrDefault(this.options.text.positiveUpdateButton,gt.errorButton)}}create(e){return Object(d.a)(this,void 0,void 0,function*(){if(null===this.notificationIcons){const t=yield oe.getNotificationIcons();this.notificationIcons=t,this.container.className.includes(ht.container)&&Object(_.w)(`#${bt.container}`);const i=e&&this.tagCategories?this.positiveUpdateButton:this.options.text.acceptButton,n=e&&this.tagCategories?this.negativeUpdateButton:this.options.text.cancelButton,o=function(e){const{icon:t,messageText:i,positiveButtonText:n,negativeButtonText:o}=e,s=t===ht.defaultIcon?vt:t,r=t===ht.defaultIcon?ht.defaultIcon:"",a=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div"),g=document.createElement("div"),p=document.createElement("button"),h=document.createElement("button"),b=document.createElement("div"),f=document.createElement("div"),m=document.createElement("img");return Object(_.a)(c,ht.body),Object(_.a)(d,ht.icon),Object(_.a)(l,ht.message),Object(_.a)(g,ht.footer),Object(_.a)(b,ht.clearfix),Object(_.a)(f,ht.clearfix),Object(_.a)(p,ft.alignRight),Object(_.a)(p,ft.primary),Object(_.a)(p,ft.slidedownButton),Object(_.a)(h,ft.alignRight),Object(_.a)(h,ft.secondary),Object(_.a)(h,ft.slidedownButton),a.id=bt.normalSlidedown,c.id=bt.body,u.id=bt.loadingContainer,p.id=bt.allowButton,h.id=bt.cancelButton,g.id=bt.footer,r&&Object(_.a)(m,r),m.setAttribute("alt","notification icon"),m.setAttribute("src",s||""),l.innerText=i||"",p.innerText=n||"",h.innerText=o||"",d.appendChild(m),c.appendChild(d),c.appendChild(l),c.appendChild(b),c.appendChild(u),g.appendChild(p),g.appendChild(h),g.appendChild(f),a.appendChild(c),a.appendChild(g),a}({messageText:e&&this.tagCategories?this.updateMessage:this.options.text.actionMessage,icon:this.getPlatformNotificationIcon(),positiveButtonText:i,negativeButtonText:n}),s=document.createElement("div"),r=document.createElement("div");s.id=bt.container,Object(_.a)(s,ht.container),Object(_.a)(s,ht.reset),Object(_.l)("body").appendChild(s),r.id=bt.dialog,Object(_.a)(r,ht.dialog),r.appendChild(o),this.container.appendChild(r),Object(_.a)(this.container,g.a.mobile?ht.slideUp:ht.slideDown),this.allowButton.addEventListener("click",this.onSlidedownAllowed.bind(this)),this.cancelButton.addEventListener("click",this.onSlidedownCanceled.bind(this)),S.a.trigger(wt.EVENTS.SHOWN)}})}onSlidedownAllowed(e){return Object(d.a)(this,void 0,void 0,function*(){yield S.a.trigger(wt.EVENTS.ALLOW_CLICK)})}onSlidedownCanceled(e){S.a.trigger(wt.EVENTS.CANCEL_CLICK),this.close()}close(){Object(_.a)(this.container,ht.closeSlidedown),Object(_.u)(this.dialog,"animationend",(e,t)=>{e.target!==this.dialog||"slideDownExit"!==e.animationName&&"slideUpExit"!==e.animationName||(Object(_.w)(`#${bt.container}`),t(),S.a.trigger(wt.EVENTS.CLOSED))},!0)}setSaveState(e){this.tagCategories?e?(this.allowButton.disabled=!0,this.allowButton.textContent=null,this.allowButton.insertAdjacentElement("beforeend",this.getTextSpan(this.savingButton)),this.allowButton.insertAdjacentElement("beforeend",this.getIndicatorHolder()),Object(_.b)(this.buttonIndicatorHolder,"beforeend",pt(Ot.whiteLoadingIndicator)),Object(_.a)(this.allowButton,"disabled"),Object(_.a)(this.allowButton,ht.savingStateButton)):(this.allowButton.textContent=this.positiveUpdateButton,Object(_.w)(`#${ht.buttonIndicatorHolder}`),this.allowButton.disabled=!1,Object(_.v)(this.allowButton,"disabled"),Object(_.v)(this.allowButton,ht.savingStateButton)):A.a.debug("Slidedown private category options are not defined")}setFailureState(e){this.tagCategories?(e?(this.allowButton.textContent=null,this.allowButton.insertAdjacentElement("beforeend",this.getTextSpan(this.errorButton)),this.allowButton.insertAdjacentElement("beforeend",this.getIndicatorHolder()),Object(_.b)(this.buttonIndicatorHolder,"beforeend",function(e="#FFFFFF"){return`<svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.711 2.652a5.489 5.489 0 00-4.044 4.05 5.513 5.513 0 00.104 2.968.167.167 0 00.25.089l.893-.588a.667.667 0 011.02.692l-.61 2.937a.667.667 0 01-.786.52L.6 12.713a.667.667 0 01-.232-1.21l.933-.615a.166.166 0 00.063-.2 7.167 7.167 0 018.828-9.516.833.833 0 01-.507 1.587 5.489 5.489 0 00-2.974-.108zM15.75 3.542c.09.096.15.216.172.346a.667.667 0 01-.301.681l-.898.564a.166.166 0 00-.066.2 7.167 7.167 0 01-8.77 9.514.835.835 0 01-.154-1.544.831.831 0 01.646-.048 5.5 5.5 0 006.856-6.949.167.167 0 00-.176-.114.164.164 0 00-.071.026l-.962.604a.667.667 0 01-1.005-.713l.667-2.924a.667.667 0 01.8-.502l2.925.667c.129.03.246.096.336.192z" fill="${e}"/></svg>`}()),Object(_.a)(this.allowButton,"onesignal-error-state-button")):(Object(_.w)("#onesignal-button-indicator-holder"),Object(_.v)(this.allowButton,"onesignal-error-state-button")),this.isShowingFailureState=e):A.a.debug("Slidedown private category options are not defined")}getPlatformNotificationIcon(){return Object(_.m)(this.notificationIcons)}getIndicatorHolder(){const e=document.createElement("div");return e.id=bt.buttonIndicatorHolder,Object(_.a)(e,ht.buttonIndicatorHolder),e}getTextSpan(e){const t=document.createElement("span");return t.textContent=e,t}get container(){return Object(_.l)(`#${bt.container}`)}get dialog(){return Object(_.l)(`#${bt.dialog}`)}get allowButton(){return Object(_.l)(`#${bt.allowButton}`)}get cancelButton(){return Object(_.l)(`#${bt.cancelButton}`)}get buttonIndicatorHolder(){return Object(_.l)(`#${bt.buttonIndicatorHolder}`)}get slidedownFooter(){return Object(_.l)(`#${bt.footer}`)}static get EVENTS(){return{ALLOW_CLICK:"popoverAllowClick",CANCEL_CLICK:"popoverCancelClick",SHOWN:"popoverShown",CLOSED:"popoverClosed"}}}function Et(){return window.top!==window&&"Apple Computer, Inc."===navigator.vendor&&"MacIntel"===navigator.platform}class Pt{static getEnvironmentInfo(){return{browserType:this.getBrowser(),browserVersion:this.getBrowserVersion(),isHttps:this.isHttps(),isUsingSubscriptionWorkaround:this.isUsingSubscriptionWorkaround(),isBrowserAndSupportsServiceWorkers:this.supportsServiceWorkers(),requiresUserInteraction:this.requiresUserInteraction(),osVersion:this.getOsVersion(),canTalkToServiceWorker:this.canTalkToServiceWorker()}}static getBrowser(){return g.a.chrome?te.Chrome:g.a.msedge?te.Edge:g.a.opera?te.Opera:g.a.firefox?te.Firefox:this.isMacOSSafari()?te.Safari:te.Other}static isMacOSSafari(){return void 0!==window.safari||Et()}static getBrowserVersion(){return T.b.parseVersionString(g.a.version)}static isHttps(){return!!window&&(window.location&&"https:"===window.location.protocol)}static isUsingSubscriptionWorkaround(){return E.a.isUsingSubscriptionWorkaround()}static supportsServiceWorkers(){return window.navigator&&"serviceWorker"in window.navigator}static requiresUserInteraction(){return"firefox"===this.getBrowser()&&this.getBrowserVersion()>=72||"safari"===this.getBrowser()&&this.getBrowserVersion()>=12.1}static getOsVersion(){return g.a.osversion}static canTalkToServiceWorker(){return!!window.isSecureContext}}class It{static convertTagsApiToBooleans(e){const t={};return Object.keys(e).forEach(i=>{t[i]="1"===e[i]}),t}static convertTagsBooleansToApi(e){const t={};return Object.keys(e).forEach(i=>{t[i]=!0===e[i]?"1":"0"}),t}static getObjectDifference(e,t){const i={};return Object.keys(e).forEach(n=>{t[n]!==e[n]&&(i[n]=e[n])}),i}static markAllTagsAsSpecified(e,t){e.forEach(e=>{e.checked=t})}static isTagObjectEmpty(e){return 0===Object.keys(e).length}static getCheckedTagCategories(e,t){if(!t)return e;if(It.isTagObjectEmpty(t)){const t=Object(_.h)(e);return It.markAllTagsAsSpecified(t,!0),t}return Object(_.h)(e).map(e=>{const i=t[e.tag];return e.checked=It.getCheckedStatusForTagValue(i),e})}static getCheckedStatusForTagValue(e){return void 0===e||e}static limitCategoriesToMaxCount(e,t){let i=Object(_.h)(e);return i=e.slice(0,t)}}class Ct{mount(e,t){const i=this.generateHtml(e,t);Object(_.l)(`#${bt.body}`).appendChild(i),this.taggingContainer&&this.taggingContainer.addEventListener("change",this.toggleCheckedTag);const n=Object(_.l)(`#${bt.allowButton}`);n.disabled=!1,Object(_.v)(n,"disabled"),Object(_.w)(`#${bt.loadingContainer}`)}load(){const e=Object(_.l)(`#${bt.loadingContainer}`),t=Object(_.l)(`#${bt.allowButton}`),i=document.createElement("div");Object(_.a)(e,`${ht.loadingContainer}`),Object(_.a)(i,mt.loadingMessage),Object(_.a)(t,"disabled"),Object(_.b)(e,"beforeend",pt(Ot.greyLoadingIndicator)),i.innerText=yt.fetchingPreferences,e.appendChild(i),t.disabled=!0}generateHtml(e,t){const i=It.getCheckedTagCategories(e,t),n=i.filter(e=>i.indexOf(e)%2==0),o=i.filter(e=>i.indexOf(e)%2),s=document.createElement("div"),r=document.createElement("div"),a=document.createElement("div");return Object(_.a)(s,mt.taggingContainerCol),Object(_.a)(r,mt.taggingContainerCol),Object(_.a)(a,mt.taggingContainer),a.id=St.taggingContainer,n.forEach(e=>{s.appendChild(this.getCategoryLabelElement(e))}),o.forEach(e=>{r.appendChild(this.getCategoryLabelElement(e))}),a.appendChild(s),a.appendChild(r),a}getCategoryLabelElement(e){const{label:t}=e,i=document.createElement("label"),n=document.createElement("span"),o=document.createElement("input"),s=document.createElement("span"),r=document.createElement("div"),a=document.createElement("div");return Object(_.a)(i,mt.categoryLabel),Object(_.a)(n,mt.categoryLabelText),Object(_.a)(o,mt.categoryLabelInput),Object(_.a)(s,mt.checkmark),i.title=t,n.innerText=t,o.type="checkbox",o.value=e.tag,o.checked=!!e.checked,i.appendChild(n),i.appendChild(o),i.appendChild(s),r.setAttribute("style","clear:both"),a.appendChild(i),a.appendChild(r),a}get taggingContainer(){const e=`#${bt.body} > div.${mt.taggingContainer}`;return Object(_.l)(e)}toggleCheckedTag(e){const t=e.target;if(t&&"checkbox"===t.getAttribute("type")){const e=t.checked;t.setAttribute("checked",e.toString())}}static getValuesFromTaggingContainer(){const e=`#${bt.body} > div.${mt.taggingContainer}`+"> div > div > label > input[type=checkbox]",t={};return document.querySelectorAll(e).forEach(e=>{t[e.value]=e.checked}),t}}class Tt{constructor(e){this.isAutoPromptShowing=!1,this.context=e,this.eventHooksInstalled=!1}checkIfAutoPromptShouldBeShown(e={force:!1}){return Object(d.a)(this,void 0,void 0,function*(){if(this.isAutoPromptShowing)throw new b(o.RedundantPermissionMessage,{permissionPromptType:n.SlidedownPermissionMessage});if(oe.wasHttpsNativePromptDismissed()&&!e.force&&!e.isInUpdateMode)return A.a.info(new lt),!1;if((yield OneSignal.privateGetNotificationPermission())===R.Denied)return A.a.info(new Q(J.Blocked)),!1;if((yield OneSignal.privateIsPushNotificationsEnabled())&&!e.isInUpdateMode)throw new ct;if(!(yield OneSignal.privateGetSubscription()))throw new f(r.OptedOut);return!0})}internalShowAutoPrompt(e={force:!1,forceSlidedownOverNative:!1}){return Object(d.a)(this,void 0,void 0,function*(){var t;if(E.b.logMethodCall("internalShowAutoPrompt",e),!OneSignal.config||!OneSignal.config.userConfig||!OneSignal.config.userConfig.promptOptions)return void A.a.error("OneSignal config was not initialized correctly. Aborting.");const{forceSlidedownOverNative:i}=e,n=OneSignal.config.userConfig.promptOptions;if(!n.native.enabled&&0===n.slidedown.prompts.length)return void A.a.error("No suitable prompt type enabled.");const o=W.isCategorySlidedownConfigured(null===(t=null===n||void 0===n?void 0:n.slidedown)||void 0===t?void 0:t.prompts)?D.Category:D.Push,s=this.getDelayedPromptOptions(n,D.Native),r=this.isPageViewConditionMet(s),a=this.getDelayedPromptOptions(n,o),c=this.isPageViewConditionMet(a),l=s.enabled&&r,d=a.enabled&&c,u=i&&l;if(!l||u){if(d||u){const{timeDelay:t}=d?a:s;this.internalShowDelayedPrompt(o,t||0,e)}}else this.internalShowDelayedPrompt(D.Native,s.timeDelay||0)})}internalShowDelayedPrompt(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){if(E.b.logMethodCall("internalShowDelayedPrompt"),"number"!=typeof t)return void A.a.error("internalShowDelayedPrompt: timeDelay not a number");const{requiresUserInteraction:n}=Pt.getEnvironmentInfo();var o;switch(n&&e===D.Native&&(e=D.Push),t>0&&(yield(o=1e3*t,new Promise(e=>setTimeout(e,o)))),e){case D.Native:this.internalShowNativePrompt();break;case D.Push:this.internalShowSlidedownPrompt(i);break;case D.Category:this.internalShowCategorySlidedown(i);break;default:A.a.error("Invalid Delayed Prompt type")}})}internalShowNativePrompt(){return Object(d.a)(this,void 0,void 0,function*(){E.b.logMethodCall("internalShowNativePrompt"),this.isAutoPromptShowing?A.a.debug("Already showing autoprompt. Abort showing a native prompt."):(this.isAutoPromptShowing=!0,oe.markHttpSlidedownShown(),yield Ue.registerForPushNotifications(),this.isAutoPromptShowing=!1,We.markHttpsNativePromptDismissed())})}internalShowSlidedownPrompt(e={force:!1}){return Object(d.a)(this,void 0,void 0,function*(){var t;E.b.logMethodCall("internalShowSlidedownPrompt");const{categories:i,isInUpdateMode:n}=e;if(this.isAutoPromptShowing)return void A.a.debug("Already showing slidedown. Abort.");try{if(!(yield this.checkIfAutoPromptShouldBeShown(e)))return}catch(e){return void A.a.warn("checkIfAutoPromptShouldBeShown returned an error",e)}if(oe.markHttpSlidedownShown(),0!==(yield this.context.dynamicResourceLoader.loadSdkStylesheet()))return void A.a.debug("Not showing slidedown permission message because styles failed to load.");const o=oe.getSlidedownOptions(OneSignal.config.userConfig.promptOptions);this.eventHooksInstalled||this.installEventHooksForSlidedown();const s=W.getFirstSlidedownPromptOptionsWithType(o.prompts,D.Category)||W.getFirstSlidedownPromptOptionsWithType(o.prompts,D.Push);OneSignal.slidedown=new wt(s);try{const{promptOptions:e}=this.context.appConfig.userConfig;if(W.isCategorySlidedownConfigured(null===(t=null===e||void 0===e?void 0:e.slidedown)||void 0===t?void 0:t.prompts)&&i){yield OneSignal.slidedown.create(n);let e={};const t=new Ct;if(n){t.load();const i=yield OneSignal.getTags();this.context.tagManager.storeRemotePlayerTags(i),e=It.convertTagsApiToBooleans(i)}else It.markAllTagsAsSpecified(i,!0);t.mount(i,e)}}catch(e){A.a.error("OneSignal: Attempted to create tagging container with error",e)}yield OneSignal.slidedown.create(),A.a.debug("Showing Slidedown.")})}internalShowCategorySlidedown(e){return Object(d.a)(this,void 0,void 0,function*(){var t,i;const n=null===(i=null===(t=this.context.appConfig.userConfig.promptOptions)||void 0===t?void 0:t.slidedown)||void 0===i?void 0:i.prompts;if(n&&!W.isCategorySlidedownConfigured(n))return void A.a.error("OneSignal: no categories to display. Check your configuration on the OneSignal dashboard or your custom code initialization.");const o=W.getFirstSlidedownPromptOptionsWithType(n,D.Category),s=null===o||void 0===o?void 0:o.categories;yield this.internalShowSlidedownPrompt(Object.assign(Object.assign({},e),{categories:s}))})}installEventHooksForSlidedown(){this.eventHooksInstalled=!0,function(){const e=OneSignal.notifyButton;e&&e.options.enable&&"hidden"!==OneSignal.notifyButton.launcher.state&&OneSignal.notifyButton.launcher.waitUntilShown().then(()=>{OneSignal.notifyButton.launcher.hide()}),OneSignal.emitter.once(wt.EVENTS.CLOSED,()=>{OneSignal.notifyButton&&OneSignal.notifyButton.options.enable&&OneSignal.notifyButton.launcher.show()})}(),OneSignal.emitter.on(wt.EVENTS.SHOWN,()=>{this.isAutoPromptShowing=!0}),OneSignal.emitter.on(wt.EVENTS.CLOSED,()=>{this.isAutoPromptShowing=!1}),OneSignal.emitter.on(wt.EVENTS.ALLOW_CLICK,()=>Object(d.a)(this,void 0,void 0,function*(){const{slidedown:e}=OneSignal;e.isShowingFailureState&&e.setFailureState(!1);const t=Ct.getValuesFromTaggingContainer();if(this.context.tagManager.storeTagValuesToUpdate(t),H.getIsPushNotificationsEnabled()){OneSignal.slidedown.setSaveState(!0);try{yield this.context.tagManager.sendTags(!0)}catch(e){return A.a.error("Failed to update tags",e),OneSignal.slidedown.setSaveState(!1),void OneSignal.slidedown.setFailureState(!0)}}else{const e={autoAccept:!OneSignal.environmentInfo.requiresUserInteraction,slidedown:!0};Ue.registerForPushNotifications(e)}OneSignal.slidedown&&OneSignal.slidedown.close(),A.a.debug("Setting flag to not show the slidedown to the user again."),We.markHttpsNativePromptDismissed()})),OneSignal.emitter.once(wt.EVENTS.CANCEL_CLICK,()=>{A.a.debug("Setting flag to not show the slidedown to the user again."),We.markHttpsNativePromptDismissed()})}isPageViewConditionMet(e){if(!e||void 0===e.pageViews)return!1;if(!e.autoPrompt||!e.enabled)return!1;return this.context.pageViewManager.getLocalPageViewCount()>=e.pageViews}getDelayedPromptOptions(e,t){var i,n,o,s;const r={enabled:!1,autoPrompt:!1,timeDelay:ut.timeDelay,pageViews:ut.pageViews};if(!e||!e.native||!e.slidedown)return r;switch(t){case D.Native:const a=e.native;return{enabled:null===a||void 0===a?void 0:a.enabled,autoPrompt:null===a||void 0===a?void 0:a.autoPrompt,timeDelay:null===a||void 0===a?void 0:a.timeDelay,pageViews:null===a||void 0===a?void 0:a.pageViews};case D.Push:case D.Category:case D.Email:case D.Sms:case D.SmsAndEmail:const{userConfig:c}=this.context.appConfig,l=W.getFirstSlidedownPromptOptionsWithType((null===(n=null===(i=c.promptOptions)||void 0===i?void 0:i.slidedown)||void 0===n?void 0:n.prompts)||[],t);return{enabled:!!l,autoPrompt:!!(null===l||void 0===l?void 0:l.autoPrompt),timeDelay:null===(o=null===l||void 0===l?void 0:l.delay)||void 0===o?void 0:o.timeDelay,pageViews:null===(s=null===l||void 0===l?void 0:l.delay)||void 0===s?void 0:s.pageViews};default:return r}}}class At{constructor(e){this.onSessionSent=!1,this.context=e}notifySWToUpsertSession(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){const n=E.a.isHttps(),o={deviceId:e,deviceRecord:t.serialize(),sessionThreshold:this.context.appConfig.sessionThreshold||0,enableSessionDuration:!!this.context.appConfig.enableSessionDuration,sessionOrigin:i,isHttps:n,isSafari:E.a.isSafari(),outcomesConfig:this.context.appConfig.userConfig.outcomes};this.context.environmentInfo.isBrowserAndSupportsServiceWorkers&&!this.context.environmentInfo.isUsingSubscriptionWorkaround?(A.a.debug("Notify SW to upsert session"),yield this.context.workerMessenger.unicast(se.SessionUpsert,o)):this.context.environmentInfo.canTalkToServiceWorker&&this.context.environmentInfo.isUsingSubscriptionWorkaround?(A.a.debug("Notify iframe to notify SW to upsert session"),yield OneSignal.proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.SESSION_UPSERT,o)):A.a.debug("Notify upsert: do nothing")})}notifySWToDeactivateSession(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){const n=E.a.isHttps(),o={deviceId:e,deviceRecord:t?t.serialize():void 0,sessionThreshold:this.context.appConfig.sessionThreshold,enableSessionDuration:this.context.appConfig.enableSessionDuration,sessionOrigin:i,isHttps:n,isSafari:E.a.isSafari(),outcomesConfig:this.context.appConfig.userConfig.outcomes};this.context.environmentInfo.isBrowserAndSupportsServiceWorkers&&!this.context.environmentInfo.isUsingSubscriptionWorkaround?(A.a.debug("Notify SW to deactivate session"),yield this.context.workerMessenger.unicast(se.SessionDeactivate,o)):this.context.environmentInfo.canTalkToServiceWorker&&this.context.environmentInfo.isUsingSubscriptionWorkaround?(A.a.debug("Notify SW to deactivate session"),yield OneSignal.proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.SESSION_DEACTIVATE,o)):A.a.debug("Notify deactivate: do nothing")})}handleVisibilityChange(){return Object(d.a)(this,void 0,void 0,function*(){const e=document.visibilityState,[t,i]=yield Promise.all([oe.getDeviceId(),oe.createDeviceRecord(this.context.appConfig.appId,!0)]);if("visible"===e)return this.setupOnFocusAndOnBlurForSession(),A.a.debug("handleVisibilityChange","visible",`hasFocus: ${document.hasFocus()}`),void(document.hasFocus()&&(yield this.notifySWToUpsertSession(t,i,ie.b.VisibilityVisible)));if("hidden"!==e)A.a.warn("Unhandled visibility state happened",e);else{A.a.debug("handleVisibilityChange","hidden"),OneSignal.cache.focusHandler&&OneSignal.cache.isFocusEventSetup&&(window.removeEventListener("focus",OneSignal.cache.focusHandler,!0),OneSignal.cache.isFocusEventSetup=!1),OneSignal.cache.blurHandler&&OneSignal.cache.isBlurEventSetup&&(window.removeEventListener("blur",OneSignal.cache.blurHandler,!0),OneSignal.cache.isBlurEventSetup=!1);const[e,t]=yield Promise.all([oe.getDeviceId(),oe.createDeviceRecord(this.context.appConfig.appId)]);yield this.notifySWToDeactivateSession(e,t,ie.b.VisibilityHidden)}})}handleOnBeforeUnload(){return Object(d.a)(this,void 0,void 0,function*(){const e=E.a.isHttps(),t={sessionThreshold:this.context.appConfig.sessionThreshold,enableSessionDuration:this.context.appConfig.enableSessionDuration,sessionOrigin:ie.b.BeforeUnload,isHttps:e,isSafari:E.a.isSafari(),outcomesConfig:this.context.appConfig.userConfig.outcomes};e?(A.a.debug("Notify SW to deactivate session (beforeunload)"),this.context.workerMessenger.directPostMessageToSW(se.SessionDeactivate,t)):(A.a.debug("Notify iframe to notify SW to deactivate session (beforeunload)"),yield OneSignal.proxyFrameHost.runCommand(OneSignal.POSTMAM_COMMANDS.SESSION_DEACTIVATE,t))})}handleOnFocus(e){return Object(d.a)(this,void 0,void 0,function*(){if(A.a.debug("handleOnFocus",e),e.target!==window)return;const[t,i]=yield Promise.all([oe.getDeviceId(),oe.createDeviceRecord(this.context.appConfig.appId,!0)]);yield this.notifySWToUpsertSession(t,i,ie.b.Focus)})}handleOnBlur(e){return Object(d.a)(this,void 0,void 0,function*(){if(A.a.debug("handleOnBlur",e),e.target!==window)return;const[t,i]=yield Promise.all([oe.getDeviceId(),oe.createDeviceRecord(this.context.appConfig.appId)]);yield this.notifySWToDeactivateSession(t,i,ie.b.Blur)})}upsertSession(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){const n=this.notifySWToUpsertSession(e,t,i);this.context.environmentInfo.isBrowserAndSupportsServiceWorkers||this.context.environmentInfo.isUsingSubscriptionWorkaround?this.context.environmentInfo.canTalkToServiceWorker?this.setupSessionEventListeners():(this.onSessionSent=i===ie.b.PlayerCreate,OneSignal.emitter.emit(OneSignal.EVENTS.SESSION_STARTED)):this.context.environmentInfo.isBrowserAndSupportsServiceWorkers||this.context.environmentInfo.isUsingSubscriptionWorkaround||(this.onSessionSent=i===ie.b.PlayerCreate,OneSignal.emitter.emit(OneSignal.EVENTS.SESSION_STARTED)),yield n})}setupSessionEventListeners(){this.context.environmentInfo.isBrowserAndSupportsServiceWorkers||this.context.environmentInfo.isUsingSubscriptionWorkaround?this.context.environmentInfo.canTalkToServiceWorker?(this.setupOnFocusAndOnBlurForSession(),OneSignal.cache.isVisibilityChangeEventSetup||(document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this),!0),OneSignal.cache.isVisibilityChangeEventSetup=!0),OneSignal.cache.isBeforeUnloadEventSetup||(window.addEventListener("beforeunload",e=>{this.handleOnBeforeUnload(),delete e.returnValue},!0),OneSignal.cache.isBeforeUnloadEventSetup=!0)):A.a.debug("Not setting session event listeners. Can't talk to ServiceWorker due being hosted on an HTTP page."):A.a.debug("Not setting session event listeners. No service worker possible.")}setupOnFocusAndOnBlurForSession(){A.a.debug("setupOnFocusAndOnBlurForSession"),OneSignal.cache.focusHandler||(OneSignal.cache.focusHandler=this.handleOnFocus.bind(this)),OneSignal.cache.isFocusEventSetup||(window.addEventListener("focus",OneSignal.cache.focusHandler,!0),OneSignal.cache.isFocusEventSetup=!0),OneSignal.cache.blurHandler||(OneSignal.cache.blurHandler=this.handleOnBlur.bind(this)),OneSignal.cache.isBlurEventSetup||(window.addEventListener("blur",OneSignal.cache.blurHandler,!0),OneSignal.cache.isBlurEventSetup=!0)}static setupSessionEventListenersForHttp(){OneSignal.context&&OneSignal.context.sessionManager?OneSignal.context.sessionManager.setupSessionEventListeners():A.a.error("OneSignal.context not available for http to setup session event listeners.")}sendOnSessionUpdateFromPage(e){return Object(d.a)(this,void 0,void 0,function*(){if(this.onSessionSent)return;if(!this.context.pageViewManager.isFirstPageView())return;if(!(yield this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal()))return void A.a.debug("Not sending the on session because user is not registered with OneSignal (no device id)");const t=yield oe.getDeviceId();if(e||(e=yield oe.createDeviceRecord(this.context.appConfig.appId)),e.subscriptionState===z.Subscribed||!0===OneSignal.config.enableOnSession)try{const i=yield k.updateUserSession(t,e);if(this.onSessionSent=!0,i!==t){const e=yield x.a.getSubscription();e.deviceId=i,yield x.a.setSubscription(e)}}catch(e){A.a.error(`Failed to update user session. Error "${e.message}" ${e.stack}`)}})}}class Nt{constructor(e){this.tagsFromTaggingContainer={},this.remoteTags={},this.context=e}sendTags(){return Object(d.a)(this,void 0,void 0,function*(){A.a.info("Category Slidedown Local Tags:",this.tagsFromTaggingContainer);const e=It.convertTagsBooleansToApi(this.tagsFromTaggingContainer),t=It.getObjectDifference(e,this.remoteTags);return It.isTagObjectEmpty(t)?(A.a.warn("OneSignal: no change detected in Category preferences. Skipping tag update."),t):yield OneSignal.sendTags(t)})}storeTagValuesToUpdate(e){this.tagsFromTaggingContainer=e}storeRemotePlayerTags(e){this.context.tagManager.remoteTags=e}}class Mt{constructor(e){this.appConfig=e,"undefined"!=typeof OneSignal&&OneSignal.environmentInfo&&(this.environmentInfo=OneSignal.environmentInfo),this.subscriptionManager=rt.getSubscriptionManager(this),this.serviceWorkerManager=rt.getServiceWorkerManager(this),this.pageViewManager=new Be,this.permissionManager=new B,this.workerMessenger=new ge(this),this.updateManager=new at(this),this.sessionManager=new At(this),this.tagManager=new Nt(this),this.promptsManager=new Tt(this),this.dynamicResourceLoader=new pe,this.metricsManager=new De(e.metrics.enable,e.metrics.mixpanelReportingToken)}}var kt,xt,_t,jt,Dt,Rt=i(24),Ut=i.n(Rt);class Wt{static getPlayer(e,t){return k.getPlayer(e,t)}static updatePlayer(e,t,i){return k.updatePlayer(e,t,i)}static sendNotification(e,t,i,n,o,s,r,a){return k.sendNotification(e,t,i,n,o,s,r,a)}static jsonpLib(e,t){Ut()(e,null,t)}static downloadServerAppConfig(e){return Object(d.a)(this,void 0,void 0,function*(){return C.a.getWindowEnv()!==G.a.ServiceWorker?yield new Promise((t,i)=>{Wt.jsonpLib(`${C.a.getOneSignalApiUrl().toString()}/sync/${e}/web`,(e,n)=>{e?i(e):n.success?t(n):i(n)})}):yield ze.downloadServerAppConfig(e)})}static createUser(e){return Object(d.a)(this,void 0,void 0,function*(){return yield k.createUser(e)})}static createEmailRecord(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){return yield k.createEmailRecord(e,t,i)})}static updateEmailRecord(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){return yield k.updateEmailRecord(e,t,i)})}static logoutEmail(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){return yield k.logoutEmail(e,t,i)})}static updateUserSession(e,t){return Object(d.a)(this,void 0,void 0,function*(){return yield k.updateUserSession(e,t)})}}!function(e){e.TypicalSite="typical",e.WordPress="wordpress",e.Shopify="shopify",e.Blogger="blogger",e.Magento="magento",e.Drupal="drupal",e.SquareSpace="squarespace",e.Joomla="joomla",e.Weebly="weebly",e.Wix="wix",e.Custom="custom"}(kt||(kt={})),function(e){e.Exact="exact",e.Origin="origin"}(xt||(xt={})),function(e){e.Navigate="navigate",e.Focus="focus"}(_t||(_t={}));class Bt{static upgradeConfigToVersionTwo(e){var t,i,n;Bt.isPromptOptionsVersion0(e.promptOptions)&&(e.promptOptions=Bt.convertConfigToVersionOne(e.promptOptions)),Bt.isSlidedownConfigVersion1(null===(t=e.promptOptions)||void 0===t?void 0:t.slidedown)&&(null===(i=e.promptOptions)||void 0===i?void 0:i.slidedown)&&(e.promptOptions.slidedown=Bt.convertConfigToVersionTwo(null===(n=e.promptOptions)||void 0===n?void 0:n.slidedown))}static convertConfigToVersionOne(e){e.slidedown||(e.slidedown={});const{acceptButtonText:t,cancelButtonText:i,actionMessage:n}=e.slidedown,o=e.acceptButtonText||e.acceptButton,s=e.cancelButtonText||e.cancelButton;return e.slidedown.acceptButtonText=t||o,e.slidedown.cancelButtonText=i||s,e.slidedown.actionMessage=n||e.actionMessage,e}static convertConfigToVersionTwo(e){var t,i,n,o;const s=W.isCategorySlidedownConfiguredVersion1(e)?D.Category:D.Push;let r,a;return s===D.Category&&(r=null===(t=e.categories)||void 0===t?void 0:t.positiveUpdateButton,a=null===(i=e.categories)||void 0===i?void 0:i.negativeUpdateButton),{prompts:[...e.prompts||[],{type:s,autoPrompt:e.autoPrompt,text:{actionMessage:e.actionMessage,acceptButton:e.acceptButton||e.acceptButtonText,cancelButton:e.cancelButton||e.cancelButtonText,positiveUpdateButton:r,negativeUpdateButton:a,updateMessage:null===(n=null===e||void 0===e?void 0:e.categories)||void 0===n?void 0:n.updateMessage},delay:{pageViews:e.pageViews,timeDelay:e.timeDelay},categories:null===(o=null===e||void 0===e?void 0:e.categories)||void 0===o?void 0:o.tags}]}}static isPromptOptionsVersion0(e){if(e){const t=["acceptButtonText","cancelButtonText","actionMessage"];for(let i=0;i<t.length;i++)if(e.hasOwnProperty(t[i]))return!0}return!1}static isSlidedownConfigVersion1(e){if(e){const t=["enabled","autoPrompt","pageViews","timeDelay","acceptButton","acceptButtonText","cancelButton","cancelButtonText","actionMessage","customizeTextEnabled","categories"];for(let i=0;i<t.length;i++)if(e.hasOwnProperty(t[i]))return!0}return!1}}(Dt=jt||(jt={}))[Dt.Dashboard=0]="Dashboard",Dt[Dt.JavaScript=1]="JavaScript";const Lt=10;class Vt{static getAppConfig(e,t){return Object(d.a)(this,void 0,void 0,function*(){try{if(!e||!e.appId||!E.b.isValidUuid(e.appId))throw new m(c.InvalidAppId);const i=yield t(e.appId);Bt.upgradeConfigToVersionTwo(e);const n=this.getMergedConfig(e,i);return this.checkRestrictedOrigin(n),n}catch(e){if(e){if(1===e.code)throw new m(c.InvalidAppId);if(2===e.code)throw new m(c.AppNotConfiguredForWebPush)}throw e}})}static checkRestrictedOrigin(e){if(e.restrictedOriginEnabled&&C.a.getWindowEnv()!==G.a.ServiceWorker&&window.top===window&&!T.b.contains(window.location.hostname,".os.tc")&&!T.b.contains(window.location.hostname,".onesignal.com")&&!this.doesCurrentOriginMatchConfigOrigin(e.origin))throw new m(c.WrongSiteUrl,{siteUrl:e.origin})}static doesCurrentOriginMatchConfigOrigin(e){try{return location.origin===new URL(e).origin}catch(e){return!1}}static getIntegrationCapabilities(e){switch(e){case kt.Custom:case kt.WordPress:return{configuration:jt.JavaScript};default:return{configuration:jt.Dashboard}}}static getMergedConfig(e,t){const i=this.getConfigIntegrationKind(t),n=this.getSubdomainForConfigIntegrationKind(i,e,t),o=t.config.setupBehavior?t.config.setupBehavior.allowLocalhostAsSecureOrigin:e.allowLocalhostAsSecureOrigin,s=E.b.internalIsUsingSubscriptionWorkaround(n,o),r=this.getUserConfigForConfigIntegrationKind(i,e,t,s);return{appId:t.app_id,subdomain:n,siteName:t.config.siteInfo.name,origin:t.config.origin,httpUseOneSignalCom:t.config.http_use_onesignal_com,restrictedOriginEnabled:t.features.restrict_origin&&t.features.restrict_origin.enable,metrics:{enable:t.features.metrics.enable,mixpanelReportingToken:t.features.metrics.mixpanel_reporting_token},safariWebId:t.config.safari_web_id,vapidPublicKey:t.config.vapid_public_key,onesignalVapidPublicKey:t.config.onesignal_vapid_public_key,userConfig:r,receiveReceiptsEnable:t.features.receive_receipts_enable||!1,enableOnSession:T.b.valueOrDefault(t.features.enable_on_session,dt.enableOnSessionForUnsubcribed),sessionThreshold:T.b.valueOrDefault(t.features.session_threshold,dt.reportingThreshold),enableSessionDuration:T.b.valueOrDefault(t.features.web_on_focus_enabled,dt.enableOnFocus)}}static getConfigIntegrationKind(e){return e.config.integration?e.config.integration.kind:kt.Custom}static getCustomLinkConfig(e){const t={enabled:!1,style:"button",size:"medium",unsubscribeEnabled:!1,text:{explanation:"",subscribe:"",unsubscribe:""},color:{button:"",text:""}};if(!(e&&e.config&&e.config.staticPrompts&&e.config.staticPrompts.customlink&&e.config.staticPrompts.customlink.enabled))return t;const i=e.config.staticPrompts.customlink;return{enabled:i.enabled,style:i.style,size:i.size,unsubscribeEnabled:i.unsubscribeEnabled,text:i.text?{subscribe:i.text.subscribe,unsubscribe:i.text.unsubscribe,explanation:i.text.explanation}:t.text,color:i.color?{button:i.color.button,text:i.color.text}:t.color}}static injectDefaultsIntoPromptOptions(e,t,i,n=!1){var o,s;let r={enabled:!1};e&&e.customlink&&(r=e.customlink);const a=t.customlink,c=Object.assign(Object.assign({},e),{customlink:{enabled:T.b.getValueOrDefault(r.enabled,a.enabled),style:T.b.getValueOrDefault(r.style,a.style),size:T.b.getValueOrDefault(r.size,a.size),unsubscribeEnabled:T.b.getValueOrDefault(r.unsubscribeEnabled,a.unsubscribeEnabled),text:{subscribe:T.b.getValueOrDefault(r.text?r.text.subscribe:void 0,a.text.subscribe),unsubscribe:T.b.getValueOrDefault(r.text?r.text.unsubscribe:void 0,a.text.unsubscribe),explanation:T.b.getValueOrDefault(r.text?r.text.explanation:void 0,a.text.explanation)},color:{button:T.b.getValueOrDefault(r.color?r.color.button:void 0,a.color.button),text:T.b.getValueOrDefault(r.color?r.color.text:void 0,a.color.text)}}});if(c.slidedown)c.slidedown.prompts=null===(s=null===(o=c.slidedown)||void 0===o?void 0:o.prompts)||void 0===s?void 0:s.map(e=>{var t,i,n,o,s;if(e.type=T.b.getValueOrDefault(e.type,D.Push),e.type===D.Category&&(e.text=Object.assign(Object.assign({},e.text),{positiveUpdateButton:T.b.getValueOrDefault(e.text.positiveUpdateButton,gt.categoryDefaults.positiveUpdateButton),negativeUpdateButton:T.b.getValueOrDefault(e.text.negativeUpdateButton,gt.categoryDefaults.negativeUpdateButton),updateMessage:T.b.getValueOrDefault(e.text.updateMessage,gt.categoryDefaults.updateMessage)})),e.text=Object.assign(Object.assign({},e.text),{actionMessage:T.b.getValueOrDefault(null===(t=null===e||void 0===e?void 0:e.text)||void 0===t?void 0:t.actionMessage,gt.actionMessage),acceptButton:T.b.getValueOrDefault(null===(i=null===e||void 0===e?void 0:e.text)||void 0===i?void 0:i.acceptButton,gt.acceptButton),cancelButton:T.b.getValueOrDefault(null===(n=null===e||void 0===e?void 0:e.text)||void 0===n?void 0:n.cancelButton,gt.cancelButton)}),e.autoPrompt=T.b.getValueOrDefault(e.autoPrompt,!0),e.delay={pageViews:T.b.getValueOrDefault(null===(o=e.delay)||void 0===o?void 0:o.pageViews,ut.pageViews),timeDelay:T.b.getValueOrDefault(null===(s=e.delay)||void 0===s?void 0:s.timeDelay,ut.timeDelay)},e.categories){const{categories:t}=e;e.categories=It.limitCategoriesToMaxCount(t,Lt)}return e});else{c.slidedown={prompts:[]};const e={timeDelay:ut.timeDelay,pageViews:ut.pageViews},t={type:D.Push,text:{actionMessage:gt.actionMessage,acceptButton:gt.acceptButton,cancelButton:gt.cancelButton},autoPrompt:!1,delay:e};c.slidedown.prompts=[t]}if(c.native?(c.native.enabled=!!c.native.enabled,c.native.autoPrompt=c.native.hasOwnProperty("autoPrompt")?!!c.native.enabled&&!!c.native.autoPrompt:!!c.native.enabled,c.native.pageViews=T.b.getValueOrDefault(c.native.pageViews,ut.pageViews),c.native.timeDelay=T.b.getValueOrDefault(c.native.timeDelay,ut.timeDelay)):c.native={enabled:!1,autoPrompt:!1,pageViews:ut.pageViews,timeDelay:ut.timeDelay},!0===i.autoRegister)if(n){c.native.enabled=!1,c.native.autoPrompt=!1;const e={actionMessage:gt.actionMessage,acceptButton:gt.acceptButton,cancelButton:gt.cancelButton};c.slidedown.prompts=[{type:D.Push,autoPrompt:!0,text:e}]}else c.native.enabled=!0,c.native.autoPrompt=!0;return c.autoPrompt=c.native.autoPrompt||W.isSlidedownAutoPromptConfigured(c.slidedown.prompts),c}static getPromptOptionsForDashboardConfiguration(e){const t=e.config.staticPrompts,i=t.native?{enabled:t.native.enabled,autoPrompt:t.native.enabled&&!1!==t.native.autoPrompt,pageViews:T.b.getValueOrDefault(t.native.pageViews,ut.pageViews),timeDelay:T.b.getValueOrDefault(t.native.timeDelay,ut.timeDelay)}:{enabled:!1,autoPrompt:!1,pageViews:ut.pageViews,timeDelay:ut.timeDelay},{prompts:n}=t.slidedown;return{autoPrompt:i.autoPrompt||W.isSlidedownAutoPromptConfigured(n),native:i,slidedown:{prompts:n},fullscreen:{enabled:t.fullscreen.enabled,actionMessage:t.fullscreen.actionMessage,acceptButton:t.fullscreen.acceptButton,cancelButton:t.fullscreen.cancelButton,title:t.fullscreen.title,message:t.fullscreen.message,caption:t.fullscreen.caption,autoAcceptTitle:t.fullscreen.autoAcceptTitle},customlink:this.getCustomLinkConfig(e)}}static getUserConfigForConfigIntegrationKind(e,t,i,n=!1){switch(this.getIntegrationCapabilities(e).configuration){case jt.Dashboard:return{appId:i.app_id,autoRegister:!1,autoResubscribe:i.config.autoResubscribe,path:i.config.serviceWorker.path,serviceWorkerPath:i.config.serviceWorker.workerName,serviceWorkerUpdaterPath:i.config.serviceWorker.updaterWorkerName,serviceWorkerParam:{scope:i.config.serviceWorker.registrationScope},subdomainName:i.config.siteInfo.proxyOrigin,promptOptions:this.getPromptOptionsForDashboardConfiguration(i),welcomeNotification:{disable:!i.config.welcomeNotification.enable,title:i.config.welcomeNotification.title,message:i.config.welcomeNotification.message,url:i.config.welcomeNotification.url},notifyButton:{enable:i.config.staticPrompts.bell.enabled,displayPredicate:i.config.staticPrompts.bell.hideWhenSubscribed?()=>OneSignal.isPushNotificationsEnabled().then(e=>!e):null,size:i.config.staticPrompts.bell.size,position:i.config.staticPrompts.bell.location,showCredit:!1,offset:{bottom:`${i.config.staticPrompts.bell.offset.bottom}px`,left:`${i.config.staticPrompts.bell.offset.left}px`,right:`${i.config.staticPrompts.bell.offset.right}px`},colors:{"circle.background":i.config.staticPrompts.bell.color.main,"circle.foreground":i.config.staticPrompts.bell.color.accent,"badge.background":"black","badge.foreground":"white","badge.bordercolor":"black","pulse.color":i.config.staticPrompts.bell.color.accent,"dialog.button.background.hovering":i.config.staticPrompts.bell.color.main,"dialog.button.background.active":i.config.staticPrompts.bell.color.main,"dialog.button.background":i.config.staticPrompts.bell.color.main,"dialog.button.foreground":"white"},text:{"tip.state.unsubscribed":i.config.staticPrompts.bell.tooltip.unsubscribed,"tip.state.subscribed":i.config.staticPrompts.bell.tooltip.subscribed,"tip.state.blocked":i.config.staticPrompts.bell.tooltip.blocked,"message.prenotify":i.config.staticPrompts.bell.tooltip.unsubscribed,"message.action.subscribing":i.config.staticPrompts.bell.message.subscribing,"message.action.subscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.resubscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.unsubscribed":i.config.staticPrompts.bell.message.unsubscribing,"dialog.main.title":i.config.staticPrompts.bell.dialog.main.title,"dialog.main.button.subscribe":i.config.staticPrompts.bell.dialog.main.subscribeButton,"dialog.main.button.unsubscribe":i.config.staticPrompts.bell.dialog.main.unsubscribeButton,"dialog.blocked.title":i.config.staticPrompts.bell.dialog.blocked.title,"dialog.blocked.message":i.config.staticPrompts.bell.dialog.blocked.message}},persistNotification:i.config.notificationBehavior?i.config.notificationBehavior.display.persist:void 0,webhooks:{cors:i.config.webhooks.corsEnable,"notification.displayed":i.config.webhooks.notificationDisplayedHook,"notification.clicked":i.config.webhooks.notificationClickedHook,"notification.dismissed":i.config.webhooks.notificationDismissedHook},notificationClickHandlerMatch:i.config.notificationBehavior?i.config.notificationBehavior.click.match:void 0,notificationClickHandlerAction:i.config.notificationBehavior?i.config.notificationBehavior.click.action:void 0,allowLocalhostAsSecureOrigin:i.config.setupBehavior?i.config.setupBehavior.allowLocalhostAsSecureOrigin:void 0,requiresUserPrivacyConsent:t.requiresUserPrivacyConsent,outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}};case jt.JavaScript:const o=Object.assign(Object.assign(Object.assign(Object.assign({},t),{promptOptions:this.injectDefaultsIntoPromptOptions(t.promptOptions,i.config.staticPrompts,t,n)}),{serviceWorkerParam:"undefined"!=typeof OneSignal&&OneSignal.SERVICE_WORKER_PARAM?OneSignal.SERVICE_WORKER_PARAM:{scope:"/"},serviceWorkerPath:"undefined"!=typeof OneSignal&&OneSignal.SERVICE_WORKER_PATH?OneSignal.SERVICE_WORKER_PATH:"OneSignalSDKWorker.js",serviceWorkerUpdaterPath:"undefined"!=typeof OneSignal&&OneSignal.SERVICE_WORKER_UPDATER_PATH?OneSignal.SERVICE_WORKER_UPDATER_PATH:"OneSignalSDKUpdaterWorker.js",path:t.path?t.path:"/"}),{outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}});return t.hasOwnProperty("autoResubscribe")?o.autoResubscribe=!!t.autoResubscribe:t.hasOwnProperty("autoRegister")?o.autoResubscribe=!!t.autoRegister:o.autoResubscribe=!!i.config.autoResubscribe,o}}static getSubdomainForConfigIntegrationKind(e,t,i){const n=this.getIntegrationCapabilities(e),o=t.subdomainName;let s="";switch(n.configuration){case jt.Dashboard:s=i.config.siteInfo.proxyOriginEnabled?i.config.siteInfo.proxyOrigin:void 0;break;case jt.JavaScript:s=i.config.subdomain}return s&&!this.shouldUseServerConfigSubdomain(o,n)?void 0:s}static shouldUseServerConfigSubdomain(e,t){switch(t.configuration){case jt.Dashboard:return!0;case jt.JavaScript:switch(location.protocol){case"https:":return!!e;case"http:":return!0;default:return!1}}}}class Ft{getAppConfig(e){return Object(d.a)(this,void 0,void 0,function*(){return yield Vt.getAppConfig(e,Wt.downloadServerAppConfig)})}getMergedConfig(e,t){return Vt.getMergedConfig(e,t)}}class Ht{constructor(e){this.options={appId:e.appId,subdomain:e.subdomainName,origin:e.origin,siteName:e.siteName,metrics:{enable:!1,mixpanelReportingToken:null},userConfig:{}}}initialize(){return Object(d.a)(this,void 0,void 0,function*(){if((window.opener||window.parent)==window)return document.write("<span style='font-size: 14px; color: red; font-family: sans-serif;'>OneSignal: This page cannot be directly opened, and must be opened as a result of a subscription call.</span>"),Promise.resolve();const e=Object.assign({},this.options);e.appId=e.appId,e.subdomainName=e.subdomain,e.origin=e.origin,OneSignal.config=e||{};const t=yield(new Ft).getAppConfig(e);return OneSignal.environmentInfo=Pt.getEnvironmentInfo(),OneSignal.context=new Mt(t),OneSignal.context.workerMessenger.listen(!0),OneSignal.initialized=!0,this.loadPromise={},this.loadPromise.promise=new Promise((e,t)=>{this.loadPromise.resolver=e,this.loadPromise.rejector=t}),this.establishCrossOriginMessaging(),this.loadPromise.promise})}establishCrossOriginMessaging(){}dispose(){this.messenger.destroy()}finishInitialization(){this.loadPromise.resolver()}subscribe(){return Object(d.a)(this,void 0,void 0,function*(){const e=H.getIsPushNotificationsEnabled(),t=opener||parent;e?t&&window.close():ne.registerForPush()})}}class $t extends Ht{initialize(){const e=super.initialize();return S.a.trigger("httpInitialize"),e}establishCrossOriginMessaging(){this.messenger&&this.messenger.destroy(),this.messenger=new ce(window,this.options.origin,this.options.origin),this.messenger.on(OneSignal.POSTMAM_COMMANDS.CONNECTED,this.onMessengerConnect.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.IFRAME_POPUP_INITIALIZE,this.onProxyFrameInitializing.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION,this.onRemoteNotificationPermission.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET,this.onRemoteDatabaseGet.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_GET_ALL,this.onRemoteDatabaseGetAll.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_PUT,this.onRemoteDatabasePut.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_DATABASE_REMOVE,this.onRemoteDatabaseRemove.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.UNSUBSCRIBE_FROM_PUSH,this.onUnsubscribeFromPush.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.MARK_PROMPT_DISMISSED,this.onMarkPromptDismissed.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.IS_SUBSCRIBED,this.onIsSubscribed.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.UNSUBSCRIBE_PROXY_FRAME,this.onUnsubscribeProxyFrame.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.SERVICE_WORKER_STATE,this.onServiceWorkerState.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.GET_WORKER_VERSION,this.onWorkerVersion.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.SUBSCRIPTION_EXPIRATION_STATE,this.onSubscriptionExpirationState.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.PROCESS_EXPIRING_SUBSCRIPTIONS,this.onProcessExpiringSubscriptions.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.GET_SUBSCRIPTION_STATE,this.onGetSubscriptionState.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.SESSION_UPSERT,this.onSessionUpsert.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.SESSION_DEACTIVATE,this.onSessionDeactivate.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_REQUEST,this.onAreYouVisibleRequest.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_RESPONSE,this.onAreYouVisibleResponse.bind(this)),this.messenger.listen()}retriggerRemoteEvent(e,t){this.messenger.message(OneSignal.POSTMAM_COMMANDS.REMOTE_RETRIGGER_EVENT,{eventName:e,eventData:t})}onMessengerConnect(e){return Object(d.a)(this,void 0,void 0,function*(){return A.a.debug(`(${C.a.getWindowEnv().toString()}) Successfully established cross-origin communication.`),this.finishInitialization(),!1})}onProxyFrameInitializing(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.info(`(${C.a.getWindowEnv().toString()}) The iFrame has just received initOptions from the host page!`);const t=Object.assign(Object.assign(Object.assign({},e.data.hostInitOptions),OneSignal.config),{pageUrl:e.data.pageUrl});if(OneSignal.config=t,Ue.installNativePromptPermissionChangedHook(),(yield x.a.get("Options","defaultUrl"))||(yield x.a.put("Options",{key:"defaultUrl",value:new URL(OneSignal.config.pageUrl).origin})),yield x.a.put("Options",{key:"lastKnownHostUrl",value:OneSignal.config.pageUrl}),yield Ue.initSaveState(),yield Ue.storeInitialValues(),yield Ue.saveInitOptions(),navigator.serviceWorker&&"https:"===window.location.protocol)try{OneSignal.context.serviceWorkerManager.establishServiceWorkerChannel()}catch(e){A.a.error("Error interacting with Service Worker inside an HTTP-hosted iFrame:",e)}e.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE)})}onRemoteNotificationPermission(e){return Object(d.a)(this,void 0,void 0,function*(){const t=OneSignal.context,i=yield t.permissionManager.getReportedNotificationPermission(t.appConfig.safariWebId);return e.reply(i),!1})}onRemoteDatabaseGet(e){return Object(d.a)(this,void 0,void 0,function*(){const t=e.data,i=[];for(let e of t){const{table:t,key:n}=e;i.push(x.a.get(t,n))}const n=yield Promise.all(i);return e.reply(n),!1})}onRemoteDatabaseGetAll(e){return Object(d.a)(this,void 0,void 0,function*(){const t=e.data.table,i=yield x.a.getAll(t);return e.reply(i),!1})}onRemoteDatabasePut(e){return Object(d.a)(this,void 0,void 0,function*(){const t=e.data;let i=[];for(let e of t){let{table:t,keypath:n}=e;i.push(x.a.put(t,n))}return yield Promise.all(i),e.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE),!1})}onRemoteDatabaseRemove(e){return Object(d.a)(this,void 0,void 0,function*(){const t=e.data;let i=[];for(let e of t){let{table:t,keypath:n}=e;i.push(x.a.remove(t,n))}return yield Promise.all(i),e.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE),!1})}onUnsubscribeFromPush(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug("(Reposted from iFrame -> Host) User unsubscribed but permission granted. Re-prompting the user for push.");try{yield Object(_.z)(),e.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE)}catch(e){A.a.debug("Failed to unsubscribe from push remotely:",e)}})}onMarkPromptDismissed(e){return Object(d.a)(this,void 0,void 0,function*(){return A.a.debug("(Reposted from iFrame -> Host) Marking prompt as dismissed."),yield We.markHttpsNativePromptDismissed(),e.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE),!1})}onIsSubscribed(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield OneSignal.isPushNotificationsEnabled();return e.reply(t),!1})}onUnsubscribeProxyFrame(e){return Object(d.a)(this,void 0,void 0,function*(){return(yield OneSignal.isPushNotificationsEnabled())&&(yield OneSignal.setSubscription(!1),yield OneSignal.database.rebuild()),e.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE),!1})}onServiceWorkerState(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield OneSignal.context.serviceWorkerManager.getActiveState();return e.reply(t),!1})}onWorkerVersion(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield OneSignal.context.serviceWorkerManager.getWorkerVersion();return e.reply(t),!1})}onSubscriptionExpirationState(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield OneSignal.context.subscriptionManager.isSubscriptionExpiring();return e.reply(t),!1})}onProcessExpiringSubscriptions(e){return Object(d.a)(this,void 0,void 0,function*(){OneSignal.context,yield Ue.processExpiringSubscriptions();return e.reply(OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE),!1})}onGetSubscriptionState(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield OneSignal.context.subscriptionManager.getSubscriptionState();return e.reply(t),!1})}onSessionUpsert(e){return Object(d.a)(this,void 0,void 0,function*(){const t=OneSignal.context,i=e.data;t.workerMessenger.directPostMessageToSW(se.SessionUpsert,i),e.reply(!0)})}onSessionDeactivate(e){return Object(d.a)(this,void 0,void 0,function*(){const t=OneSignal.context,i=e.data;t.workerMessenger.directPostMessageToSW(se.SessionDeactivate,i),e.reply(!0)})}onAreYouVisibleRequest(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug("onAreYouVisibleRequest iframe",e)})}onAreYouVisibleResponse(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug("onAreYouVisibleResponse iframe",e);const t=OneSignal.context,i=e.data;t.workerMessenger.directPostMessageToSW(se.AreYouVisibleResponse,i),e.reply(!0)})}}class zt extends Ht{constructor(e){super(e)}establishCrossOriginMessaging(){this.messenger&&this.messenger.destroy(),this.messenger=new ce(window.parent,this.options.origin,this.options.origin)}}class Gt extends Ht{constructor(e){super(e)}establishCrossOriginMessaging(){this.messenger=new ce(window.opener,this.options.origin,this.options.origin),this.messenger.once(OneSignal.POSTMAM_COMMANDS.CONNECTED,this.onMessengerConnected.bind(this)),this.messenger.postMessage(OneSignal.POSTMAM_COMMANDS.POPUP_BEGIN_MESSAGEPORT_COMMS,null),this.messenger.listen()}onMessengerConnected(e){A.a.debug(`(${C.a.getWindowEnv().toString()}) The host page is now ready to receive commands from the HTTP popup.`),this.finishInitialization()}}class Kt{static initHttp(e){return Object(d.a)(this,void 0,void 0,function*(){switch(A.a.debug(`Called %cinitHttp(${JSON.stringify(e,null,4)})`,Object(_.k)("code")),C.a.getWindowEnv()){case G.a.OneSignalProxyFrame:OneSignal.proxyFrame=new $t(e),yield OneSignal.proxyFrame.initialize(),K.ensureBackwardsCompatibility(OneSignal);break;case G.a.OneSignalSubscriptionPopup:OneSignal.subscriptionPopup=new Gt(e),yield OneSignal.subscriptionPopup.initialize(),K.ensureBackwardsCompatibility(OneSignal),S.a.trigger("httpInitialize");break;case G.a.OneSignalSubscriptionModal:OneSignal.subscriptionModal=new zt(e),OneSignal.subscriptionModal.establishCrossOriginMessaging(),OneSignal.subscriptionModal.initialize(),K.ensureBackwardsCompatibility(OneSignal),S.a.trigger("httpInitialize");break;default:A.a.error("Unsupported HTTP initialization branch.")}})}}var qt=i(14);class Yt{constructor(e){this.url=e,this.url.pathname="webPushIframe"}static get LOAD_TIMEOUT_MS(){return 15e3}load(){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug("Opening an iFrame to",this.url.toString()),this.removeFrame();const e=document.createElement("iframe");return e.style.display="none",e.src=this.url.toString(),e.sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation",this.loadPromise={},this.loadPromise.promise=new Promise((e,t)=>{this.loadPromise.resolver=e,this.loadPromise.rejector=t}),document.body.appendChild(e),e.onload=this.onFrameLoad.bind(this),this.element=e,Object(_.x)(this.loadPromise.promise,Yt.LOAD_TIMEOUT_MS).catch(()=>{window===window.top&&A.a.warn(`OneSignal: Loading the required iFrame ${this.url.toString()} timed out. Check that the Site URL onesignal.com dashboard web config is ${location.origin}. Only the Site URL specified there is allowed to use load the iFrame.`)}),this.loadPromise.promise})}removeFrame(){if(!p.a.isBrowser())return;const e=document.querySelector(`iframe[src='${this.url.toString()}']`);e&&e.remove()}onFrameLoad(e){this.establishCrossOriginMessaging()}establishCrossOriginMessaging(){this.messenger&&this.messenger.destroy(),this.messenger=new ce(this.element.contentWindow,this.url.toString(),this.url.toString()),this.messenger.on(OneSignal.POSTMAM_COMMANDS.CONNECTED,this.onMessengerConnect.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_RETRIGGER_EVENT,this.onRemoteRetriggerEvent.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.REMOTE_NOTIFICATION_PERMISSION_CHANGED,this.onRemoteNotificationPermissionChanged.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.REQUEST_HOST_URL,this.onRequestHostUrl.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.SERVICEWORKER_COMMAND_REDIRECT,this.onServiceWorkerCommandRedirect.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.GET_EVENT_LISTENER_COUNT,this.onGetEventListenerCount.bind(this)),this.messenger.on(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_REQUEST,this.onAreYouVisibleRequest.bind(this)),this.messenger.connect()}dispose(){this.messenger&&this.messenger.destroy(),this.removeFrame()}onMessengerConnect(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug(`Successfully established cross-origin communication for iFrame at ${this.url.toString()}`),this.messenger.message(OneSignal.POSTMAM_COMMANDS.IFRAME_POPUP_INITIALIZE,{hostInitOptions:Object(_.h)(OneSignal.config),pageUrl:window.location.href},e=>(e.data===OneSignal.POSTMAM_COMMANDS.REMOTE_OPERATION_COMPLETE&&this.loadPromise.resolver(),!1))})}onRemoteRetriggerEvent(e){let{eventName:t,eventData:i}=e.data;return S.a.trigger(t,i,e.source),!1}onRemoteNotificationPermissionChanged(e){let{forceUpdatePermission:t}=e.data;return Object(_.y)(t),!1}onRequestHostUrl(e){return e.reply(location.href),!1}onServiceWorkerCommandRedirect(e){const t=e.data;return t&&t.startsWith("http")&&(window.location.href=t),!1}onGetEventListenerCount(e){const t=e.data;return A.a.debug("(Reposted from iFrame -> Host) Getting event listener count for ",t),e.reply(OneSignal.emitter.numberOfListeners(t)),!1}isSubscribed(){return new Promise(e=>{this.messenger.message(OneSignal.POSTMAM_COMMANDS.IS_SUBSCRIBED,null,t=>{e(t.data)})})}unsubscribeFromPush(){return new Promise(e=>{this.messenger.message(OneSignal.POSTMAM_COMMANDS.UNSUBSCRIBE_PROXY_FRAME,null,t=>{e()})})}getProxyServiceWorkerActiveState(){return new Promise((e,t)=>{this.message(OneSignal.POSTMAM_COMMANDS.SERVICE_WORKER_STATE,null,t=>{e(t.data)})})}runCommand(e,t=null){return Object(d.a)(this,void 0,void 0,function*(){return yield new Promise((i,n)=>{this.message(e,t,e=>{i(e.data)})})})}onAreYouVisibleRequest(e){A.a.debug("onAreYouVisibleRequest page",e);const t={timestamp:e.data.timestamp,focused:document.hasFocus()};this.message(OneSignal.POSTMAM_COMMANDS.ARE_YOU_VISIBLE_RESPONSE,t)}message(...e){this.messenger.message.apply(this.messenger,arguments)}}class Jt{constructor(){}static discoverAltOrigin(e){return Object(d.a)(this,void 0,void 0,function*(){const t=Jt.getOneSignalProxyIframeUrls(e),i=[];for(const e of t){const t=new Yt(e);yield t.load(),i.push(t)}const n=yield Jt.subscribedProxyFrameHosts(i);let o;yield Jt.removeDuplicatedAltOriginSubscription(n),o=0===n.length?i[0]:n[0];for(const e of i)o!==e&&e.dispose();return o})}static subscribedProxyFrameHosts(e){return Object(d.a)(this,void 0,void 0,function*(){const t=[];for(const i of e)(yield i.isSubscribed())&&t.push(i);return t})}static removeDuplicatedAltOriginSubscription(e){return Object(d.a)(this,void 0,void 0,function*(){if(e.length<2)return;const t=e.slice(1);for(const e of t)yield e.unsubscribeFromPush()})}static getCanonicalSubscriptionUrls(e,t=C.a.getApiEnv()){const i=Jt.getWildcardLegacySubscriptionDomain(t),n=new URL(`https://${e.subdomain}.${i}`);if(t!==qt.a.Production)return[n];const o=[new URL(`https://${e.subdomain}.os.tc`)];return e.httpUseOneSignalCom&&o.push(n),o}static getWildcardLegacySubscriptionDomain(e){const t=C.a.getOneSignalApiUrl(e);let i=2;return e===qt.a.Staging&&(i=3),T.a.lastParts(t.host,".",i)}static getOneSignalProxyIframeUrls(e){const t=Jt.getCanonicalSubscriptionUrls(e);for(const e of t)e.pathname="webPushIframe";return t}}var Zt=i(23);class Xt{static isValidUrl(e,t){if(t&&t.allowNull&&null===e)return!0;if(t&&t.allowEmpty&&(null===e||void 0===e))return!0;try{const i=new URL(e);return!t||!t.requireHttps||"https:"===i.protocol}catch(e){return!1}}static isValidBoolean(e,t){return!(!t||!t.allowNull||null!==e)||(!0===e||!1===e)}static isValidArray(e,t){return!(!t||!t.allowNull||null!==e)||(!(!t||!t.allowEmpty||null!==e&&void 0!==e)||e instanceof Array)}}var Qt=i(19);class ei{static processItem(e,t){if("function"==typeof t)t();else{if(!Array.isArray(t))throw new h.a("Only accepts function and Array types!");{if(0==t.length)throw new h.a("Empty array is not valid!");const i=t.shift();if(null==i||void 0===i)throw new h.a("First element in array must be the OneSignal function name");const n=e[i.toString()];if("function"!=typeof n)throw new h.a(`No OneSignal function with the name '${i}'`);n.apply(e,t)}}}}i.d(t,"default",function(){return ti});class ti{static setDefaultNotificationUrl(e){return Object(d.a)(this,void 0,void 0,function*(){if(!Xt.isValidUrl(e,{allowNull:!0}))throw new InvalidArgumentError.a("url",InvalidArgumentError.b.Malformed);yield Object(_.c)(),Object(_.s)("setDefaultNotificationUrl",e);const t=yield x.a.getAppState();t.defaultNotificationUrl=e,yield x.a.setAppState(t)})}static setDefaultTitle(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),Object(_.s)("setDefaultTitle",e);const t=yield x.a.getAppState();t.defaultNotificationTitle=e,yield x.a.setAppState(t)})}static setEmail(e,t){return Object(d.a)(this,void 0,void 0,function*(){if(!e)throw new InvalidArgumentError.a("email",InvalidArgumentError.b.Empty);if(!Object(_.r)(e))throw new InvalidArgumentError.a("email",InvalidArgumentError.b.Malformed);const i=t&&!!t.identifierAuthHash,n=t&&!!t.emailAuthHash,o=i?t.identifierAuthHash:n?t.emailAuthHash:void 0;if(o){if(i&&n)throw A.a.error("Both `emailAuthHash` and `identifierAuthHash` provided."),new InvalidArgumentError.a("options",InvalidArgumentError.b.Malformed);const e=i&&64!==t.identifierAuthHash.length,o=n&&64!==t.emailAuthHash.length;if(e)throw new InvalidArgumentError.a("options.identifierAuthHash",InvalidArgumentError.b.Malformed);if(o)throw new InvalidArgumentError.a("options.emailAuthHash",InvalidArgumentError.b.Malformed)}Object(_.s)("setEmail",e,t),yield Object(_.c)();const s=yield x.a.getAppConfig(),{deviceId:r}=yield x.a.getSubscription(),a=yield x.a.getEmailProfile(),c=new Qt.a(a.emailId,e,o),l=!!a.emailId;c.emailId=l?yield Wt.updateEmailRecord(s,c,r):yield Wt.createEmailRecord(s,c,r);const d=r,u=!l||a.emailId!==c.emailId,g=!a.emailAddress||c.emailAddress!==a.emailAddress;if(r&&d&&(u||g)){const e=yield ti.database.getExternalUserIdAuthHash();yield Wt.updatePlayer(s.appId,r,{parent_player_id:c.emailId,email:c.emailAddress,external_user_id_auth_hash:e})}return c.emailId&&(yield x.a.setEmailProfile(c)),c.emailId})}static logoutEmail(){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)();const e=yield x.a.getAppConfig(),t=yield x.a.getEmailProfile(),{deviceId:i}=yield x.a.getSubscription();t.emailId?i?(yield Wt.logoutEmail(e,t,i))?yield x.a.setEmailProfile(new Qt.a):A.a.warn("Failed to logout email."):A.a.warn(new f(r.NoDeviceId)):A.a.warn(new f(r.NoEmailSet))})}static isPushNotificationsSupported(){return Object(_.s)("isPushNotificationsSupported"),!0}static initializeConfig(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield(new Ft).getAppConfig(e);A.a.debug(`OneSignal: Final web app config: %c${JSON.stringify(t,null,4)}`,Object(_.k)("code")),ti.config=t,ti.environmentInfo=Pt.getEnvironmentInfo(),ti.context=new Mt(t),ti.config=ti.context.appConfig})}static init(e){return Object(d.a)(this,void 0,void 0,function*(){if(Object(_.s)("init"),yield Ue.polyfillSafariFetch(),Ue.errorIfInitAlreadyCalled(),yield ti.initializeConfig(e),!ti.config)throw new Error("OneSignal config not initialized!");if(!g.a.safari||ti.config.safariWebId){if(ti.config.userConfig.requiresUserPrivacyConsent){if(!(yield x.a.getProvideUserConsent()))return void(ti.pendingInit=!0)}yield ti.delayedInit()}else A.a.warn(new m(c.MissingSafariWebId))})}static delayedInit(){return Object(d.a)(this,void 0,void 0,function*(){function e(){return Object(d.a)(this,void 0,void 0,function*(){if(!ti.__initAlreadyCalled){if(ti.__initAlreadyCalled=!0,ti.emitter.on(ti.EVENTS.NATIVE_PROMPT_PERMISSIONCHANGED,$.onNotificationPermissionChange),ti.emitter.on(ti.EVENTS.SUBSCRIPTION_CHANGED,$._onSubscriptionChanged),ti.emitter.on(ti.EVENTS.SDK_INITIALIZED,Ue.onSdkInitialized),E.b.isUsingSubscriptionWorkaround()){if(!ti.config||!ti.config.subdomain)throw new m(c.MissingSubdomain);ti.emitter.on(ti.EVENTS.SESSION_STARTED,At.setupSessionEventListenersForHttp),ti.proxyFrameHost=yield Jt.discoverAltOrigin(ti.config)}window.addEventListener("focus",()=>{oe.checkAndTriggerNotificationPermissionChanged()}),yield Ue.initSaveState(),yield Ue.saveInitOptions(),C.a.getWindowEnv()===G.a.CustomIframe?yield S.a.trigger(ti.EVENTS.SDK_INITIALIZED):yield Ue.internalInit()}})}ti.pendingInit=!1,ti.context.workerMessenger.listen(),"complete"===document.readyState||"interactive"===document.readyState?yield e():(A.a.debug("OneSignal: Waiting for DOMContentLoaded or readyStateChange event before continuing initialization..."),window.addEventListener("DOMContentLoaded",()=>{e()}),document.onreadystatechange=(()=>{"complete"!==document.readyState&&"interactive"!==document.readyState||e()}))})}static provideUserConsent(e){return Object(d.a)(this,void 0,void 0,function*(){yield x.a.setProvideUserConsent(e),e&&ti.pendingInit&&(yield ti.delayedInit())})}static showHttpPermissionRequest(e){return Object(d.a)(this,void 0,void 0,function*(){A.a.debug("Called showHttpPermissionRequest(), redirecting to HTTP prompt."),ti.showHttpPrompt(e).catch(e=>A.a.info(e))})}static showHttpPrompt(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),yield ti.context.promptsManager.internalShowSlidedownPrompt(e)})}static showNativePrompt(){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),yield ti.context.promptsManager.internalShowNativePrompt()})}static showSlidedownPrompt(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),yield ti.context.promptsManager.internalShowSlidedownPrompt(e)})}static showCategorySlidedown(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)();const t=H.getIsPushNotificationsEnabled();yield ti.context.promptsManager.internalShowCategorySlidedown(Object.assign(Object.assign({},e),{isInUpdateMode:t}))})}static registerForPushNotifications(e){return Object(d.a)(this,void 0,void 0,function*(){if(ti.initialized)return yield Ue.registerForPushNotifications(e);yield new Promise((t,i)=>{ti.emitter.once(ti.EVENTS.SDK_INITIALIZED,()=>Object(d.a)(this,void 0,void 0,function*(){return yield Ue.registerForPushNotifications(e),t()}))})})}static getNotificationPermission(e){return Object(d.a)(this,void 0,void 0,function*(){return yield Object(_.c)(),ti.privateGetNotificationPermission(e)})}static privateGetNotificationPermission(e){return Object(d.a)(this,void 0,void 0,function*(){const t=yield ti.context.permissionManager.getNotificationPermission(ti.config.safariWebId);return e&&e(t),t})}static getTags(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),Object(_.s)("getTags",e);const{appId:t}=yield x.a.getAppConfig(),{deviceId:i}=yield x.a.getSubscription();if(!i)return A.a.info(new f(r.NoDeviceId)),null;const{tags:n}=yield Wt.getPlayer(t,i);return Object(_.j)(e,n),n})}static sendTag(e,t,i){return Object(d.a)(this,void 0,void 0,function*(){const n={};return n[e]=t,yield ti.sendTags(n,i)})}static sendTags(e,t){return Object(d.a)(this,void 0,void 0,function*(){if(yield Object(_.c)(),Object(_.s)("sendTags",e,t),!e||0===Object.keys(e).length)return A.a.info(new InvalidArgumentError.a("tags",InvalidArgumentError.b.Empty)),null;Object.keys(e).forEach(t=>{!1===e[t]&&(e[t]="false")});const{appId:i}=yield x.a.getAppConfig(),n=yield x.a.getEmailProfile();if(n.emailId){const t={tags:e,identifier_auth_hash:n.identifierAuthHash};yield Wt.updatePlayer(i,n.emailId,t)}const{deviceId:o}=yield x.a.getSubscription();o||(yield Object(_.d)(ti.EVENTS.REGISTERED));const{deviceId:s}=yield x.a.getSubscription(),r=yield x.a.getExternalUserIdAuthHash(),a={tags:e};return r&&(a.external_user_id_auth_hash=r),yield Wt.updatePlayer(i,s,a),Object(_.j)(t,e),e})}static deleteTag(e){return Object(d.a)(this,void 0,void 0,function*(){return yield ti.deleteTags([e])})}static deleteTags(e,t){return Object(d.a)(this,void 0,void 0,function*(){if(yield Object(_.c)(),Object(_.s)("deleteTags",e,t),!Xt.isValidArray(e))throw new InvalidArgumentError.a("tags",InvalidArgumentError.b.Malformed);0===e.length&&A.a.info(new InvalidArgumentError.a("tags",InvalidArgumentError.b.Empty));const i={};for(const t of e)i[t]="";const n=yield ti.sendTags(i);if(n){const e=Object.keys(n);return Object(_.j)(t,e),e}return[]})}static setExternalUserId(e,t){return Object(d.a)(this,void 0,void 0,function*(){if(yield Object(_.c)(),Object(_.s)("setExternalUserId"),t&&64!==t.length)throw new InvalidArgumentError.a("options.identifierAuthHash",InvalidArgumentError.b.Malformed);(yield this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal())||(yield Object(_.d)(ti.EVENTS.REGISTERED));const i=yield ti.context.updateManager.sendExternalUserIdUpdate(e,t);i&&i.success&&ti.database.setExternalUserId(e,t)})}static getExternalUserId(){return Object(d.a)(this,void 0,void 0,function*(){return yield Object(_.c)(),Object(_.s)("getExternalUserId"),yield ti.database.getExternalUserId()})}static removeExternalUserId(){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),Object(_.s)("removeExternalUserId"),(yield this.context.subscriptionManager.isAlreadyRegisteredWithOneSignal())?(yield ti.context.updateManager.sendExternalUserIdUpdate(void 0),yield ti.database.setExternalUserId(void 0)):A.a.warn("User is not subscribed, cannot remove external user id.")})}static addListenerForNotificationOpened(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),Object(_.s)("addListenerForNotificationOpened",e),ti.emitter.once(ti.EVENTS.NOTIFICATION_CLICKED,t=>{Object(_.j)(e,t)}),ti.config&&$.fireStoredNotificationClicks(ti.config.pageUrl||ti.config.userConfig.pageUrl)})}static getIdsAvailable(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),Object(_.s)("getIdsAvailable",e);const{deviceId:t,subscriptionToken:i}=yield x.a.getSubscription(),n={userId:t,registrationId:i};return Object(_.j)(e,n),n})}static isPushNotificationsEnabled(e){return Object(d.a)(this,void 0,void 0,function*(){return yield Object(_.c)(),ti.privateIsPushNotificationsEnabled(e)})}static privateIsPushNotificationsEnabled(e){return Object(d.a)(this,void 0,void 0,function*(){Object(_.s)("isPushNotificationsEnabled",e);const t=yield ti.context.subscriptionManager.getSubscriptionState();return Object(_.j)(e,t.subscribed&&!t.optedOut),t.subscribed&&!t.optedOut})}static setSubscription(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),Object(_.s)("setSubscription",e);const t=yield x.a.getAppConfig(),{appId:i}=t,n=yield x.a.getSubscription(),{deviceId:s}=n;if(!t.appId)throw new b(o.MissingAppId);if(!Xt.isValidBoolean(e))throw new InvalidArgumentError.a("newSubscription",InvalidArgumentError.b.Malformed);if(!s)return void A.a.info(new f(r.NoDeviceId));const a={notification_types:oe.getNotificationTypeFromOptIn(e)},c=yield x.a.getExternalUserIdAuthHash();c&&(a.external_user_id_auth_hash=c),n.optedOut=!e,yield Wt.updatePlayer(i,s,a),yield x.a.setSubscription(n),$.onInternalSubscriptionSet(n.optedOut),$.checkAndTriggerSubscriptionChanged()})}static isOptedOut(e){return Object(d.a)(this,void 0,void 0,function*(){return yield Object(_.c)(),ti.internalIsOptedOut(e)})}static internalIsOptedOut(e){return Object(d.a)(this,void 0,void 0,function*(){Object(_.s)("isOptedOut",e);const{optedOut:t}=yield x.a.getSubscription();return Object(_.j)(e,t),t})}static optOut(e,t){return Object(d.a)(this,void 0,void 0,function*(){if(yield Object(_.c)(),Object(_.s)("optOut",e,t),!Xt.isValidBoolean(e))throw new InvalidArgumentError.a("doOptOut",InvalidArgumentError.b.Malformed);yield ti.setSubscription(!e),Object(_.j)(t)})}static getEmailId(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),Object(_.s)("getEmailId",e);const t=(yield x.a.getEmailProfile()).emailId;return Object(_.j)(e,t),t})}static getUserId(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),Object(_.s)("getUserId",e);const t=(yield x.a.getSubscription()).deviceId;return Object(_.j)(e,t),t})}static getRegistrationId(e){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),Object(_.s)("getRegistrationId",e);const t=(yield x.a.getSubscription()).subscriptionToken;return Object(_.j)(e,t),t})}static getSubscription(e){return Object(d.a)(this,void 0,void 0,function*(){return yield Object(_.c)(),yield ti.privateGetSubscription(e)})}static privateGetSubscription(e){return Object(d.a)(this,void 0,void 0,function*(){Object(_.s)("getSubscription",e);const t=!(yield x.a.getSubscription()).optedOut;return Object(_.j)(e,t),t})}static sendSelfNotification(e="OneSignal Test Message",t="This is an example notification.",i=`${new URL(location.href).origin}?_osp=do_not_open`,n,s,a){return Object(d.a)(this,void 0,void 0,function*(){yield Object(_.c)(),Object(_.s)("sendSelfNotification",e,t,i,n,s,a);const c=yield x.a.getAppConfig(),l=yield x.a.getSubscription();if(!c.appId)throw new b(o.MissingAppId);if(!(yield ti.isPushNotificationsEnabled()))throw new f(r.NoDeviceId);if(!Xt.isValidUrl(i))throw new InvalidArgumentError.a("url",InvalidArgumentError.b.Malformed);if(!Xt.isValidUrl(n,{allowEmpty:!0,requireHttps:!0}))throw new InvalidArgumentError.a("icon",InvalidArgumentError.b.Malformed);l.deviceId&&(yield Wt.sendNotification(c.appId,[l.deviceId],{en:e},{en:t},i,n,s,a))})}static push(e){ei.processItem(ti,e)}static on(e,t){return this.emitter.on(e,t)}static off(e,t){return this.emitter.off(e,t)}static once(e,t){return this.emitter.once(e,t)}static sendOutcome(e,t){return Object(d.a)(this,void 0,void 0,function*(){const i=ti.config.userConfig.outcomes;if(!i)return void A.a.error(`Could not send ${e}. No outcomes config found.`);const n=new Ye(ti.config.appId,i,e,!1);if(void 0!==t&&"number"!=typeof t)return void A.a.error("Outcome weight can only be a number if present.");if(!(yield n.beforeOutcomeSend()))return;const o=yield n.getAttribution();yield n.send({type:o.type,notificationIds:o.notificationIds,weight:t})})}static sendUniqueOutcome(e){return Object(d.a)(this,void 0,void 0,function*(){const t=ti.config.userConfig.outcomes;if(!t)return void A.a.error(`Could not send ${e}. No outcomes config found.`);const i=new Ye(ti.config.appId,t,e,!0);if(!(yield i.beforeOutcomeSend()))return;const n=yield i.getAttribution();if(n.type===Fe.NotSupported)return void A.a.warn("You are on a free plan. Please upgrade to use this functionality.");const{notificationIds:o}=n,s=yield i.getNotifsToAttributeWithUniqueOutcome(o);i.shouldSendUnique(n,s)?yield i.send({type:n.type,notificationIds:s}):A.a.warn(`'${e}' was already reported for all notifications.`)})}}ti.VERSION=p.a.version(),ti._VERSION=p.a.version(),ti.sdkEnvironment=C.a,ti._notificationOpenedCallbacks=[],ti._idsAvailable_callback=[],ti._defaultLaunchURL=null,ti.config=null,ti._sessionInitAlreadyRunning=!1,ti._isNotificationEnabledCallback=[],ti._subscriptionSet=!0,ti.modalUrl=null,ti._windowWidth=650,ti._windowHeight=568,ti._isNewVisitor=!1,ti._channel=null,ti.timedLocalStorage=q,ti.initialized=!1,ti.notifyButton=null,ti.store=v,ti.environment=p.a,ti.database=x.a,ti.event=S.a,ti.browser=g.a,ti.slidedown=null,ti.log=A.a,ti.api=Wt,ti.indexedDb=Zt.a,ti.mainHelper=oe,ti.subscriptionHelper=ne,ti.httpHelper=Kt,ti.eventHelper=$,ti.initHelper=Ue,ti.testHelper=We,ti.pendingInit=!0,ti.emitter=new ae.a,ti.cache={},ti.SERVICE_WORKER_UPDATER_PATH="OneSignalSDKUpdaterWorker.js",ti.SERVICE_WORKER_PATH="OneSignalSDKWorker.js",ti.SERVICE_WORKER_PARAM={scope:"/"},ti._LOGGING=!1,ti.LOGGING=!1,ti._usingNativePermissionHook=!1,ti._initCalled=!1,ti.__initAlreadyCalled=!1,ti.checkAndWipeUserSubscription=function(){},ti.DeviceRecord=P,ti.EmailDeviceRecord=I,ti.notificationPermission=R,ti._initHttp=Kt.initHttp,ti._initPopup=(()=>ti.subscriptionPopup.subscribe()),ti.POSTMAM_COMMANDS={CONNECTED:"connect",REMOTE_NOTIFICATION_PERMISSION:"postmam.remoteNotificationPermission",REMOTE_DATABASE_GET:"postmam.remoteDatabaseGet",REMOTE_DATABASE_GET_ALL:"postmam.remoteDatabaseGetAll",REMOTE_DATABASE_PUT:"postmam.remoteDatabasePut",REMOTE_DATABASE_REMOVE:"postmam.remoteDatabaseRemove",REMOTE_OPERATION_COMPLETE:"postman.operationComplete",REMOTE_RETRIGGER_EVENT:"postmam.remoteRetriggerEvent",MODAL_LOADED:"postmam.modalPrompt.loaded",MODAL_PROMPT_ACCEPTED:"postmam.modalPrompt.accepted",MODAL_PROMPT_REJECTED:"postmam.modalPrompt.canceled",POPUP_LOADED:"postmam.popup.loaded",POPUP_ACCEPTED:"postmam.popup.accepted",POPUP_REJECTED:"postmam.popup.canceled",POPUP_CLOSING:"postman.popup.closing",REMOTE_NOTIFICATION_PERMISSION_CHANGED:"postmam.remoteNotificationPermissionChanged",IFRAME_POPUP_INITIALIZE:"postmam.iframePopupInitialize",UNSUBSCRIBE_FROM_PUSH:"postmam.unsubscribeFromPush",SET_SESSION_COUNT:"postmam.setSessionCount",REQUEST_HOST_URL:"postmam.requestHostUrl",WINDOW_TIMEOUT:"postmam.windowTimeout",FINISH_REMOTE_REGISTRATION:"postmam.finishRemoteRegistration",FINISH_REMOTE_REGISTRATION_IN_PROGRESS:"postmam.finishRemoteRegistrationInProgress",POPUP_BEGIN_MESSAGEPORT_COMMS:"postmam.beginMessagePortComms",SERVICEWORKER_COMMAND_REDIRECT:"postmam.command.redirect",MARK_PROMPT_DISMISSED:"postmam.markPromptDismissed",IS_SUBSCRIBED:"postmam.isSubscribed",UNSUBSCRIBE_PROXY_FRAME:"postman.unsubscribeProxyFrame",GET_EVENT_LISTENER_COUNT:"postmam.getEventListenerCount",SERVICE_WORKER_STATE:"postmam.serviceWorkerState",GET_WORKER_VERSION:"postmam.getWorkerVersion",SUBSCRIPTION_EXPIRATION_STATE:"postmam.subscriptionExpirationState",PROCESS_EXPIRING_SUBSCRIPTIONS:"postmam.processExpiringSubscriptions",GET_SUBSCRIPTION_STATE:"postmam.getSubscriptionState",SESSION_UPSERT:"postmam.sessionUpsert",SESSION_DEACTIVATE:"postmam.sessionDeactivate",ARE_YOU_VISIBLE_REQUEST:"postmam.areYouVisibleRequest",ARE_YOU_VISIBLE_RESPONSE:"postmam.areYouVisibleResponse"},ti.EVENTS={CUSTOM_PROMPT_CLICKED:"customPromptClick",NATIVE_PROMPT_PERMISSIONCHANGED:"notificationPermissionChange",SUBSCRIPTION_CHANGED:"subscriptionChange",WELCOME_NOTIFICATION_SENT:"sendWelcomeNotification",NOTIFICATION_DISPLAYED:"notificationDisplay",NOTIFICATION_DISMISSED:"notificationDismiss",NOTIFICATION_CLICKED:"notificationClick",SDK_INITIALIZED:"initializeInternal",SDK_INITIALIZED_PUBLIC:"initialize",REGISTERED:"register",POPUP_CLOSING:"popupClose",PERMISSION_PROMPT_DISPLAYED:"permissionPromptDisplay",TEST_INIT_OPTION_DISABLED:"testInitOptionDisabled",TEST_WOULD_DISPLAY:"testWouldDisplay",POPUP_WINDOW_TIMEOUT:"popupWindowTimeout",SESSION_STARTED:"os.sessionStarted"},K.ensureBackwardsCompatibility(ti),A.a.info(`%cOneSignal Web SDK loaded (version ${ti._VERSION},\n  ${C.a.getWindowEnv().toString()} environment).`,Object(_.k)("bold")),A.a.debug(`Current Page URL: ${"undefined"==typeof location?"NodeJS":location.href}`),A.a.debug(`Browser Environment: ${g.a.name} ${g.a.version}`)},function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}}]);
//# sourceMappingURL=OneSignalPageSDKES6.js.map